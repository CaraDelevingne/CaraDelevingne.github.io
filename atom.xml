<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cara&#39;s Blog</title>
  
  <subtitle>Do what you like , Like what you do.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yoursite.com/"/>
  <updated>2018-06-24T13:54:11.883Z</updated>
  <id>https://yoursite.com/</id>
  
  <author>
    <name>Cara</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>React ç¬”è®°</title>
    <link href="https://yoursite.com/2018/06/17/React%20%E7%AC%94%E8%AE%B0/"/>
    <id>https://yoursite.com/2018/06/17/React ç¬”è®°/</id>
    <published>2018-06-17T08:59:12.000Z</published>
    <updated>2018-06-24T13:54:11.883Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹  React å·²ç»æ˜¯å¾ˆæ—©å°±æœ‰çš„æƒ³æ³•äº†, å› ä¸ºä¹‹å‰çš„å·¥ä½œä¸€ç›´æ¥è§¦çš„éƒ½æ˜¯ <code>Vue.js</code> å¹¶ä¸”çŸ¥é“å®ƒä¿©çš„æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™, ä½†åœ¨å†™æ³•ä¸Šè¿˜æ˜¯æœ‰è›®å¤§åŒºåˆ«çš„. åœ¨æåˆ° <code>Vue</code> çš„åœ°æ–¹ä¹Ÿæ€»æ˜¯ä¼´éšç€ <code>React</code> åƒæ˜¯éº¦å½“åŠ³å’Œè‚¯å¾·åŸºä¸€æ ·(åŠ ä¸Šç°åœ¨çš„å‰ç«¯éƒ½è¦æ€€æ£ä¸€ä¸¤ä¸ªæ¡†æ¶å‚èº«ğŸ¤·â€), å…¶å®å…´è¶£è¿˜æŒºå¤§çš„, ä½†æ˜¯åœ¨å·¥ä½œå’Œå‡†å¤‡è·³æ§½ç­‰çäº‹ä¸‹ä¸€ç›´è€½è¯¯. åˆ°æœ€è¿‘æ‰æœ‰ä¸€äº›æ—¶é—´è·Ÿç€æ–‡æ¡£å†™ä¸€ç‚¹å° demo å…¥é—¨ <a href="https://reactjs.org/docs/try-react.html" target="_blank" rel="noopener">React 16.2.0</a> , é¡ºä¾¿è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹.</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>ç›´æ¥ä½¿ç”¨ <code>create-react-app</code>, è¿™ä¸ªè¿‡ç¨‹æƒ³å¿…å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†å°±ä¸å†è¯´. ç­‰å¾…å®‰è£…å®Œæˆä¹‹å, å°±æˆåŠŸå¯åŠ¨äº†ç¬¬ä¸€ä¸ª react é¡¹ç›®. çœ‹ä¸€çœ¼é¡¹ç›®ç»“æ„, å‘ƒâ€¦ è¿™ä¹ˆç®€æ´çš„å—?</p><h4 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><p>é»˜è®¤çš„ç»“æ„éå¸¸ç®€æ´, ç®€å•åˆ°æ€€ç–‘æ˜¯ä¸æ˜¯è‡ªå·±å“ªé‡Œæé”™äº†â€¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">react-srart</span><br><span class="line">  - node-modules/</span><br><span class="line">  - public/</span><br><span class="line">  - src/</span><br><span class="line">  - .gitignore</span><br><span class="line">  - package.json</span><br><span class="line">  - README.md</span><br><span class="line">  - yarn.lock</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æ²¡æœ‰çœ‹åˆ° <code>webpack</code> çš„é…ç½®, æŸ¥äº†ä¸€æ³¢åŸæ¥æ˜¯è¢«éšè—æ‰äº†. æ‰“å¼€ <code>package.json</code>:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"script": &#123;</span><br><span class="line">  "eject": "react-scripts eject"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿è¡Œè¿™æ¡å‘½ä»¤ <code>yarn eject</code>, åœ¨ç»ˆç«¯å°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹è¾“å‡º:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">âœ  react-start git:(master) âœ— yarn eject</span><br><span class="line">yarn run v1.7.0</span><br><span class="line"><span class="meta">$</span> react-scripts eject</span><br><span class="line">? Are you sure you want to eject? This action is permanent. Yes</span><br><span class="line">Ejecting...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> config å’Œ script ä¸¤ä¸ªæ–‡ä»¶å¤¹</span><br><span class="line">Copying files into /Users/cara/workspace/project/react-staff/react-start</span><br><span class="line">  Adding /config/env.js to the project</span><br><span class="line">  Adding /config/paths.js to the project</span><br><span class="line">  Adding /config/polyfills.js to the project</span><br><span class="line">  Adding /config/webpack.config.dev.js to the project</span><br><span class="line">  Adding /config/webpack.config.prod.js to the project</span><br><span class="line">  Adding /config/webpackDevServer.config.js to the project</span><br><span class="line">  Adding /config/jest/cssTransform.js to the project</span><br><span class="line">  Adding /config/jest/fileTransform.js to the project</span><br><span class="line">  Adding /scripts/build.js to the project</span><br><span class="line">  Adding /scripts/start.js to the project</span><br><span class="line">  Adding /scripts/test.js to the project</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ·»åŠ äº†ä¾èµ–é¡¹ (å¤ªå¤šå°±çœç•¥äº†)</span><br><span class="line">Updating the dependencies</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ›¿æ¢ package.json é‡Œçš„å‘½ä»¤</span><br><span class="line">Updating the scripts</span><br><span class="line">  Replacing "react-scripts start" with "node scripts/start.js"</span><br><span class="line">  Replacing "react-scripts build" with "node scripts/build.js"</span><br><span class="line">  Replacing "react-scripts test" with "node scripts/test.js"</span><br><span class="line"></span><br><span class="line">Configuring package.json</span><br><span class="line">  Adding Jest configuration</span><br><span class="line">  Adding Babel preset</span><br><span class="line">  Adding ESLint configuration</span><br><span class="line"></span><br><span class="line">Ejected successfully!</span><br><span class="line"></span><br><span class="line">Please consider sharing why you ejected in this survey:</span><br><span class="line">  http://goo.gl/forms/Bi6CZjk1EqsdelXk1</span><br><span class="line"></span><br><span class="line">âœ¨  Done in 2.20s.</span><br></pre></td></tr></table></figure><p>æ¥ç€é¡¹ç›®ç›®å½•ä¸­å°±å¤šäº†ä¸¤ä¸ªæ–‡ä»¶å¤¹, <code>scripts</code> å’Œ <code>config</code> åˆçœ‹åˆ°äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„ <code>webpack</code> çš„é…ç½®, åŒæ—¶ <code>package.json</code> ä¹Ÿå‘ç”Ÿä¸€äº›å˜åŒ–.</p><h4 id="React-åŸºæœ¬"><a href="#React-åŸºæœ¬" class="headerlink" title="React åŸºæœ¬"></a>React åŸºæœ¬</h4><p>çŸ¥é“äº†å¦‚ä½•åˆ›å»ºæ–°çš„é¡¹ç›®, æ¥ä¸‹æ¥è¯¥äº†è§£ä¸€ä¸‹ <code>React</code> çš„åŸºæœ¬ API å’Œ ç”Ÿå‘½å‘¨æœŸäº†. åœ¨ React çš„ä¸–ç•Œé‡Œä¸€åˆ‡çš†å‡½æ•°, ä½¿ç”¨çš„ <code>JSX</code> ä¸€ç§ JavaScript çš„æ‰©å±•è¯­æ³•. ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ JSX çš„åŸºæœ¬ç”¨æ³•</p><ul><li>JSX ä¸­åµŒå…¥è¡¨è¾¾å¼</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatString = <span class="function">(<span class="params">name, type</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> name + <span class="string">' frist '</span> + type + <span class="string">'appliction!'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element = (</span><br><span class="line">  &lt;h1&gt;</span><br><span class="line">    Hello, &#123; formatString(<span class="string">'cara'</span>, <span class="string">'React'</span>) &#125;</span><br><span class="line">  &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(</span></span><br><span class="line"><span class="regexp">  element,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root')</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><ul><li>JSX ä½œä¸ºè¡¨è¾¾å¼</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createElement = <span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (user) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;formatString('cara', 'React')&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, Stranger<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>JSX åœ¨æŒ‡å®šå±æ€§æ—¶, å¿…é¡»ä½¿ç”¨é©¼å³°å‘½å, è¡¨è¾¾å¼é€šè¿‡èŠ±æ‹¬å·è®¡ç®—</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> image = <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;user.avatarImg&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>JSX ä¹Ÿå¯ä»¥åŒ…å«å­å…ƒç´ </li></ul><blockquote><p>React åœ¨å¤šæ¬¡æ¸²æŸ“åŒä¸€ä¸ªç»„ä»¶æ—¶, ä¸ä¼šè¿™ä¸ªé”€æ¯å†é‡æ–°æ¸²æŸ“, è€Œæ˜¯åªæ›´æ–°éœ€è¦æ›´æ–°çš„éƒ¨åˆ†.</p></blockquote><h5 id="Components-å’Œ-Props"><a href="#Components-å’Œ-Props" class="headerlink" title="Components å’Œ Props"></a>Components å’Œ Props</h5><p><strong> å‡½æ•°å¼ç»„ä»¶å’Œç±»ç»„ä»¶ </strong></p><p>ä¸€ä¸ªæœ‰æ•ˆçš„å‡½æ•°å¼ç»„ä»¶, å¯ä»¥æ¥æ”¶ä¸€ä¸ª props å¹¶è¿”å›ä¸€ä¸ª React å…ƒç´ . å› ä¸ºå®ƒæœ¬èº«é•¿çš„å°±å¾ˆåƒå‡½æ•°, æ‰€ä»¥ç§°ä¹‹ä¸ºå‡½æ•°å¼ç»„ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å¼ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> Welcome = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨ ES6 ä¸­çš„ Class æ¥å®šä¹‰ä¸€ä¸ªç»„ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»ç»„ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="title">extend</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“çš„ä¸€ä¸ªç»„ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="xml"><span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">name</span>=<span class="string">"cara"</span> /&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">ReactDOM.render(</span></span><br><span class="line"><span class="xml">  element,</span></span><br><span class="line"><span class="xml">  document.getElementById('root')</span></span><br><span class="line"><span class="xml">)</span></span><br><span class="line"><span class="xml">// æ˜¾ç¤ºä¸º Hello, cara</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>this.props</code> å°±èƒ½è·å–åˆ°ä»ç»„ä»¶å¤–å±‚ä¼ å…¥çš„è‡ªå®šä¹‰å±æ€§, è·Ÿ Vue ç»„ä»¶å†…éƒ¨çš„ <code>props</code> ç±»ä¼¼.</p><blockquote><p>æ³¨æ„: ç»„ä»¶çš„åç§°éƒ½ä»¥å¤§å†™å­—æ¯å¼€å¤´, å±æ€§åä½¿ç”¨é©¼å³°å‘½å; ç»„ä»¶ä¸­è·Ÿ Vue ä¸€æ ·éƒ½éœ€è¦ä¸€ä¸ªæ ¹èŠ‚ç‚¹.</p></blockquote><p><strong> æå–ç»„ä»¶ </strong><br>react ä¸­æå€¡æŠŠä¸€ä¸ªç»„ä»¶æ‹†åˆ†æˆå¤šä¸ªå°ç»„ä»¶ä¾¿äºå¤ç”¨, å°¤å…¶æ˜¯ UI ç»„ä»¶. æˆ‘ç†è§£çš„æ˜¯å› ä¸º React ä¸€åˆ‡çš†å‡½æ•°, å…·ä½“åˆ° <code>button</code> è¿™ç§å°çš„ UI ç»„ä»¶, æ¯æ¬¡éƒ½é‡å†™ä¸€éå°±å¾ˆæ²¡æ„ä¹‰, æ‰€ä»¥å°½é‡æ‹†å°ä¸€ç‚¹ä»¥ä¾¿å¤ç”¨. å®˜ç½‘ä¸­ä»¥è¯„è®ºæ¡†ä¸ºä¾‹, è¿™é‡Œå°±ä¸å†å¤è¿°.</p><p><strong> Props æ˜¯åªè¯»çš„</strong><br>åœ¨ React ä¸­æœ‰ä¸€æ¡éå¸¸ä¸¥æ ¼çš„è§„åˆ™: æ‰€æœ‰ React çš„ç»„ä»¶éƒ½å¿…é¡»æ˜¯çº¯å‡½æ•°, ä¸å¾—æ”¹å˜è‡ªèº«ç»„ä»¶çš„ props. (çº¯å‡½æ•°æ˜¯æŒ‡: ä¸ä¼šæ”¹å˜å‚æ•°çš„è¾“å…¥, å¯¹äºç›¸åŒçš„è¾“å…¥å§‹ç»ˆå¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœ) çœ‹åˆ°å®˜ç½‘è¿™ä¹ˆè¯´æˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ UI ç»„ä»¶ä¸å¯èƒ½éƒ½æ˜¯çº¯çš„é™æ€ç»„ä»¶å•Š, è‚¯å®šæœ‰æ ¹æ®çŠ¶æ€åŠ¨æ€æ”¹å˜è§†å›¾çš„, æˆ–è€…åšä¸€äº›è¿‡æ»¤å’Œæ ¼å¼åŒ–çš„æ“ä½œ. äºæ˜¯æ¥åˆ°çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ</p><blockquote><p>react å†™ html æ ‡ç­¾åœ¨ vscode ä¸­ä½¿ç”¨ emmet è‡ªåŠ¨è¡¥å…¨éœ€è¦å¦‚ä¸‹é…ç½®:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"emmet.includeLanguages": &#123;</span><br><span class="line">  "javascript": "javascriptreact"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="State-å’Œç”Ÿå‘½å‘¨æœŸ"><a href="#State-å’Œç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="State å’Œç”Ÿå‘½å‘¨æœŸ"></a>State å’Œç”Ÿå‘½å‘¨æœŸ</h5><p>state å’Œ props ç±»ä¼¼éƒ½åœ¨ç»„ä»¶å†…éƒ¨ç”±ç»„ä»¶è‡ªå·±ç»´æŠ¤, å¯ä»¥è¯´æ˜¯ç»„ä»¶è‡ªèº«çš„ä¸€ä¸ªå±€éƒ¨çŠ¶æ€å§. ä¸¾ä¾‹è¯´æ˜:</p><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨å†…éƒ¨è‡ªåŠ¨æ›´æ–°çš„ç»„ä»¶, åœ¨å†…éƒ¨ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä» React.Component ç»§æ‰¿ä¸€ä¸ª Clack ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clack</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å§‹ç»ˆä½¿ç”¨ props è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– state</span></span><br><span class="line">  <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="comment">// ç±»ä¼¼äº Vue ä¸­çš„ data</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div&gt;State Component&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;Time is &#123;this.state.date.toLocaleTimeString()&#125;.&lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæœ‰ç€å±€éƒ¨çŠ¶æ€çš„ç±»ç»„ä»¶, æ¥ä¸‹æ¥è®© Clack è®¾ç½®è‡ªå·±çš„è®¡æ—¶å™¨, ä¸¤ç§’æ›´æ–°ä¸€æ¬¡.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clack</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»„ä»¶ç¬¬ä¸€æ¬¡æŒ‚è½½åˆ° DOM æ—¶(é’©å­)</span></span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">_</span> =&gt;</span> <span class="keyword">this</span>.ticker(), <span class="number">2000</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»„ä»¶è¢«é”€æ¯æ—¶(é’©å­)</span></span><br><span class="line">  componentWillUnmount () &#123;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.timer)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ticker () &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–° state</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div&gt;State Component&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;Time is &#123;this.state.date.toLocaleTimeString()&#125;.&lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯åœ¨ Clack ç»„ä»¶ç¬¬ä¸€æ¬¡è¢«æŒ‚è½½åˆ° DOM æ—¶, é€šè¿‡ <code>componentDidMount</code> ç”Ÿå‘½å‘¨æœŸé’©å­è°ƒç”¨ä¸€ä¸ªå®šæ—¶å™¨, <code>setState</code> æ”¹å˜ç»„ä»¶çŠ¶æ€æ¥è¾¾åˆ°å®šæ—¶æ›´æ–°æ—¶é—´; è€Œåœ¨ç»„ä»¶é”€æ¯æ—¶é€šè¿‡ <code>componentWillMount</code> é’©å­æ¥åœæ­¢å®šæ—¶å™¨.</p><p><strong>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</strong><br>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰å¤§ç±»: <code>Mounting</code>(è£…è½½æ—¶); <code>updating</code>(æ›´æ–°); <code>unmounting</code>(å¸è½½æ—¶). è·Ÿ Vue ä¸€æ ·ä½ å¯ä»¥åœ¨é’©å­å‡½æ•°é‡Œè¿è¡Œä¸€äº›ç‰¹å®šçš„ä»£ç .</p><ol><li><p>Mounting(è£…è½½): å½“ç»„ä»¶å®ä¾‹åˆ›å»ºä¸”æ’å…¥ DOM æ—¶, ä¸‹é¢çš„æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨</p><ul><li><p>constructor()<br>åˆå§‹åŒ– props/ state æˆ–è€…ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº</p></li><li><p>componentWillMount()</p></li><li><p>render()<br>é€šå¸¸ç”¨æ¥è¿”å› React å…ƒç´ (æ•°å­—/å­—ç¬¦/portals/null: ä¸æ¸²æŸ“/å¸ƒå°”å€¼:ä¸æ¸²æŸ“ä»»ä½•ä¸œè¥¿) ä¸”åº”è¯¥æ˜¯çº¯å‡½æ•°, æ³¨æ„å½“ <code>shouldComponentUpdate()</code> è¿”å› false æ—¶, render ä¸ä¼šè¢«è°ƒç”¨.</p></li><li><p>componentDidMount()<br>åœ¨ç»„ä»¶è£…è½½åç«‹å³è°ƒç”¨, ç­‰åŒäº Vue çš„ mounted(). åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä½¿ç”¨ <code>setState()</code> ä¼šè§¦å‘ä¸¤æ¬¡ render(ä½†ä¸ä¼šè¢«ç”¨æˆ·æ„ŸçŸ¥).</p></li></ul></li><li><p>Updating(æ›´æ–°): å½“ props å’Œ state å‘ç”Ÿæ”¹å˜, é‡æ–°æ¸²æŸ“ç»„ä»¶ä¼šè§¦å‘ä»¥ä¸‹é’©å­</p><ul><li><p>componentWillReceiveProps(nextProps)<br><code>componentWillReceiveProps(nextProps)</code> åœ¨å“åº” props å˜åŒ–ä¹‹å‰è¢«è°ƒç”¨. æœ‰ä¸ªæ³¨æ„ç‚¹æ˜¯æœ‰å¯èƒ½ props æ²¡æœ‰æ›´æ–° React ä¹Ÿè°ƒç”¨äº†è¿™ä¸ªå‡½æ•°, æ‰€ä»¥å¦‚æœä½ åªå…³å¿ƒå˜åŒ–éœ€è¦è‡ªå·±æ¯”è¾ƒå½“å‰å€¼å’Œä¸‹ä¸€ä¸ªå€¼.</p></li><li><p>shouldComponentUpdate(nextProps, nextState)<br>ç»„ä»¶æ˜¯å¦å— props å’Œ state å˜åŒ–çš„å½±å“, é»˜è®¤è¿”å› true. é¦–æ¬¡æ¸²æŸ“æˆ–ä½¿ç”¨ <code>forceUpdate()</code> æ—¶ä¸è°ƒç”¨æ­¤æ–¹æ³•;  å¦‚æœ <code>shouldComponentUpdate()</code> è¿”å› false, é‚£ä¹ˆ <code>componentWillUpdate()</code>, <code>render()</code> å’Œ <code>componentDidUpdate()</code> å°†ä¸ä¼šè°ƒç”¨. æ‰€ä»¥ä½ å¯ä»¥æ‰‹åŠ¨è¿”å› false å‘Šè¯‰ React è¿™æ¬¡ä¸å¿…æ›´æ–°, å¦å¤–ä¸è¦åœ¨è¿™é‡Œè¿›è¡Œæ·±åº¦æ£€æŸ¥(å¦‚: æ·±æ‹·è´) ä¼šéå¸¸æ¶ˆè€—æ€§èƒ½.</p></li><li><p>componentWillUpdate(nextProps, nextState)<br>è¯¥å‡½æ•°åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ä¸ä¼šè¢«è°ƒç”¨, ä¼šåœ¨æ”¶åˆ° <code>nextProps</code> æˆ– <code>nextState</code> ä¹‹ååœ¨æ›´æ–°æ¸²æŸ“ä¹‹å‰è¢«ç«‹å³è°ƒç”¨. éœ€è¦ä¸»è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä¸èƒ½ä½¿ç”¨ <code>setState()</code>, å¦‚æœéœ€è¦ç”¨ state å“åº” props çš„å˜åŒ–, æ”¹ç”¨ <code>componentWillReceiveProps()</code>.</p></li><li><p>render()</p></li><li><p>componentDidUpdate(prevProps, prevState)<br>ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ä¸ä¼šè°ƒç”¨, åœ¨æ›´æ–°å‘ç”Ÿåç«‹å³è¢«è°ƒç”¨</p></li></ul></li><li><p>Unmounting(å¸è½½): ç»„ä»¶ä» DOM ä¸Šåˆ é™¤</p><ul><li>componentWillUnmount()<br>åœ¨ç»„ä»¶è¢«å¸è½½æˆ–è€…é”€æ¯ä¹‹å‰è°ƒç”¨, åœ¨è¿™é‡Œé€šå¸¸ç”¨æ¥å–æ¶ˆä¸€äº›è®¢é˜….</li></ul></li></ol><p>ä¸ªäººè§‰å¾— React çš„ç”Ÿå‘½å‘¨æœŸé’©å­åå­—è¦æ¯” Vue çš„å¥½ç†è§£ä¸€ç‚¹, èµ·ç ä¸€çœ‹åå­—å°±çŸ¥é“æ˜¯å•¥.</p><p><strong>å…¶ä»– API</strong></p><ul><li><p>setState(): åªæ˜¯ä¸€ä¸ªè¯·æ±‚è€Œä¸æ˜¯ç«‹å³å‘½ä»¤æ¥æ›´æ–°ç»„ä»¶, æ‰€ä»¥å¹¶ä¸æ€»æ˜¯ç«‹å³æ›´æ–°. å¦‚æœéœ€è¦åœ¨ <code>setState()</code> ä¹‹åç«‹å³è¯»å– <code>this.state</code>, éœ€è¦ä½¿ç”¨ <code>componentDidUpdate</code> æˆ–è€… <code>setState(updater, callback)</code>.(setState() çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å¯¹è±¡, ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°ä¸ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•°ä¼šä¿è¯ prevState, props æ˜¯æœ€æ–°çš„, ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ callback</span></span><br><span class="line"><span class="comment">// callback ä¼šåœ¨ setState å®Œæˆåæ‰§è¡Œå¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">prevState, props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">count</span>: prevState.count + props.increment &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åˆ° callback çš„è¯, å»ºè®®ä½¿ç”¨ componentDidUpdate()</span></span><br></pre></td></tr></table></figure></li><li><p>defaultProps: ä¸ºç±»è®¾ç½®é»˜è®¤çš„ props.<br>ä½¿ç”¨ä¸‹é¢çš„ç»„ä»¶æ—¶ä¸ä¼ å…¥ <code>props.color</code>, ä»–å°±ä¼šè¢«è®¾ç½®ä¸º <code>&#39;blue&#39;</code>. å¦‚æœè¢«æ‰‹åŠ¨è®¾ç½®ä¸º null é‚£å®ƒä¼šä¿æŒä¸º null</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ball</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ball.defaultProps = &#123;</span><br><span class="line">  color: <span class="string">'blue'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨æ—¶, color å°†ä¿æŒä¸º null</span></span><br><span class="line">render () &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Ball</span> <span class="attr">color</span>=<span class="string">&#123;null&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>state çš„æ³¨æ„äº‹é¡¹</strong></p><ul><li>state æ˜¯ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€, å¦‚æœä¸åœ¨ <code>render()</code> ä¸­ä½¿ç”¨é‚£å®ƒå°±ä¸åº”è¯¥æ˜¯ <code>state</code>. æ°¸è¿œä¸è¦ç›´æ¥æ”¹å˜ <code>state</code></li><li>æ•°æ®å‘ä¸‹æµåŠ¨, ä¸€ä¸ªç»„ä»¶çš„ state å¯ä»¥å‘ä¸‹ä¼ é€’ä½œä¸ºå­ç»„ä»¶çš„ props, ä¹Ÿå°±æ˜¯å¸¸è¯´çš„å•å‘æ•°æ®æµ.</li></ul><p>created on 2018-06-18</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å­¦ä¹  React å·²ç»æ˜¯å¾ˆæ—©å°±æœ‰çš„æƒ³æ³•äº†, å› ä¸ºä¹‹å‰çš„å·¥ä½œä¸€ç›´æ¥è§¦çš„éƒ½æ˜¯ &lt;code&gt;Vue.js&lt;/code&gt; å¹¶ä¸”çŸ¥é“å®ƒä¿©çš„æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™, ä½†åœ¨å†™æ³•ä¸Šè¿˜æ˜¯æœ‰è›®å¤§åŒºåˆ«çš„. åœ¨æåˆ° &lt;code&gt;Vue&lt;/code&gt; çš„åœ°æ–¹ä¹Ÿæ€»æ˜¯ä¼´éšç€ &lt;code&gt;React&lt;/code&gt;
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
      <category term="React" scheme="https://yoursite.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œæ‘„åƒæœºç›´æ’­</title>
    <link href="https://yoursite.com/2018/05/06/%E7%BD%91%E7%BB%9C%E6%91%84%E5%83%8F%E6%9C%BA%E7%9B%B4%E6%92%AD/"/>
    <id>https://yoursite.com/2018/05/06/ç½‘ç»œæ‘„åƒæœºç›´æ’­/</id>
    <published>2018-05-06T06:49:04.000Z</published>
    <updated>2018-06-18T15:40:04.651Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºç½‘ç»œæ‘„åƒæœºåšè§†é¢‘é¢„è§ˆè¿™å—, æœ¬èº«å…¶å®æ˜¯éå¸¸é™Œç”Ÿçš„, å½“æ—¶æ¥åˆ°è¿™ä¸ªéœ€æ±‚ä¹Ÿæ˜¯ç›¸å½“çš„å¤´ç–¼(å¯¹äºå½“æ—¶ä¸€å¹´ç»éªŒä¸åˆ°çš„æˆ‘æ¥è¯´).å½“æ—¶æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯æ˜¯: å¤šè·¯ç½‘ç»œæ‘„åƒæœºé€šè¿‡å±€åŸŸç½‘è¿æ¥, PC ç«¯èƒ½å¤Ÿå®æ—¶é¢„è§ˆç›‘æ§ç”»é¢å¹¶ä¸”ç”»è´¨è¾¾åˆ°720p, å»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’, å¤šä¸ªæ‘„åƒæœºèƒ½å¤Ÿåˆ‡æ¢æŸ¥çœ‹. ç”±äºåç«¯åªæä¾›ä¸€ä¸ª RTSP çš„ç›´æ’­åè®®, æ‰€ä»¥æ‰€æœ‰çš„æ–¹æ¡ˆéƒ½æ˜¯å›´ç»•ç€ RTSP è¿™ä¸ªå…³é”®è¯.</p><blockquote><p> å½“æ—¶æ—¶é—´å¾ˆèµ¶æ‰€ä»¥è¦è‡ªå·±æ…¢æ…¢ç ”ç©¶æ˜¯ä¸å¯èƒ½äº†, åªèƒ½å»æ‰¾ç°æˆçš„åº“. ç°ç›®å‰ç”¨è¿‡ä¸‰ç§æ–¹æ¡ˆ, éƒ½ä¸å®Œç¾.</p></blockquote><h3 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h3><p>ç»è¿‡ä¸€æ³¢è°ƒç ”(google)ä¹‹å, çŸ¥é“æµè§ˆå™¨å¯¹ RTSP åè®®å¹¶ä¸å‹å¥½, ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»è¦è‡ªå·±è½¬ç å†æä¾›ç»™æµè§ˆå™¨ä½¿ç”¨, æ‰¾åˆ°çš„è§£å†³æ€è·¯å¤§æ¦‚æ˜¯:</p><ol><li>è½¬ç : <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> æ˜¯ä¸€ä¸ªè€ç‰Œçš„è½¬ç å·¥å…·, éå¸¸å¼ºå¤§</li><li>Node.js ç”¨ä½œä¸­è½¬ç«™æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„æ‘„åƒæœºä¿¡æ¯åŠæ§åˆ¶ FFmpeg æ¨æµ</li><li>æœ€ç»ˆå®¢æˆ·ç«¯æ¥æ”¶è§†é¢‘æµ</li></ol><p>ä¸‹é¢æˆ‘è¯•è¿‡çš„ä¸‰ç§æ–¹æ¡ˆ, åŸºæœ¬ç»“æ„éƒ½å¦‚æ­¤åªæ˜¯æ¨æµçš„æ–¹å¼å’Œå®¢æˆ·ç«¯çš„æ¥æ”¶æ–¹å¼æœ‰æ‰€ä¸åŒ.</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p><strong>å®‰è£… FFmpeg è½¬ç å·¥å…·</strong></p><ul><li>window å¹³å°</li></ul><ol><li><a href="http://ffmpeg.zeranoe.com/builds/" target="_blank" rel="noopener">ä¸‹è½½ FFmpeg</a> è§£å‹ååº”è¯¥æ˜¯å·²ç»ç¼–è¯‘å¥½çš„æ–‡ä»¶</li><li>å°†è§£å‹å¥½çš„æ–‡ä»¶æ”¾å…¥ C ç›˜æ ¹ç›®å½•(ä¹Ÿå¯ä»¥è‡ªè¡Œæ”¾å…¥å…¶ä»–ç›˜ç¬¦)ä¸‹é‡å‘½åä¸º ffmpeg(æ–¹ä¾¿ä»¥åæ‰¾)</li><li>è®¾ç½®ç¯å¢ƒå˜é‡, æˆ‘çš„ç”µè„‘ -&gt; å±æ€§ -&gt; é«˜çº§ç³»ç»Ÿè®¾ç½® -&gt; ç¯å¢ƒå˜é‡ -&gt; ç³»ç»Ÿå˜é‡ -&gt; æ–°å¢, è·¯å¾„é€‰æ‹©åˆšåˆš C ç›˜ä¸‹çš„ ffmpegæ–‡ä»¶å¤¹ä¸­çš„ bin æ–‡ä»¶å¤¹</li><li>æ³¨é”€æˆ–é‡å¯ç”µè„‘è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</li><li>æµ‹è¯•, åœ¨ cmd ä¸­è¾“å…¥ <code>ffmpeg -version</code>,  å¦‚æœå‡ºç°ç‰ˆæœ¬å·ä¹‹ç±»çš„ä¸œè¥¿åˆ™æˆåŠŸ.</li></ol><ul><li>Mac å¹³å°<br>Mac ä¸‹å¯ä»¥ç›´æ¥é€šè¿‡ <code>Homebrew</code> å®‰è£…æœ€ä¸ºç®€å•.</li></ul><ol><li>å®‰è£… <code>Homebrew</code>, åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></li><li>å®‰è£… FFmpeg, ç›´æ¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>brew install ffmpeg</code> å³å¯</li><li>æµ‹è¯•, åŒæ ·åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>ffmpeg -version</code> æŸ¥çœ‹ç‰ˆæœ¬å·</li></ol><p><strong>å®‰è£… Node.js</strong><br>è¿™ä¸ªå°±ä¸å±•å¼€è¯¦ç»†è¯´äº†, æ¯ä¸ªå‰ç«¯éƒ½æœ‰å§â€¦</p><h3 id="æ–¹æ¡ˆä¸€-img-æ ‡ç­¾"><a href="#æ–¹æ¡ˆä¸€-img-æ ‡ç­¾" class="headerlink" title="æ–¹æ¡ˆä¸€: img æ ‡ç­¾"></a>æ–¹æ¡ˆä¸€: img æ ‡ç­¾</h3><p>å½“æ—¶æƒ³åˆ°çš„ç¬¬ä¸€ç§æ–¹æ¡ˆä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆ, æ˜¯å°†è§†é¢‘æµçš„æ¯ä¸€å¸§è½¬åŒ–ä¸º base64 å†é€šè¿‡åŠ¨æ€æ›¿æ¢ <code>&lt;img&gt;</code> çš„ src å±æ€§æ¥è¾¾åˆ°é¢„è§ˆçš„æ•ˆæœ.ä¸­é—´ç”¨åˆ°äº†<a href="https://github.com/agsh/rtsp-ffmpeg" target="_blank" rel="noopener">rtsp-ffmpeg</a>, è¿™ä¸ªåº“çš„æ€è·¯æ˜¯é€šè¿‡ websocket å‘é€æ¯ä¸€å¸§è§†é¢‘çš„ bytes åˆ°å®¢æˆ·ç«¯, å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ <code>&lt;img&gt;</code> æ ‡ç­¾æ¥å±•ç¤º.</p><p><strong>ç¤ºä¾‹:</strong></p><p>node ç«¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)()</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app)</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server)</span><br><span class="line"><span class="keyword">const</span> rtsp = <span class="built_in">require</span>(<span class="string">'rtsp-ffmpeg'</span>)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8081</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server listening on 8081'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// uri ä»¥æµ·åº·æ‘„åƒæœºçš„ rtsp åè®®ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">let</span> uri = <span class="string">'rtps://admin:password@ip:port/h264/ch1/sub/av_stream'</span></span><br><span class="line"><span class="keyword">let</span> stream = <span class="keyword">new</span> rtsp.FFMpeg(&#123;</span><br><span class="line">    input: uri,</span><br><span class="line">    resolution: <span class="string">'1080x720'</span>,</span><br><span class="line">    quality: <span class="number">3</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'stop'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream stopped'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> pipeStream = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        socket.emit(<span class="string">'data'</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">    stream.on(<span class="string">'data'</span>, pipeStream)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡æ¢æ‘„åƒæœº</span></span><br><span class="line">    socket.on(<span class="string">'URI'</span>, data =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        uri = <span class="string">`rtsp://<span class="subst">$&#123;data.userName&#125;</span>:<span class="subst">$&#123;data.passWord&#125;</span>@<span class="subst">$&#123;data.ip&#125;</span>:<span class="subst">$&#123;data.port&#125;</span>/h264/ch1/sub/av_stream`</span></span><br><span class="line">        stream.input = uri</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡å¯</span></span><br><span class="line">        stream.restart()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span> () =&gt; &#123;</span><br><span class="line">        stream.removeListener(<span class="string">'data'</span>, pipeStream)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å®¢æˆ·ç«¯<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">'img'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'/socket.io/socket.io.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> io = io();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> img = <span class="built_in">document</span>.querySelector(<span class="string">'#img'</span>)</span></span><br><span class="line"><span class="javascript">io.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> bytes = <span class="keyword">new</span> Unit8Array(data)</span></span><br><span class="line"><span class="javascript">        img.src = <span class="string">'data:image/jpeg;base64,'</span> + base64ArrayBuffer(bytes)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// byte æ•°ç»„è½¬ base64 (è¿™æ®µæ˜¯åœ¨å…¶ä»–åœ°æ–¹æŠ„çš„)</span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">base64ArrayBuffer</span>(<span class="params">arrayBuffer</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> base64    = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> encodings = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> bytes         = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> byteLength    = bytes.byteLength;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> byteRemainder = byteLength % <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> mainLength    = byteLength - byteRemainder;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> a, b, c, d;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> chunk;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Main loop deals with bytes in chunks of 3</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; mainLength; i = i + <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Combine the three bytes into a single integer</span></span></span><br><span class="line"><span class="undefined">chunk = (bytes[i] &lt;&lt; 16) | (bytes[i + 1] &lt;&lt; 8) | bytes[i + 2];</span></span><br><span class="line"><span class="javascript"><span class="comment">// Use bitmasks to extract 6-bit segments from the triplet</span></span></span><br><span class="line"><span class="javascript">a = (chunk &amp; <span class="number">16515072</span>) &gt;&gt; <span class="number">18</span>; <span class="comment">// 16515072 = (2^6 - 1) &lt;&lt; 18</span></span></span><br><span class="line"><span class="javascript">b = (chunk &amp; <span class="number">258048</span>)   &gt;&gt; <span class="number">12</span>; <span class="comment">// 258048   = (2^6 - 1) &lt;&lt; 12</span></span></span><br><span class="line"><span class="javascript">c = (chunk &amp; <span class="number">4032</span>)     &gt;&gt;  <span class="number">6</span>; <span class="comment">// 4032     = (2^6 - 1) &lt;&lt; 6</span></span></span><br><span class="line"><span class="javascript">d = chunk &amp; <span class="number">63</span>;               <span class="comment">// 63       = 2^6 - 1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// Convert the raw binary segments to the appropriate ASCII encoding</span></span></span><br><span class="line"><span class="undefined">base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Deal with the remaining bytes and padding</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span> (byteRemainder == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="undefined">chunk = bytes[mainLength];</span></span><br><span class="line"><span class="javascript">a = (chunk &amp; <span class="number">252</span>) &gt;&gt; <span class="number">2</span>; <span class="comment">// 252 = (2^6 - 1) &lt;&lt; 2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// Set the 4 least significant bits to zero</span></span></span><br><span class="line"><span class="javascript">b = (chunk &amp; <span class="number">3</span>)   &lt;&lt; <span class="number">4</span>; <span class="comment">// 3   = 2^2 - 1</span></span></span><br><span class="line"><span class="javascript">base64 += encodings[a] + encodings[b] + <span class="string">'=='</span>;</span></span><br><span class="line"><span class="javascript">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (byteRemainder == <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="undefined">chunk = (bytes[mainLength] &lt;&lt; 8) | bytes[mainLength + 1];</span></span><br><span class="line"><span class="javascript">a = (chunk &amp; <span class="number">64512</span>) &gt;&gt; <span class="number">10</span>; <span class="comment">// 64512 = (2^6 - 1) &lt;&lt; 10</span></span></span><br><span class="line"><span class="javascript">b = (chunk &amp; <span class="number">1008</span>)  &gt;&gt;  <span class="number">4</span>; <span class="comment">// 1008  = (2^6 - 1) &lt;&lt; 4</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// Set the 2 least significant bits to zero</span></span></span><br><span class="line"><span class="javascript">c = (chunk &amp; <span class="number">15</span>)    &lt;&lt;  <span class="number">2</span>; <span class="comment">// 15    = 2^4 - 1</span></span></span><br><span class="line"><span class="javascript">base64 += encodings[a] + encodings[b] + encodings[c] + <span class="string">'='</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">return</span> base64;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>è¿™ç§é€šè¿‡ img çš„æ–¹å¼æš´éœ²å‡ºçš„é—®é¢˜æ˜¯éœ€è¦åœ¨å‰ç«¯è§£ç , å¯¼è‡´ä¸‹ä¸€å¸§åˆ°æ¥æ—¶ä¸Šä¸€å¸§çš„ç”»é¢è¿˜æ²¡è§£ç å®Œæˆ. å°±ä¼šæœ‰èŠ±å±ç”šè‡³ç”»é¢åªæ˜¾ç¤ºä¸€åŠçš„é—®é¢˜å’Œå»¶è¿Ÿè¾ƒå¤§ä¸”å»¶è¿Ÿä¼šç´¯ç§¯, åœ¨æ§åˆ¶å°ä¸­ä½ ä¼šçœ‹åˆ°ç–¯ç‹‚åˆ·ä»å†…å­˜æ¥çš„è¯·æ±‚, å¦‚æœä½ æƒ³çœ‹çœ‹ http è¯·æ±‚å¯èƒ½ä¼šç–¯. æ‰€ä»¥è¿™ç§æ–¹å¼è‚¯å®šä¸è¡Œ</p><p>è¿™ä¸ª <code>rtsp-ffmpeg</code> è¿˜æä¾›ä¸€ç§ canvas çš„æ–¹å¼, åªæ˜¯åœ¨å®¢æˆ·ç«¯åšä¸€äº›ä¿®æ”¹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> io = io();</span><br><span class="line"><span class="comment">// æŠŠä¹‹å‰çš„ img æ ‡ç­¾æ¢æˆ canvas</span></span><br><span class="line"><span class="keyword">let</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">'#canvas'</span>)</span><br><span class="line">io.on(<span class="string">'data'</span>, data =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> bytes = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([bytes], &#123;<span class="attr">type</span>: <span class="string">'application/octet-binary'</span>&#125;)</span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">var</span> url = URL.createObjectURL(blob)</span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image</span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>)</span><br><span class="line">        img.width = img.width * <span class="number">0.5</span></span><br><span class="line">        img.height = img.height * <span class="number">0.5</span></span><br><span class="line">        img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            URL.revokeObjectURL(url)</span><br><span class="line">            ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1080</span>, <span class="number">720</span>)</span><br><span class="line">        &#125;;    </span><br><span class="line">    img.src = url</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ç”¨ canvas çš„æ–¹æ³•è™½ç„¶æ¯” img çš„æ•ˆæœå¥½ä¸€ç‚¹, ä½†æ˜¯æœ€ç»ˆæ•ˆæœä»ç„¶æ˜¯ä¸å°½äººæ„. å›¾åƒå¾ˆä¸ç¨³å®š, è¡¨ç°ä¸ºä¸€åŠç”»é¢ä¸€åŠç»¿å±, å¦‚æœè§†é¢‘ä¸­å›¾åƒå˜æ¢å‰§çƒˆçš„è¯è¡¨ç°ä¼šæ›´å·®, æ‰€ä»¥è¿™ç§æ–¹æ³•ä¹Ÿä¸å¤ªè¡Œ. å…¶å®åœ¨è¿™ä¸­é—´æˆ‘å¹¶æ²¡æœ‰åšä»€ä¹ˆæ“ä½œåªæ˜¯å°†è¿™ä¸ª demo é›†æˆåœ¨äº† vue ä¸­, å†åŠ ä¸Šå¤šæ‘„åƒæœºçš„åˆ‡æ¢å’Œä¸»æµæ‘„åƒæœºå‚å•†çš„æ”¯æŒ(å› ä¸ºæ¯ä¸ªæ‘„åƒæœºå‚å•†çš„ rtsp åè®®çš„ç»“æ„ä¸ä¸€æ ·)è€Œå·², æ‰€ä»¥ç¬¬ä¸€æƒ³æ³•æ˜¯èƒ½ä¸èƒ½åœ¨è§£ç è¿™å—æ‰¾åˆ°æ›´å¥½è§£å†³åŠæ³•, äºæ˜¯åˆæ‰¾åˆ°äº†å¦ä¸€ä¸ªåº“ <a href="https://github.com/phoboslab/jsmpeg" target="_blank" rel="noopener">jsmpeg</a> æ–¹æ¡ˆäºŒå°±æ¥äº†.</p><h3 id="æ–¹æ¡ˆäºŒ-jsmpeg"><a href="#æ–¹æ¡ˆäºŒ-jsmpeg" class="headerlink" title="æ–¹æ¡ˆäºŒ: jsmpeg"></a>æ–¹æ¡ˆäºŒ: jsmpeg</h3><p>è¿™ä¸ªåº“è¿˜ç®—æ¯”è¾ƒä¸é”™çš„äº†, ä¹Ÿæ˜¯é€šè¿‡ websocket æ¥è½¬å‘, çœ‹å®˜æ–¹çš„ä¾‹å­æ˜¯åœ¨ç»ˆç«¯ä¸­å¯åŠ¨ ffmpeg -&gt; websocket -&gt; å®¢æˆ·ç«¯é€šè¿‡ <code>jsmpeg.min.js</code> è§£ç åœ¨ canvas ä¸­æ’­æ”¾. å› ä¸ºè¿™é‡Œåªæ˜¯å®ç°äº†æ’­æ”¾, åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæˆ‘ä»¬è¿˜éœ€è¦åœ¨è„šæœ¬ä¸­è‡ªå¯ ffmpeg / åˆ‡æ¢/ é‡å¯, ç„¶ååˆå»æ‰¾äº†ä¸€ä¸ªåŸºäº <code>jsmpeg</code> çš„åº“ <a href="https://github.com/kyriesent/node-rtsp-stream" target="_blank" rel="noopener">node-rtsp-stream</a>. è¿™ä¸ªåº“åªæ˜¯åšäº†ä¸€äº›å°è£…è®©æˆ‘ä»¬ä¸ç”¨è‡ªå·±åœ¨ç»ˆç«¯ä¸­æ‰‹åŠ¨å¯ç”¨ ffmpeg, åœ¨æ­¤ä¹‹ä¸Šæˆ‘å†åŠ ä¸Šé‡å¯å°±èƒ½æ»¡è¶³ç°åœ¨çš„éœ€æ±‚.</p><p><strong>ç¤ºä¾‹:</strong></p><ol><li>æ”¹é€  <code>node-rtsp-stream</code></li></ol><p>node-rtsp-stream/videoStream.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Mpeg1Muxer, STREAM_MAGIC_BYTES, VideoStream, events, util, ws;</span><br><span class="line"></span><br><span class="line">    ws = <span class="built_in">require</span>(<span class="string">'ws'</span>);</span><br><span class="line"></span><br><span class="line">    util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line">    events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line">    Mpeg1Muxer = <span class="built_in">require</span>(<span class="string">'./mpeg1muxer'</span>);</span><br><span class="line"></span><br><span class="line">    STREAM_MAGIC_BYTES = <span class="string">"jsmp"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line">    VideoStream = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = options.name;</span><br><span class="line">        <span class="keyword">this</span>.streamUrl = options.streamUrl;</span><br><span class="line">        <span class="keyword">this</span>.width = options.width;</span><br><span class="line">        <span class="keyword">this</span>.height = options.height;</span><br><span class="line">        <span class="keyword">this</span>.wsPort = options.wsPort;</span><br><span class="line">        <span class="keyword">this</span>.inputStreamStarted = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.stream = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.startMpeg1Stream();</span><br><span class="line">        <span class="keyword">this</span>.pipeStreamToSocketServer();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    util.inherits(VideoStream, events.EventEmitter);</span><br><span class="line">    <span class="comment">// åœæ­¢è§†é¢‘æµ</span></span><br><span class="line">    VideoStream.prototype.stop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.mpeg1Muxer) &#123;</span><br><span class="line">            <span class="keyword">this</span>.mpeg1Muxer.stream.stop()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡å¯è§†é¢‘æµ</span></span><br><span class="line">    VideoStream.prototype.restart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.mpeg1Muxer) &#123;</span><br><span class="line">            <span class="keyword">this</span>.mpeg1Muxer.stream.stop()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'ffmpeg is restart'</span>)</span><br><span class="line">            <span class="keyword">this</span>.inputStreamStarted = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.stream = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">this</span>.startMpeg1Stream();</span><br><span class="line">            <span class="comment">// ç›‘å¬ ffmpeg è¿›ç¨‹æ˜¯å¦å…³é—­</span></span><br><span class="line">            <span class="keyword">this</span>.mpeg1Muxer.on(<span class="string">'ffmpegClose'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'ffmpeg closed on '</span> + code)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VideoStream.prototype.startMpeg1Stream = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// çœç•¥æ‰“å¼€æµçš„æ–¹æ³•, è¿™éƒ¨åˆ†æ²¡æœ‰åšæ”¹åŠ¨</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    VideoStream.prototype.pipeStreamToSocketServer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å°†æµå¡ç»™ socket, åŒæ ·ä¹Ÿæ²¡æ”¹</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    VideoStream.prototype.onSocketConnect = <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self, streamHeader;</span><br><span class="line">        self = <span class="keyword">this</span>;</span><br><span class="line">        streamHeader = <span class="keyword">new</span> Buffer(<span class="number">8</span>);</span><br><span class="line">        streamHeader.write(STREAM_MAGIC_BYTES);</span><br><span class="line">        streamHeader.writeUInt16BE(<span class="keyword">this</span>.width, <span class="number">4</span>);</span><br><span class="line">        streamHeader.writeUInt16BE(<span class="keyword">this</span>.height, <span class="number">6</span>);</span><br><span class="line">        socket.send(streamHeader, &#123;</span><br><span class="line">            binary: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">console</span>.log((<span class="string">""</span> + <span class="keyword">this</span>.name + <span class="string">": New WebSocket Connection ("</span>) + <span class="keyword">this</span>.wsServer.clients.length + <span class="string">" total)"</span>);</span><br><span class="line">        <span class="keyword">return</span> socket.on(<span class="string">"close"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code, message</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.log((<span class="string">""</span> + <span class="keyword">this</span>.name + <span class="string">": Disconnected WebSocket ("</span>) + self.wsServer.clients.length + <span class="string">" total)"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>.exports = VideoStream;</span><br><span class="line"></span><br><span class="line">&#125;).call(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p><p>node-rtsp-stream/videoStream.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Mpeg1Muxer, child_process, events, util;</span><br><span class="line"></span><br><span class="line">    child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line">    util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line">    events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line">    Mpeg1Muxer = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self;</span><br><span class="line">        self = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>.url = options.url;</span><br><span class="line">        <span class="keyword">this</span>.stream = child_process.spawn(<span class="string">"ffmpeg"</span>, </span><br><span class="line">            [</span><br><span class="line">                <span class="string">"-rtsp_transport"</span>,</span><br><span class="line">                <span class="string">"tcp"</span>,</span><br><span class="line">                <span class="string">"-i"</span>,</span><br><span class="line">                <span class="keyword">this</span>.url,</span><br><span class="line">                <span class="string">'-s'</span>, </span><br><span class="line">                <span class="comment">// å›¾åƒå®½é«˜</span></span><br><span class="line">                <span class="string">`<span class="subst">$&#123;options.width&#125;</span>x<span class="subst">$&#123;options.height&#125;</span>`</span>, </span><br><span class="line">                <span class="string">'-f'</span>, </span><br><span class="line">                <span class="string">'mpeg1video'</span>, </span><br><span class="line">                <span class="string">'-b:v'</span>, </span><br><span class="line">                <span class="string">'800k'</span>, </span><br><span class="line">                <span class="string">'-r'</span>, </span><br><span class="line">                <span class="string">'30'</span>, </span><br><span class="line">                <span class="string">'-'</span></span><br><span class="line">            ], </span><br><span class="line">            &#123;</span><br><span class="line">                detached: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">this</span>.inputStreamStarted = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.stream.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.emit(<span class="string">'mpeg1data'</span>, data);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>.stream.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.emit(<span class="string">'ffmpegError'</span>, data);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// kill ffmpeg</span></span><br><span class="line">        <span class="keyword">this</span>.stream.stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// console.log(self.stream.pid)</span></span><br><span class="line">            self.stream.stdin.pause();</span><br><span class="line">            self.stream.kill()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'ffmpeg is be kill'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// ç›‘å¬ ffmpeg é€€å‡º</span></span><br><span class="line">        <span class="keyword">this</span>.stream.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.emit(<span class="string">'ffmpegClose'</span>, code)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    util.inherits(Mpeg1Muxer, events.EventEmitter);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>.exports = Mpeg1Muxer;</span><br><span class="line"></span><br><span class="line">&#125;).call(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p><ol start="2"><li>node ç«¯ä½¿ç”¨</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)()</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app)</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server)</span><br><span class="line"><span class="comment">// å¼•å…¥æ”¹é€ åçš„ node-rtsp-stream</span></span><br><span class="line"><span class="keyword">const</span> Rtsp = <span class="built_in">require</span>(<span class="string">'./node-rtsp-stream'</span>)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8081</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server listening on 8081'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// uri ä»¥æµ·åº·æ‘„åƒæœºçš„ rtsp åè®®ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">let</span> uri = <span class="string">'rtps://admin:password@ip:port/h264/ch1/sub/av_stream'</span></span><br><span class="line"><span class="keyword">let</span> stream = <span class="keyword">new</span> Rtsp(&#123;</span><br><span class="line">    name: <span class="string">'rtsp_stream'</span>,</span><br><span class="line">    streamUrl: uri,</span><br><span class="line">    wsPort: <span class="number">11111</span>,</span><br><span class="line">    width: <span class="number">720</span>,</span><br><span class="line">    height: <span class="number">405</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'stop'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream stopped'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> pipeStream = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        socket.emit(<span class="string">'data'</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">    stream.on(<span class="string">'data'</span>, pipeStream)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡æ¢æ‘„åƒæœº</span></span><br><span class="line">    socket.on(<span class="string">'URI'</span>, data =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        uri = <span class="string">`rtsp://<span class="subst">$&#123;data.userName&#125;</span>:<span class="subst">$&#123;data.passWord&#125;</span>@<span class="subst">$&#123;data.ip&#125;</span>:<span class="subst">$&#123;data.port&#125;</span>/h264/ch1/sub/av_stream`</span></span><br><span class="line">        stream.streamUrl = uri;</span><br><span class="line">        <span class="comment">// é‡å¯</span></span><br><span class="line">        stream.restart()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span> () =&gt; &#123;</span><br><span class="line">        stream.removeListener(<span class="string">'data'</span>, pipeStream)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>å®¢æˆ·ç«¯</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">'can'</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'jsmpeg.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">'#can'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://127.0.0.1:11111'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> player = <span class="keyword">new</span> jsmpeg(ws, &#123;</span></span><br><span class="line"><span class="undefined">        canvas: canvas,</span></span><br><span class="line"><span class="javascript">        autoplay: <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ¡ˆå…¶å®ä½¿ç”¨äº†å¾ˆä¹…ä¸€ç›´éƒ½æ²¡å‘ç°é—®é¢˜, ä¹Ÿæ²¡æœ‰å‡ºç°è¿‡èŠ±å±å»¶è¿Ÿç´¯è®¡çš„æƒ…å†µ. ä½†æ˜¯åœ¨ä¸€è·¯æ‘„åƒæœºå®‰ç½®åœ¨å¤©æ¡¥é™„è¿‘äººæµé‡å‰§å¢, ä¸è¿™ä¸ªè§†é¢‘é¢„è§ˆåŒä¸€é¡µé¢è¿˜æœ‰ä¸€ä¸ªäººè„¸å®æ—¶æŠ“æ‹çš„å³æ—¶æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½, å¯¼è‡´åœ¨20 - 30åˆ†é’Ÿæµè§ˆå™¨ç›´æ¥å‡æ­»æˆ–è€…å´©æºƒ.(ç„¶åè¿™ä¸ªæ–¹æ¡ˆåˆå‡‰äº†ğŸ˜‚)</p><h3 id="æ–¹æ¡ˆä¸‰-FFmpeg-Nginx-video-js"><a href="#æ–¹æ¡ˆä¸‰-FFmpeg-Nginx-video-js" class="headerlink" title="æ–¹æ¡ˆä¸‰: FFmpeg + Nginx + video.js"></a>æ–¹æ¡ˆä¸‰: FFmpeg + Nginx + video.js</h3><p>åœ¨ç»è¿‡ä¸¤æ¬¡å®éªŒ + å¤±è´¥ä¹‹åæ‰¾åˆ°ä¸€ä¸ªè¾ƒä¸ºå¤§ä¼—çš„è§£å†³æ–¹å¼, å‰ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯é€šè¿‡åº“ç›´æ¥ä½¿ç”¨ rtsp è½¬æˆ bytes æä¾›ç»™å¤–éƒ¨ä½¿ç”¨, è€Œæ–¹æ¡ˆä¸‰çš„æµç¨‹å¦‚ä¸‹:</p><ul><li>Node ä½¿ç”¨ <a href="https://github.com/fluent-ffmpeg/node-fluent-ffmpeg" target="_blank" rel="noopener">fluent-ffmpeg</a> è°ƒæ•´å‚æ•°å¯åŠ¨ FFmpeg</li><li>FFmpeg è´Ÿè´£ç¼–ç å†è§£ç åè½¬ä¸º RTMP åè®®</li><li>Node å°†æµæ¨åˆ° Nginx (nginx éœ€è¦å®‰è£… <a href="https://github.com/arut/nginx-rtmp-module#example-nginxconf" target="_blank" rel="noopener">nginx-rtmp-modules</a> æ’ä»¶)</li><li>å®¢æˆ·ç«¯ä½¿ç”¨ Video.js è®¿é—® Nginx é…ç½®çš„è¿æ¥å¹¶æ’­æ”¾è§†é¢‘</li></ul><p>åœ¨è¿™ä¸ªé˜¶æ®µåˆé‡åˆ°äº†ä¸åŒå‚å•†çš„æ‘„åƒæœº, åœ¨åŒä¸€åè®®ä¸‹ä¸èƒ½æ­£å¸¸è¿ä½œ, åœ¨æ­¤ä¹Ÿè®°å½•ä¸€ä¸‹å„å‚å•†çš„ rtsp åè®®</p><ul><li>æµ·åº·å¨è§†: rtps://admin:password@ip:port/h264/ch1/sub/av_stream</li><li>å¤§å: rtps://admin:password@ip:port/cam/realmonitor?channel=1&amp;subtype=0</li><li>å¤©åœ°ä¼Ÿä¸š: rtps://admin:password@ip:port/1/1</li><li>ç§‘è¾¾: rtps://admin:password@ip:port/id=1</li><li>åæ˜“æ˜æ–°: rtps://admin:password@ip:port/ch3</li></ul><p><strong>ç¤ºä¾‹:</strong></p><p>node ç«¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uri = <span class="string">'rtps://admin:password@ip:port/h264/ch1/sub/av_stream'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FFMpeg å‘½ä»¤å‚æ•°è®¾ç½®</span></span><br><span class="line"><span class="comment">// ffmpeg - i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -fflags nobuffer -vcodec libx264 </span></span><br><span class="line"><span class="comment">// -preset superfast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span></span><br><span class="line"><span class="keyword">let</span> ffmpeg = <span class="built_in">require</span>(<span class="string">'fluent-ffmpeg'</span>)</span><br><span class="line"><span class="keyword">let</span> running = <span class="literal">false</span></span><br><span class="line"><span class="keyword">var</span> command = ffmpeg(uri)</span><br><span class="line">    .outputOptions([</span><br><span class="line">        <span class="string">'-fflags'</span>,</span><br><span class="line">        <span class="string">'nobuffer'</span>,</span><br><span class="line">        <span class="string">'-vcodec'</span>,</span><br><span class="line">        <span class="string">'libx264'</span>,</span><br><span class="line">        <span class="string">'-preset'</span>,</span><br><span class="line">        <span class="string">'superfast'</span>,</span><br><span class="line">        <span class="comment">// '-rtsp_transport',</span></span><br><span class="line">        <span class="comment">// 'tcp',</span></span><br><span class="line">        <span class="comment">// '-threads',</span></span><br><span class="line">        <span class="comment">// '4',</span></span><br><span class="line">        <span class="string">'-f'</span>,</span><br><span class="line">        <span class="string">'flv'</span>,</span><br><span class="line">        <span class="string">'-r'</span>,</span><br><span class="line">        <span class="string">'15'</span>,</span><br><span class="line">        <span class="string">'-s'</span>,</span><br><span class="line">        <span class="string">'1280x720'</span>,</span><br><span class="line">        <span class="string">'-an'</span></span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">// æ­¤å¤„çš„ /live/camera, cameraç±»ä¼¼äºä¸€ä¸ªæˆ¿é—´çš„æ¦‚å¿µ, ä½ å¯ä»¥è®¾ç½®ä¸ºä½ æƒ³è¦çš„åå­—</span></span><br><span class="line">    .save(<span class="string">`rtmp://<span class="subst">$&#123; nginxHost &#125;</span>:<span class="subst">$&#123; nginxPort &#125;</span>/live/camera`</span>)</span><br><span class="line">    .on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        running = <span class="literal">true</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stream is start: '</span> + e)</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        running = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ffmpeg is end'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        running = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ffmpeg is error! '</span>+ err)</span><br><span class="line">        reloadStream(uri)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reloadStream = <span class="function">(<span class="params">uri, userAgents</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!uri) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">let</span> userAgent = userAgents</span><br><span class="line">    <span class="keyword">if</span> (running) &#123;</span><br><span class="line">        command.kill()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command._inputs[<span class="number">0</span>]) &#123;</span><br><span class="line">            command._inputs[<span class="number">0</span>].source = uri</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            command.input(uri)</span><br><span class="line">        &#125;</span><br><span class="line">        command.run()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> camFactory = &#123;</span><br><span class="line">    <span class="comment">// æµ·åº·</span></span><br><span class="line">    <span class="string">'0'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'h264/ch1/sub/av_stream'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å¤§å</span></span><br><span class="line">    <span class="string">'1'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'cam/realmonitor?channel=1&amp;subtype=0'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å¤©åœ°ä¼Ÿä¸š</span></span><br><span class="line">    <span class="string">'2'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'1/1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç§‘è¾¾</span></span><br><span class="line">    <span class="string">'3'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'id=1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åæ˜“æ˜æ–°</span></span><br><span class="line">    <span class="string">'4'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'ch3'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'connection'</span>)</span><br><span class="line">    <span class="keyword">let</span> cameraInfo = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (cameraInfo.cameraName) &#123;</span><br><span class="line">        socket.emit(<span class="string">'CameraInfo'</span>, cameraInfo)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–ç½‘ç»œæ‘„åƒå¤´ä¿¡æ¯</span></span><br><span class="line">    socket.on(<span class="string">'URI'</span>, data =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (cameraInfo.cameraName === data.cameraName || cameraInfo.ip === data.ip) <span class="keyword">return</span></span><br><span class="line">        cameraInfo = data</span><br><span class="line">        cameraInfo.factory = data.factory || <span class="string">'0'</span></span><br><span class="line">        uri = <span class="string">`rtsp://<span class="subst">$&#123;data.userName&#125;</span>:<span class="subst">$&#123;data.passWord&#125;</span>@<span class="subst">$&#123;data.ip&#125;</span>:<span class="subst">$&#123;data.RTSP&#125;</span>/<span class="subst">$&#123;camFactory[cameraInfo.factory]()&#125;</span>`</span></span><br><span class="line">        reloadStream(uri, data.userAgent)</span><br><span class="line">        socket.emit(<span class="string">'CameraInfo'</span>, cameraInfo)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, _ =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'disconnect'</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">    socket.on(<span class="string">'end'</span>, _ =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'socket-io end'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    socket.on(<span class="string">'err'</span>, err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>FFmpeg çš„å‚æ•°å¯¹è§†é¢‘æ¨æµçš„ç”»é¢è´¨é‡å’Œå»¶è¿Ÿæœ‰è¾ƒå¤§å½±å“, ä»¥ä¸‹å¯¹æˆ‘ç”¨è¿‡çš„ FFmpeg å‚æ•°ä½œä¸€äº›è¯´æ˜.å¦‚æœä½¿ç”¨æµ·åº·æ‘„åƒæœº rtsp è½¬ rtmp æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>copy</code> å‚æ•°æ€§èƒ½ä¼šæé«˜å¾ˆå¤š, å‰©å»äº† FFmpeg ç¼–ç è§£ç çš„è¿‡ç¨‹. ä¸‹é¢çš„ä¾‹å­æ˜¯å½“æ—¶çš„é¡¹ç›®è¦å…¼å®¹çš„åæ˜“æ˜æ–°çš„æ‘„åƒæœº, æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ <code>copy</code> å‚æ•°</p><p><strong>å»¶è¿Ÿå½±å“ç›¸å…³å‚æ•°(ä»¥ä¸‹æµ‹è¯•éƒ½åœ¨æµ·åº·å¨è§†å’Œåæ˜“æ˜æ–°æ‘„åƒæœºæµ‹è¯•):</strong></p><ol><li><p>fast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -vcodec libx264</span><br><span class="line"> -preset fast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> fast å‚æ•°å»¶è¿Ÿè¡¨ç°è¾ƒä¸ºä¸æ˜æ˜¾</p></li><li><p>superfast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -vcodec libx264</span><br><span class="line"> -preset  superfast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> superfast å‚æ•°è¡¨ç°ä¸º 2-3 ç§’å»¶è¿Ÿ, ä½†æ˜¯ç”»è´¨ä¼šä¸‹é™ä¸€ç‚¹</p></li><li><p>ultrafast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -vcodec libx264</span><br><span class="line"> -preset  ultrafast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> ultrafast å‚æ•°åœ¨æˆ‘å®éªŒä¸­è¡¨ç°è·Ÿ superfast çš„å»¶è¿Ÿå·®è·ä¸æ˜¯ç‰¹åˆ«å¤§, å¤§æ¦‚åœ¨ 1-2 ç§’å·¦å³, ç”»è´¨ä¼šä¸‹é™çš„æ¯”è¾ƒæ˜æ˜¾</p></li><li><p>zerolatency å’Œ ultrafast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -tune zerolatency </span><br><span class="line">-vcodec libx264 -preset  ultrafast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> è®²é“ç†ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é›¶å»¶è¿Ÿ, ä½†æ˜¯æ·»åŠ è¿™ä¸ªå‚æ•°ä¹‹ååœ¨å¤©æ¡¥éƒ¨ç½²çš„æ‘„åƒæœºèŠ±å±ä¼šéå¸¸ä¸¥é‡</p></li><li><p>nobuffer å’Œ superfast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -fflags nobuffer</span><br><span class="line"> -vcodec libx264 -preset  superfast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> nobuffer å‚æ•°è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜, åœ¨ä»¥ä¸Šå®éªŒä¸­åæ˜“æ˜æ–°æ‘„åƒæœºåœ¨è§£ç ä¸­ä¸¢åŒ…éå¸¸ä¸¥é‡, nobuffer å‚æ•°åœ¨è§£ç è·Ÿä¸ä¸Šå‘é€æ—¶æ”¾å¼ƒç¼“å­˜, æ‰€ä»¥æœ€ç»ˆé€‰ç”¨ nobuffer + superfast å‚æ•°è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡çš„çŠ¶æ€. </p></li></ol><p><strong>å…¶ä»–å‚æ•°</strong></p><ul><li><p>rtsp_transport å‚æ•°: ä¼ è¾“æ–¹å¼, tcp/udp ä¸¤ç§, é»˜è®¤ä¸º udp.</p><p>  æœ¬æ¥ udp çš„ä¼ è¾“æ–¹å¼æ›´å¿«æ¶ˆè€—çš„èµ„æºä¹Ÿæ›´å°‘, ä½†æ˜¯é¡¹ç›®ä¸­åè€Œæ”¹æˆ tcp çš„æ–¹å¼æ•ˆæœæ›´å¥½</p></li><li><p>threads å‚æ•°</p><p>  threads ä¹Ÿæ˜¯è®²é“ç†åº”è¯¥æ˜¯è§£ç çº¿ç¨‹æ•°å¤šä¸€ç‚¹æ•ˆæœå¥½, åè€Œé¡¹ç›®ä¸­å°†çº¿ç¨‹æ•°å‡å°‘æ•ˆæœæ›´ä½³</p></li></ul><p>ä»¥ä¸Šä¸¤ä¸ªå‚æ•°æ˜¯æˆ‘æ²¡ç†è§£çš„éƒ¨åˆ†, å½“ç„¶ä¹Ÿå¯èƒ½æ˜¯å½“æ—¶é¡¹ç›®çš„ç¯å¢ƒæœ‰æ‰€å½±å“. è¿™ä¸ªé¡¹ç›®ä¹Ÿæœ‰ä¸€ç‚¹å¥‡æ€ªçš„åœ°æ–¹åœ¨è¿™å„¿ä¸€èµ·è¯´, åœ¨å¯åŠ¨ FFmpeg è½¬ç æ—¶ç”µè„‘ä¼šè“å±. æœ€ç»ˆæ’æŸ¥åˆ°çš„é—®é¢˜æ˜¯: 1. CPU å¯ç”¨æ¶¡è½®åŠ é€Ÿ 2. flash å¼€å¯ç¡¬ä»¶åŠ é€Ÿ 3. ffmpeg ç‰ˆæœ¬ 4. åæ˜“æ˜æ–°æ‘„åƒæœº</p><p>è§£å†³æ–¹æ³•: </p><ol><li>CPU æ¶¡è½®åŠ é€Ÿå…³é—­</li><li>flash å…³é—­ç¡¬ä»¶åŠ é€Ÿ (æ®è¯´æ˜¯ flash æœ¬èº«å®ç°ç¡¬ä»¶åŠ é€Ÿä¸å¥½) </li><li>å°† FFmpeg ç‰ˆæœ¬æ¢è‡³æœ€æ–°</li><li>æ›´æ–°æ‘„åƒæœºç¡¬ä»¶åŒ…</li></ol><p>è“å±çš„è¿™ä¸ªé—®é¢˜åªåœ¨ä¸€å°ç”µè„‘ä¸Šé‡è§è¿‡ç‰¹æ®Šæ€§æ¯”è¾ƒé«˜, ä»…ä¾›å‚è€ƒ.</p><p>nginx é…ç½®<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rtmp &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        # æœåŠ¡ç«¯å£(é»˜è®¤ç«¯å£)</span><br><span class="line">        listen 1935;</span><br><span class="line">        # ç›´æ’­</span><br><span class="line">        application live &#123;</span><br><span class="line">            live on;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®¢æˆ·ç«¯<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Old version compatible with flash --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;link href="//vjs.zencdn.net/5.19/video-js.min.css" rel="stylesheet"&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src="//vjs.zencdn.net/5.19/video.min.js"&gt;&lt;/script&gt;   --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- New version uncompatible with flash --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://vjs.zencdn.net/6.2.4/video-js.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://vjs.zencdn.net/6.2.4/video.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./videojs-flash.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> videojs.options.flash.swf = <span class="string">'./video-js.swf'</span>; </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"my-player"</span> <span class="attr">class</span>=<span class="string">"video-js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"rtmp://127.0.0.1:1935/live/camera"</span> <span class="attr">type</span>=<span class="string">"rtmp/mp4"</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  videojs(<span class="string">'my-player'</span>, &#123;</span></span><br><span class="line"><span class="javascript">    controls: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">    autoplay: <span class="literal">true</span>,</span></span><br><span class="line"><span class="undefined">    flash: &#123;</span></span><br><span class="line"><span class="javascript">      swf: <span class="string">'./video-js.swf'</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    height: 300,</span></span><br><span class="line"><span class="undefined">    width: 300</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>è¡¥å……ä¸€å¥åœ¨ vue ä¸­ä½¿ç”¨å¯ä»¥è¯•è¯• <a href="https://github.com/surmon-china/vue-video-player" target="_blank" rel="noopener">vue-video-player</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸€æ³¢ç½‘ç»œæ‘„åƒæœºçš„ç›´æ’­è¿˜æ˜¯æ¶¨äº†å¾ˆå¤šå§¿åŠ¿, è¾¾æˆ FFmpeg è°ƒå‚å‘˜. ä¸è¿‡åœ¨æˆ‘ç¦»èŒä¹‹å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ä¸€ç›´æ²¡æœ‰è§£å†³, å®¢æˆ·ç«¯åœ¨è¿è¡Œ 3-4 å°æ—¶ä¹‹åå°±ä¼šé»‘å±, åœ¨åˆ·æ–°é¡µé¢ååˆæ¢å¤. æˆ‘å°è¯•è¿‡æ”¹ chrome ä¸­ flash çš„è®¾ç½®è¿˜æ˜¯ä¸è¡Œ, è‹Ÿä¸”äº†ä¸€ç‚¹å®šæ—¶åˆ·æ–°æš‚æ—¶è§£å†³. æœ€ç»ˆè¿˜æ˜¯ flash è¿™ä¸ªé—®é¢˜æ²¡æ³•ä»æ ¹æœ¬ä¸Šè§£å†³.</p><p>Created on 2017/7/26 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¯¹äºç½‘ç»œæ‘„åƒæœºåšè§†é¢‘é¢„è§ˆè¿™å—, æœ¬èº«å…¶å®æ˜¯éå¸¸é™Œç”Ÿçš„, å½“æ—¶æ¥åˆ°è¿™ä¸ªéœ€æ±‚ä¹Ÿæ˜¯ç›¸å½“çš„å¤´ç–¼(å¯¹äºå½“æ—¶ä¸€å¹´ç»éªŒä¸åˆ°çš„æˆ‘æ¥è¯´).å½“æ—¶æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯æ˜¯: å¤šè·¯ç½‘ç»œæ‘„åƒæœºé€šè¿‡å±€åŸŸç½‘è¿æ¥, PC ç«¯èƒ½å¤Ÿå®æ—¶é¢„è§ˆç›‘æ§ç”»é¢å¹¶ä¸”ç”»è´¨è¾¾åˆ°720p, å»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’, å¤šä¸ªæ‘„åƒæœºèƒ½å¤Ÿåˆ‡æ¢æŸ¥çœ‹.
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
      <category term="Node.js" scheme="https://yoursite.com/tags/Node-js/"/>
    
      <category term="FFmpeg" scheme="https://yoursite.com/tags/FFmpeg/"/>
    
  </entry>
  
  <entry>
    <title>Babelç”Ÿæ€</title>
    <link href="https://yoursite.com/2018/04/09/Babel/"/>
    <id>https://yoursite.com/2018/04/09/Babel/</id>
    <published>2018-04-09T09:55:20.000Z</published>
    <updated>2018-05-13T03:49:29.853Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äº babel çš„ä½¿ç”¨, ä¸€ç›´åœç•™åœ¨ä¸ webpack ç»“åˆä½¿ç”¨, ä»¥åŠåœ¨ Vue å¼€å‘ç¯å¢ƒä¸‹è„šæ‰‹æ¶åˆæ˜¯å¼€ç®±å³ç”¨. å¯¼è‡´å¾ˆå¤š babel çš„åŒ…, æˆ‘éƒ½ä¸æ¸…æ¥šä»–ä»¬æ˜¯å¹²ä»€ä¹ˆçš„. æ¯”å¦‚ babel-register/ babel-runtime/ helpers/ å„ç§ presets ä»¥åŠ transform-runtime å’Œ babel-polyfill çš„åŒºåˆ«, æ‰€ä»¥æ€»ç»“ä¸€ä¸‹.</p><h3 id="babel-cli"><a href="#babel-cli" class="headerlink" title="babel-cli"></a>babel-cli</h3><p>æˆ‘ç†è§£ä¸º babel çš„ command å…¨å®¶æ¡¶, ç”¨äºåœ¨å‘½ä»¤è¡Œæ“ä½œçš„. é‡Œé¢åŒ…å«äº† <code>babel</code>/ <code>babel-external-helpers</code>/ <code>babel-node</code> 3ä¸ªå‘½ä»¤</p><ul><li>babel: ç”¨äºç¼–è¯‘ä»£ç </li><li>babel-external-helpers: ç”¨äºç”Ÿæˆä¸€äº› halper å‡½æ•°, åŒ…å« babel æ‰€æœ‰çš„ hepler å‡½æ•° (å¦‚: toArray å‡½æ•°, jsx è½¬åŒ–å‡½æ•°). è¿™äº›å‡½æ•°å®åœ¨ babel transform çš„æ—¶å€™ç”¨, éƒ½æ”¾åœ¨ <code>babel-helpers</code> è¿™ä¸ªåŒ…ä¸­, å½“è¿™äº› helpers è¢«ç”¨åˆ°å°±ä¼šè¢«æ”¾ç½®åœ¨ç”Ÿæˆä»£ç çš„é¡¶éƒ¨. ä½†æ˜¯å½“å¤šä¸ªæ–‡ä»¶éƒ½ç”¨åˆ°äº† helpers å‡½æ•°å°±ä¼šäº§ç”Ÿå†—ä½™ä»£ç , æ‰€ä»¥ babel æä¾›è¿™ä¸ªå‘½ä»¤ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰ helpers çš„ js æ–‡ä»¶ç”¨äºç›´æ¥å¼•ç”¨.(ç„¶åå¯ä»¥é€šè¿‡ plugin å»æ£€æŸ¥å…¨å±€æ—¶å€™å­˜åœ¨è¿™ä¸ªæ¨¡å—, å­˜åœ¨å°±ä¸å®šä¹‰)</li><li>babel-node: ä¸»è¦æ˜¯å®ç°åœ¨ node ä¸­å†™ä»£ç å’Œæ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›, å¯ä»¥ç›´æ¥è¿è¡Œ ES6ä»£ç . æ¯”å¦‚ç›´æ¥åœ¨ node ä¸­å†™ jsx, é€šè¿‡è¿™ä¸ªå°±å¯ä»¥æ‰§è¡Œ. ä½†æ˜¯è¦æŠŠå®ƒç¼–è¯‘æˆå¯æ‰§è¡Œçš„è„šæœ¬è¿˜éœ€è¦ <code>babel-register</code></li></ul><p>å®‰è£…<br><code>npm install --global babel-cli</code></p><p>ç”¨æ³•<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">babel example.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è½¬ç ç»“æœå†™å…¥æ–‡ä»¶</span><br><span class="line">babel example.js -o result.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ•´ä¸ªç›®å½•è½¬ç </span><br><span class="line">babel src -d lib</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç”Ÿæˆ source map æ–‡ä»¶</span><br><span class="line">babel src -d lib -s</span><br></pre></td></tr></table></figure></p><p>å…¨å±€ç¯å¢ƒä¸‹ babel æ— æ³•æ”¯æŒä¸åŒç‰ˆæœ¬çš„ babel, æ‰€ä»¥å®‰å…¨çš„åšæ³•è¿˜æ˜¯æŠŠ babel è£…åœ¨é¡¹ç›®ä¸­<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-cli</span><br></pre></td></tr></table></figure></p><p>package.json æ”¹æˆ:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"script"</span>: <span class="string">"babel src -d lib"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>babel-register</strong><br>å®ƒçš„ç‰¹ç‚¹å°±æ˜¯å®æ—¶ç¼–è¯‘, ä¸ä¼šè¾“å‡ºæ–‡ä»¶, ç”¨æ¥æ”¹å†™ <code>require</code> å‘½ä»¤ä¸ºå®ƒåŠ ä¸Šé’©å­. <code>require</code> è¿›æ¥çš„æ–‡ä»¶å°±ä¼šè¢«è½¬ç , ä½†æ˜¯å®ƒä¸ä¼šè½¬ç å½“å‰æ–‡ä»¶ä¸­çš„ä»£ç .</p><p>å®‰è£…<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-register</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿…é¡»å…ˆåŠ è½½ register</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>)</span><br><span class="line"><span class="comment">// ç„¶å register å°±ä¼šå¯¹ test.js æ–‡ä»¶è½¬ç </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'test.js'</span>)</span><br></pre></td></tr></table></figure></p><blockquote><p>ç”±äº <code>babel-register</code> æ˜¯å³æ—¶è½¬ç , æ‰€ä»¥åªé€‚ç”¨äºå¼€å‘ç¯å¢ƒä½¿ç”¨.</p></blockquote><h3 id="babel-core"><a href="#babel-core" class="headerlink" title="babel-core"></a>babel-core</h3><p><code>babel-core</code> å¯ä»¥è¯´æ˜¯ babel æœ€ä¸ºæ ¸å¿ƒçš„ä¸€ä¸ªåŒ…, å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªç¼–è¯‘å™¨, babel æ ¸å¿ƒçš„ API éƒ½åœ¨é‡Œé¢. æ¯”å¦‚: transform å¤„ç†è½¬ç , å› ä¸º ES6 çš„è¯­æ³•è·Ÿè€è¯­æ³•ä¸åŒ, æ‰€ä»¥å…ˆå°†æˆ‘ä»¬çš„ä»£ç è½¬æ¢ä¸º AST(æŠ½è±¡è¯­æ³•æ ‘), ç„¶ååˆ†åˆ«åšå¤„ç†è½¬åŒ–ä¸º ES5. webpack çš„ babel-loader å°±æ˜¯è°ƒç”¨è¿™äº› API å®Œæˆè½¬è¯‘çš„. <a href="https://babeljs.cn/docs/usage/api/" target="_blank" rel="noopener">è¿™é‡Œæ˜¯è¯¦ç»†çš„ API</a></p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯: <code>babel-core</code> ä»…å…³æ³¨ code transform, ä¹Ÿå°±æ˜¯è¯´å®ƒåªåšè¯­æ³•ä¸Šçš„è½¬æ¢, æ¯”å¦‚ç®­å¤´å‡½æ•°. æ‰€ä»¥å¹¶ä¸æ˜¯ä»€ä¹ˆéƒ½èƒ½ç”¨ babel æ¥è½¬æ¢çš„, å¦‚æœæ¶‰åŠåˆ°æ–°çš„ API å°±éœ€è¦ä½ ç”¨ polyfill æ¥è½¬è¯‘, æ¯”å¦‚ <code>Promise</code>.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•´å—å¼•å…¥</span></span><br><span class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'babel-core'</span>)</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥é€‰æ‹©æŸä¸ª API å•ç‹¬ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> &#123; transform &#125; <span class="keyword">from</span> <span class="string">'babel-core'</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦çš„ API:</p><p><strong>babel.transform(code: string, options?: Object)</strong><br>å°†ä¼ å…¥çš„ code åšè½¬æ¢, è¿”å›å€¼ä¸ºä¸€ä¸ªå¯¹è±¡, å‚æ•°ä¸º: ç”Ÿæˆçš„å¯¹è±¡, source map å’Œ AST</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = babel.transform(<span class="string">"code();"</span>, options);</span><br><span class="line">result.code</span><br><span class="line">result.map</span><br><span class="line">result.ast</span><br></pre></td></tr></table></figure><p><strong>babel.transformFile(filename: string, options?: Object, callback: Function)</strong><br>å¼‚æ­¥è½¬è¯‘æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFile(<span class="string">'filename.js'</span>, options, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">  result <span class="comment">// &#123; code, map, ast &#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>babel.transformFileSync(filename: string, options?: Object)</strong><br><code>babel.transformFile</code> çš„åŒæ­¥ç‰ˆæœ¬, è¿”å›å€¼ä¸º <code>filename</code> æ–‡ä»¶ä¸­è½¬è¯‘åçš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFileSync(filename, options) <span class="comment">// &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure><p><strong>babel.transformFromAst(ast: Object, code?: string, options?: Object)</strong><br>åè½¬è¯‘, ç»™ä¸€ä¸ª AST è½¬ä¸º code</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> code = <span class="string">'if (true) return'</span></span><br><span class="line"><span class="keyword">const</span> ast = babylon.parse(code, &#123; <span class="attr">allowReturnOutsideFunction</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> &#123; code, map, ast &#125; = babel.transformFormAst(ast, code, options)</span><br></pre></td></tr></table></figure><h3 id="babel-runtime"><a href="#babel-runtime" class="headerlink" title="babel-runtime"></a>babel-runtime</h3><p><a href="https://babeljs.cn/docs/plugins/transform-runtime/" target="_blank" rel="noopener"><code>babel-runtime</code></a> è¿™ä¸ªåŒ…å…¶å®å°±æ˜¯æŠŠ core-js å’Œ regenerator ç»„åˆèµ·æ¥ä¾›ä½¿ç”¨, å®ƒå’Œ <code>babel-polyfill</code> çš„éƒ½æ˜¯ä¸ºäº†æ¨¡æ‹Ÿ ES6 ç¯å¢ƒ. ä¹‹å‰æåˆ°çš„ <code>babel-core</code> åªå¯¹è¯­æ³•è¿›è¡Œè½¬æ¢, ä½†ä¸æ”¯æŒ Promise, Set, Map, array.reduce, Array.form, genertor, async è¿™äº›æ–° API çš„ç¼–è¯‘, æ‰€ä»¥æ‰ä¼šç”¨åˆ°è¿™ä¸¤ä¸ªä¸œè¥¿.</p><p><strong>core-js</strong>: ä¸»è¦å®ç°äº† Promise, Symbols, ES7ææ¡ˆç­‰ç­‰çš„ polyfill, åŒ…å«äº†å¤§éƒ¨åˆ†çš„ JavaScript æœ€æ–°æ ‡å‡†çš„å«ç‰‡.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦å•ä¸ªå¼•ç”¨åå†ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'core-js/array/reduce'</span>)</span><br></pre></td></tr></table></figure></p><p><strong>regenerator</strong>: ä¸»è¦å®ç° generator/yeild, async/await (ä¸çŸ¥é“ä¸ºå•¥ core-js ä¸æŠŠè¿™ä¸¤ä¸ªä¸€èµ·å®ç°äº†â€¦)</p><p><strong>helpers</strong>: <code>babel-runtime</code> é‡Œä¹Ÿæœ‰ helpers, å®ƒé‡Œé¢çš„ helpers ç›¸å½“äºä¹‹å‰æåˆ°çš„ <code>babel-external-helpers</code> ç”Ÿæˆçš„ helpers.js, åªä¸è¿‡æŠŠæ¯ä¸ª helpers å‡½æ•°éƒ½å•ç‹¬æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œè€Œå·². è¿™æ ·é…åˆ transform çš„æ—¶å€™, éœ€è¦ç”¨åˆ° helpers å‡½æ•°å°±å¯ä»¥ç›´æ¥ä» <code>babel-runtime</code> ä¸­å¼•ç”¨äº†.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _asyncToGenerator2 = <span class="built_in">require</span>(<span class="string">'babel-runtime/helpers/asyncToGenerator'</span>)</span><br></pre></td></tr></table></figure></p><p>åŒºåˆ«: </p><ul><li><a href="https://babeljs.cn/docs/usage/polyfill" target="_blank" rel="noopener">babel-polyfill</a>: æ˜¯é€šè¿‡å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„ prototype ä¸Šæ·»åŠ æ–¹æ³•æ¥è¾¾åˆ°ç›®çš„, æ‰€ä»¥ä¸€æ—¦å¼•å…¥ <code>babel-polyfill</code> å°±ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒ.</li><li>babel-runtime: <code>babel-runtime</code> æ˜¯ä¸€ä¸ªæ¨¡å—, æ‰€ä»¥å®ƒä¸ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒå’Œå†…ç½®å¯¹è±¡çš„åŸå‹. å®ƒçš„åšæ³•å¼•å…¥éœ€è¦çš„ helper å‡½æ•°(ç±»ä¼¼: <code>const Promise = require(&#39;babel-runtime/core-js/promise&#39;)</code> æ¥å¼•å…¥ Promise).</li></ul><p>ä¼˜ç¼ºç‚¹:</p><ul><li>babel-poly-fill: å¼•å…¥ä¸€åŠ³æ°¸é€¸, ä½†æ˜¯æ±¡æŸ“ç¯å¢ƒ.</li><li>babel-runtime: <ol><li>æ‰‹åŠ¨å¼•å…¥ä¸æ–¹ä¾¿</li><li>ç›´æ¥åœ¨ä»£ç ä¸­å¼•å…¥ helper å‡½æ•°æ„å‘³ç€ä¸èƒ½å…±äº«, æœ€ç»ˆæ‰“åŒ…å‡ºæ¥ä¼šæœ‰å¾ˆå¤šå†—ä½™ä»£ç (å¼•å…¥çš„éƒ½æ˜¯å…¨é‡çš„ polyfill). </li></ol></li></ul><p>æ‰€ä»¥è¦é…åˆ <code>babel-plugin-transform-runtime</code> (å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯æŠŠ <code>babel-runtime</code> å’Œ <code>babel-plugin-transform-runtime</code> ç»Ÿç§°ä¸º transform-runtime, å› ä¸ºå®ƒä¿©å¾—åˆåœ¨ä¸€èµ·æ‰å¥½ç”¨) æ¥è¾¾åˆ°æŒ‰éœ€å¼•å…¥ helper é¿å…é‡å¤æ‰“åŒ…å’Œæ‰‹åŠ¨å¼•å…¥çš„ç—›è‹¦, å®ƒä¸»è¦æ˜¯åšä¸€å±‚æ˜ å°„: å°† <code>babel-runtime</code> å†…å¼•ç”¨åˆ°çš„ core-js æˆ– regenerator.js æ˜ å°„åˆ°å…·ä½“å¯¹åº”çš„ helper. </p><blockquote><p>æ³¨æ„: <code>babel-runtime</code> æ— æ³•è½¬ç å®ä¾‹æ–¹æ³•, å³å†…ç½®å¯¹è±¡åŸå‹ä¸Šçš„æ–¹æ³•, åªèƒ½é€šè¿‡ <code>babel-polyfill</code> æ¥è½¬ç . æ¯”å¦‚:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.find()</span><br><span class="line"><span class="string">'hello'</span>.includes(<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure></p></blockquote><p>å¦å¤–, å…³äºä¸ºä»€ä¹ˆ <code>babel-runtime</code> æ˜¯ dependencies ä¾èµ–, å› ä¸ºä»–åªæ˜¯é›†åˆäº† polyfill çš„ä¸€ä¸ª library, å¯¹åº”éœ€è¦çš„ polyfill éƒ½æ˜¯è¦å¼•å…¥é¡¹ç›®ä¸­, å¹¶è·Ÿé¡¹ç›®ä»£ç ä¸€èµ·æ‰“åŒ…çš„.</p><h3 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="babel-preset-env"></a>babel-preset-env</h3><p>å®ƒèƒ½æ ¹æ®å½“å‰çš„è¿è¡Œç¯å¢ƒ, è‡ªåŠ¨ç¡®å®šä½ éœ€è¦çš„ plugins å’Œ polyfills, babel çš„é…ç½®å®˜æ–¹æ¨èæ˜¯å†™åˆ° <code>.babelrc</code> æ–‡ä»¶ä¸­, ä»¥ <code>Vue-cli</code> çš„ babel é…ç½®ä¸ºä¾‹.<a href="https://babeljs.cn/docs/plugins/preset-env/" target="_blank" rel="noopener">è¯¦ç»†å‚æ•°è®¾ç½®åŠè¯´æ˜</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [<span class="string">"env"</span>, </span><br><span class="line">      &#123; </span><br><span class="line">        "modules": false // è®¾ç½® ES6 æ¨¡å—è½¬è¯‘çš„æ¨¡å¼, é»˜è®¤æ˜¯ commonjs</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    // éœ€è¦æ”¯æŒåˆ°å“ªä¸ªé˜¶æ®µçš„ JavaScript ç‰ˆæœ¬</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ],</span><br><span class="line">  // éœ€è¦çš„æ’ä»¶</span><br><span class="line">  "plugins": [</span><br><span class="line">    "transform-runtime", // è™½ç„¶è¿™é‡Œæ²¡æœ‰å†™ babel-runtime, ä½†æ˜¯ transform-runtime ä¾èµ–äºå®ƒ, æ‰€ä»¥è¿˜æ˜¯è¦å®‰è£…</span><br><span class="line">    <span class="string">"transform-vue-jsx"</span></span><br><span class="line">  ],</span><br><span class="line">  // ç¼–è¯‘è¿‡ç¨‹æ˜¯å¦ä¿ç•™æ³¨é‡Š</span><br><span class="line">  "comments": false,</span><br><span class="line">  "env": &#123;</span><br><span class="line">    "test": &#123;</span><br><span class="line">      "presets": ["env", "stage-2"],</span><br><span class="line">      "plugins": [ "istanbul"]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ¥ <code>babel-preset-env</code> ä¸­æœ‰ä¸€ä¸ª useBuiltIns é€‰é¡¹(é»˜è®¤å€¼æ˜¯ false), å°±æ˜¯å®ƒå®ç°çš„æ ¹æ®è¿è¡Œç¯å¢ƒå¹¶åˆ¤æ–­éœ€è¦ä»€ä¹ˆ polyfill, è¾¾åˆ°æŒ‰éœ€å¼•å…¥è€Œä¸æ˜¯æ•´ä¸ªå¼•å…¥, å¯¹äº <code>import &#39;babel-polyfill&#39;</code> å°±å¾ˆæ£’äº†. ä½†æ˜¯å¯ä»¥çœ‹åˆ° vue-template å¹¶æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªé€‰é¡¹, è¿™æ˜¯å› ä¸º   <a href="javascript:" title="æˆ‘æ¶ˆä¸æ‰è¿™ä¸ªè¶…é“¾æ¥ğŸ˜‘" target="_blank" rel="noopener">babel-preset-env@1.x</a> çš„ç‰ˆæœ¬æ²¡æœ‰åŠæ³•å¾ˆå¥½æ¶ˆé™¤æœªä½¿ç”¨çš„ polyfill, åœ¨2.x ç‰ˆæœ¬ä¸‹å¯ä»¥ç”¨ <code>usebuiltIns: &#39;usage&#39;</code>è¾¾åˆ°ç›®çš„.</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>babel è¿˜æœ‰å¾ˆå¤šç›¸å…³çš„ä¸œè¥¿æ²¡è¯´åˆ°, åªæŒ‘äº†å‡ ä¸ªæœ€é‡è¦çš„æ¥è¯´, å…·ä½“çš„ helpers/ plugins éƒ½å¯ä»¥åˆ°<a href="https://github.com/babel/babel/tree/master/packages" target="_blank" rel="noopener">å®˜æ–¹ä»“åº“</a>æŸ¥çœ‹</p><ul><li><a href="https://github.com/babel/babel/tree/master/packages/babylon" target="_blank" rel="noopener">badylon</a>: è¯æ³•è§£æå™¨</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-traverse" target="_blank" rel="noopener">babel-traverse</a>: ç”¨äºéå†, ç»´æŠ¤æ•´ä¸ª AST çš„çŠ¶æ€</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-generator" target="_blank" rel="noopener">babel-generator</a>: æ ¹æ® AST ç”Ÿæˆä»£ç </li></ul><h4 id="babel-çš„å·¥ä½œæµç¨‹"><a href="#babel-çš„å·¥ä½œæµç¨‹" class="headerlink" title="babel çš„å·¥ä½œæµç¨‹"></a>babel çš„å·¥ä½œæµç¨‹</h4><p>è¾“å…¥éœ€è¦è½¬ç çš„ä»£ç  -&gt; badylon è§£æ -&gt; å¾—åˆ° AST -&gt;<br>babel-traverse éå†è½¬è¯‘ -&gt; å¾—åˆ°æ–°çš„ AST -&gt;<br>æœ€å babel-generator æ ¹æ®æ–°çš„ AST ç”Ÿæˆä»£ç </p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ•´ä¸ªæ¥è¯´æˆ‘è§‰å¾—è¿˜æ˜¯ <code>babel-runtime</code> å’Œ <code>babel-polyfill</code> æ¯”è¾ƒéš¾åŒºåˆ†, å…¶å®ä¸¤è€…çš„æ ¸å¿ƒéƒ½åœ¨äº <a href="https://github.com/zloirock/core-js#basic" target="_blank" rel="noopener">core-js</a> åªæ˜¯å„æœ‰ä¼˜ç¼ºç‚¹è€Œå·², ä¸‹é¢ä¼šå†ç®€è¦æ€»ç»“ä¸€ä¸‹åŒºåˆ«. å…¶ä»–çš„è¯åªéœ€è¦çŸ¥é“æ¯ä¸ªä¸œè¥¿æ˜¯å¹²å•¥çš„å°±è¡Œäº†.</p><ul><li>babel-polyfill: æ±¡æŸ“ç¯å¢ƒ, æ”¯æŒå®ä¾‹æ–¹æ³•(å¦‚æœåªæƒ³å¼•å…¥ä¸€äº›ç‰¹å®šçš„polyfill, é‚£å°±å» <a href="https://github.com/zloirock/core-js#basic" target="_blank" rel="noopener">core-js</a> ä¸­æ‰¾ç›¸åº”çš„æ–¹æ³•è‡ªå·±æ‰‹åŠ¨ require è¿›æ¥); </li><li>runtime: æŒ‰éœ€å¼•ç”¨,ä¸æ”¯æŒå®ä¾‹æ–¹æ³•.</li></ul><p>Created on 2018-4-11 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¯¹äº babel çš„ä½¿ç”¨, ä¸€ç›´åœç•™åœ¨ä¸ webpack ç»“åˆä½¿ç”¨, ä»¥åŠåœ¨ Vue å¼€å‘ç¯å¢ƒä¸‹è„šæ‰‹æ¶åˆæ˜¯å¼€ç®±å³ç”¨. å¯¼è‡´å¾ˆå¤š babel çš„åŒ…, æˆ‘éƒ½ä¸æ¸…æ¥šä»–ä»¬æ˜¯å¹²ä»€ä¹ˆçš„. æ¯”å¦‚ babel-register/ babel-runtime/ helpers/ å„ç§ pre
      
    
    </summary>
    
    
      <category term="Babel" scheme="https://yoursite.com/tags/Babel/"/>
    
  </entry>
  
  <entry>
    <title>è·¨åŸŸ</title>
    <link href="https://yoursite.com/2018/04/02/%E8%B7%A8%E5%9F%9F/"/>
    <id>https://yoursite.com/2018/04/02/è·¨åŸŸ/</id>
    <published>2018-04-02T09:01:24.000Z</published>
    <updated>2018-05-13T03:49:29.860Z</updated>
    
    <content type="html"><![CDATA[<p>è·¨åŸŸè¿™å—æ˜¯å‰åç«¯åˆ†ç¦»å¿…ç»çš„ä¸€æ¡è·¯, è¿™æ¬¡å¥½å¥½æ•´ç†ä¸€ä¸‹å…³äºè·¨åŸŸæ–¹é¢çŸ¥è¯†.</p><h3 id="ä»€ä¹ˆæ˜¯è·¨åŸŸ"><a href="#ä»€ä¹ˆæ˜¯è·¨åŸŸ" class="headerlink" title="ä»€ä¹ˆæ˜¯è·¨åŸŸ?"></a>ä»€ä¹ˆæ˜¯è·¨åŸŸ?</h3><p>è·¨åŸŸæ˜¯å—åŒæºç­–ç•¥çš„å½±å“è€Œå¯¼è‡´çš„, æŒ‡ä¸€ä¸ªæºä¸‹çš„èµ„æºè¯•å›¾æ“ä½œå¦ä¸€ä¸ªæºä¸‹çš„èµ„æº.</p><blockquote><p>é‚£ä¹ˆ, ä»€ä¹ˆåˆæ˜¯åŒæºç­–ç•¥å‘¢?<br>å°±æ˜¯é™åˆ¶ä»ä¸€ä¸ªæºçš„èµ„æºå¦‚ä½•ä¸å¦ä¸€ä¸ªæºçš„èµ„æºäº¤äº’, ç”¨äºéš”ç¦»æ½œåœ¨çš„æ¶æ„æ–‡ä»¶, ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§. æ‰€è°“çš„åŒæºæ˜¯æŒ‡: åè®®/åŸŸå/ç«¯å£ ä¸‰è€…ç›¸åŒ, å³ä½¿ä¸¤ä¸ªä¸åŒçš„åŸŸåæŒ‡å‘åŒä¸€ä¸ª IP åœ°å€, ä¹ŸéåŒæº. å¦‚æœæ²¡æœ‰åŒæºç­–ç•¥, æµè§ˆå™¨å¾ˆå®¹æ˜“å—åˆ° XSS/CSRF ç­‰çš„æ”»å‡»(XSS: è·¨ç«™è„šæœ¬æ”»å‡»;CSRF: è·¨ç«™è¯·æ±‚ä¼ªé€ ).</p></blockquote><p>åŒæºç­–ç•¥å°†é™åˆ¶ä»¥ä¸‹è¡Œä¸º:</p><ul><li>Cookie/LocalStorage/IndexDB</li><li>DOM æ— æ³•è·å¾—</li><li>Ajax è¯·æ±‚æ— æ³•å‘é€</li></ul><h3 id="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"><a href="#è·¨åŸŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"></a>è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h3><h4 id="1-JSONP"><a href="#1-JSONP" class="headerlink" title="1. JSONP"></a>1. JSONP</h4><p>å®ƒçš„ç‰¹æ€§æ˜¯ç®€å•/ å…¼å®¹æ€§å¥½/ æ”¹é€ å°, ä½†æ˜¯ä¸æ”¯æŒ POST è¯·æ±‚. åŸç†æ˜¯é€šè¿‡ <code>script</code> æ ‡ç­¾æ”¾å…¥å›è°ƒå‡½æ•°, æœåŠ¡ç«¯å°†è¿”å›æ•°æ®å¡å…¥å›è°ƒå‡½æ•°å³å¯.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createScript = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">    script.type = <span class="string">'text/javascript'</span></span><br><span class="line">    script.src = url</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥è¯·æ±‚åœ°å€</span></span><br><span class="line">createScript(<span class="string">'http://www.example.com/api?callback=foo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æœåŠ¡ç«¯è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-document-domain"><a href="#2-document-domain" class="headerlink" title="2. document.domain"></a>2. document.domain</h4><p>é€šè¿‡è®¾ç½®åŸŸåæ¥è®¿é—® <code>Cookie</code> å’Œ æ“ä½œ <code>iframe</code> çª—å£, æ­¤æ–¹æ¡ˆåªé€‚ç”¨äºä¸»åŸŸç›¸åŒ, å­åŸŸä¸åŒçš„åœºæ™¯.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// çˆ¶çª—å£ (http://www.main.com/a.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">'iframe'</span> <span class="attr">src</span>=<span class="string">'http://www.child.main.com/b.html'</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'main.com'</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.cookie = <span class="string">'test=hi'</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> user = <span class="string">'admin'</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å­çª—å£ (http://www.child.main.com/b.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'example.com'</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> parentMessage = <span class="built_in">document</span>.cookie</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.parent.user)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-window-location-hash"><a href="#3-window-location-hash" class="headerlink" title="3. window.location.hash"></a>3. window.location.hash</h4><p>é€šè¿‡ä¿®æ”¹ hash å€¼æ¥ä¼ é€’å‚æ•°, ä¿®æ”¹ hash å€¼å¹¶ä¸ä¼šåˆ·æ–°é¡µé¢ä½†å­—èŠ‚æ•°æœ‰é™åˆ¶.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶çª—å£å‘å­çª—å£å†™å…¥ hash</span></span><br><span class="line"><span class="keyword">let</span> src = <span class="string">`<span class="subst">$&#123;childUrl&#125;</span>#test=hi`</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'#iframe'</span>).src = src</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­çª—å£</span></span><br><span class="line"><span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="built_in">window</span>.onhashchange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> meg = <span class="built_in">window</span>.location.hash</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­çª—å£å‘çˆ¶çª—å£å†™å…¥ hash</span></span><br><span class="line"><span class="built_in">window</span>.parent.href = <span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.parent.href&#125;</span>#world`</span></span><br></pre></td></tr></table></figure><h4 id="4-window-name"><a href="#4-window-name" class="headerlink" title="4. window.name"></a>4. window.name</h4><p>window.name åªè¦åœ¨åŒä¸€ä¸ªçª—å£, æ— è®ºæ˜¯å¦åŒæºå‰ä¸€ä¸ªé¡µé¢è®¾ç½®äº†è¿™ä¸ªå±æ€§, åä¸€ä¸ªé¡µé¢å°±èƒ½è¯»å–. å®ƒå¯ä»¥æ”¯æŒ2M å¤§å°çš„å€¼ä½†æ˜¯å˜åŒ–éœ€è¦è‡ªå·±ç›‘å¬.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶çª—å£ (http://www.main.com/a.html)</span></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="function">(<span class="params">url, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">    <span class="keyword">let</span> state = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·³è½¬åˆ°è·¨åŸŸé¡µé¢</span></span><br><span class="line">    iframe.src = url</span><br><span class="line"></span><br><span class="line">    iframe.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (state === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// ç¬¬äºŒæ¬¡ä»£ç†ä¹ŸåŠ è½½æˆåŠŸä¹‹å, è¯»å– name å±æ€§</span></span><br><span class="line">            callback(<span class="built_in">window</span>.name)</span><br><span class="line">            <span class="built_in">document</span>.body.removeChild(iframe);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//  ç¬¬ä¸€æ¬¡è·³è½¬åˆ°ä»£ç†é¡µé¢</span></span><br><span class="line">            iframe.src = <span class="string">'http://www.main.com/proxy.html'</span></span><br><span class="line">            state = <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(iframe)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥è·¨åŸŸé¡µé¢ URL</span></span><br><span class="line">proxy(<span class="string">'http://www.child.com/b.html'</span>, (name) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name) <span class="comment">// 'This message from b.html'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¨åŸŸå­çª—å£ (http://www.child.com/b.html) </span></span><br><span class="line"><span class="comment">// è®¾ç½® name å±æ€§</span></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'This message from b.html'</span></span><br></pre></td></tr></table></figure><h4 id="5-postMessage"><a href="#5-postMessage" class="headerlink" title="5. postMessage"></a>5. postMessage</h4><p>postMessage(è·¨æ–‡æ¡£é€šä¿¡) æ˜¯ HTML5 ä¸­ä¸ºäº†è§£å†³è·¨åŸŸå‡ºçš„ API, å¯ä»¥è§£å†³ä»¥ä¸‹å‡ ç§é—®é¢˜:</p><ol><li>é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’</li><li>å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’</li><li>é¡µé¢ä¸åµŒå¥—çš„iframeæ¶ˆæ¯ä¼ é€’</li><li>ä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„è·¨åŸŸæ•°æ®ä¼ é€’</li></ol><p>å‘é€æ¶ˆæ¯é€šè¿‡ <code>postMessage(data, origin)</code> æ–¹æ³•, è¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°: </p><ul><li>data: éœ€è¦ä¼ é€’çš„å‚æ•°, ç”±äºéƒ¨åˆ†æµè§ˆå™¨åªæ”¯æŒå­—ç¬¦ä¸², æ‰€ä»¥ä¼ é€’ä¹‹å‰æœ€å¥½å…ˆ <code>JSON.stringify()</code> åºåˆ—åŒ–</li><li>origin: æ˜¯æ¥æ”¶æ–¹çš„ åè®® + ä¸»æœº + ç«¯å£, å¯ä»¥æ˜¯è®¾ç½®ä¸º <code>*</code>, æŒ‡å®šä¸å½“å‰çª—å£åŒæºçš„è¯è®¾ç½®ä¸º <code>/</code>.</li></ul><p>æ¥æ”¶æ¶ˆæ¯é€šè¿‡ <code>message</code> äº‹ä»¶ç›‘å¬, è¯¥äº‹ä»¶æœ‰ä¸€ä¸ª <code>event</code> å‚æ•°æä¾›ä¸‰ä¸ªå±æ€§:</p><ul><li>event.origin: æ¶ˆæ¯æ¥æ”¶æ–¹</li><li>event.source: æ¶ˆæ¯æ¥æº</li><li>event.data: æ¶ˆæ¯ä½“</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// çˆ¶çª—å£ (http://www.main.com/a.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">firame</span> <span class="attr">id</span>=<span class="string">'iframe'</span> <span class="attr">src</span>=<span class="string">'http://www.child.com/b.html'</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> iframe = <span class="built_in">document</span>.querySelector(<span class="string">'#iframe'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> url = iframe.src</span></span><br><span class="line"><span class="javascript">    iframe.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="javascript">            name: <span class="string">'parent'</span>,</span></span><br><span class="line"><span class="javascript">            message: <span class="string">'This message from parent'</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// è·¨åŸŸå‘å­çª—å£å‘é€æ¶ˆæ¯</span></span></span><br><span class="line"><span class="javascript">        iframe.contentWindow.postMessage(<span class="built_in">JSON</span>.stringify(data), url)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// çˆ¶çª—å£ç›‘å¬å­çª—å£å‘é€çš„æ¶ˆæ¯</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onmessage = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// è¿‡æ»¤ä¸å±äºè‡ªå·±çš„æ¶ˆæ¯</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (data.origin !== <span class="string">'http://www.main.com/a.html'</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'data from child: '</span> + event.data)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// å­çª—å£ (http://www.child.com/b.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onmessage = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'data from main: '</span> + event.data)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(event.data)</span></span><br><span class="line"><span class="javascript">        data.name = <span class="string">'child'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// æ”¶åˆ°æ¶ˆæ¯åå¤„ç†å†å‘é€ç»™çˆ¶çª—å£</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.parent.postMessage(<span class="built_in">JSON</span>.stringify(data), <span class="string">'http://www.main.com/a.html'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-CORS"><a href="#5-CORS" class="headerlink" title="5. CORS"></a>5. CORS</h4><p>è·¨åŸŸèµ„æºå…±äº«(Cross-origin-resource-sharing), å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨å‘å‡º <code>XMLHttpRequest</code> è¯·æ±‚. CORS ç°åœ¨ä¹Ÿæ˜¯ä¸»æµçš„è·¨åŸŸè§£å†³æ–¹æ¡ˆ, è¿™ç§æ–¹å¼åªéœ€è¦åç«¯åšå¤„ç†, å¦‚æœè¦å¸¦ä¸Š cookie é‚£ä¹ˆå‰åç«¯éƒ½è¦è®¾ç½®.</p><p>å¸¦ cookie ä¼ è¾“:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>è¯·æ±‚å®ä¾‹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> XMLRequest = <span class="function">(<span class="params">method = <span class="string">'GET'</span>, url = <span class="string">''</span>, data = <span class="literal">null</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">        xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.open(method, url, <span class="literal">true</span>)</span><br><span class="line">    xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">    xhr.send(data)</span><br><span class="line"></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">XMLRequest(<span class="string">'POST'</span>, <span class="string">'http://www.example.com/api'</span>, &#123;</span><br><span class="line">    name: <span class="string">'cara'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ <code>readyState</code> æœ‰äº”ç§çŠ¶æ€:<br>0: ä¸ºåˆå§‹åŒ–<br>1: æœåŠ¡å™¨è¿æ¥å»ºç«‹<br>2: è¯·æ±‚å·²æ¥æ”¶<br>3: è¯·æ±‚å¤„ç†ä¸­<br>4: è¯·æ±‚å·²å®Œæˆ</p><h4 id="6-ä»£ç†æœåŠ¡å™¨"><a href="#6-ä»£ç†æœåŠ¡å™¨" class="headerlink" title="6. ä»£ç†æœåŠ¡å™¨"></a>6. ä»£ç†æœåŠ¡å™¨</h4><p>å…¶å®å°±æ˜¯é€šè¿‡é…ç½® nginx å®ç°ä¸€ä¸ªä¸­é—´æœåŠ¡å™¨ä½œè·³æ¿, ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨.</p><p>é™æ€èµ„æºä»£ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin *;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…·ä½“ä»£ç†é…ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 81;</span><br><span class="line">    server_name www.example.com;</span><br><span class="line"></span><br><span class="line">    lication / &#123;</span><br><span class="line">        # åå‘ä»£ç†</span><br><span class="line">        proxy_pass http://www.example2.com:8080;</span><br><span class="line">        # ä¿®æ”¹ cookie åŸŸå</span><br><span class="line">        proxy_cookie_domain www.example2.com www.example.com;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line"></span><br><span class="line">        # ä¸å¸¦ cookie æ—¶æ‰èƒ½è®¾ç½®ä¸º *</span><br><span class="line">        add_header Access-Control-Allow-Origin http://www.example.com;</span><br><span class="line">        add_header Access-Control-Allow-Credentials true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è°ƒç”¨ç¤ºä¾‹<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'htt://www.example.com:81/?user=admin'</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.send(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Š, å°±æ˜¯è·¨åŸŸå¯¼è‡´çš„åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆçš„å¤§è‡´æ€»ç»“.</p><p>Created on 2018-4-2 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è·¨åŸŸè¿™å—æ˜¯å‰åç«¯åˆ†ç¦»å¿…ç»çš„ä¸€æ¡è·¯, è¿™æ¬¡å¥½å¥½æ•´ç†ä¸€ä¸‹å…³äºè·¨åŸŸæ–¹é¢çŸ¥è¯†.&lt;/p&gt;
&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯è·¨åŸŸ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯è·¨åŸŸ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯è·¨åŸŸ?&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯è·¨åŸŸ?&lt;/h3&gt;&lt;p&gt;è·¨åŸŸæ˜¯å—åŒæºç­–ç•¥çš„å½±å“è€Œå¯¼
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Promise åˆ†æåŠå®ç°</title>
    <link href="https://yoursite.com/2018/01/04/Promise-%E5%88%86%E6%9E%90%E5%8F%8A%E5%AE%9E%E7%8E%B0/"/>
    <id>https://yoursite.com/2018/01/04/Promise-åˆ†æåŠå®ç°/</id>
    <published>2018-01-04T11:07:22.000Z</published>
    <updated>2018-05-13T03:49:29.856Z</updated>
    
    <content type="html"><![CDATA[<p>Promise æ˜¯ ES6ä¸­ä¸­æ”¶å½•çš„å¼‚æ­¥æ“ä½œå°è£…, é€šå¸¸åœ¨å›è°ƒ/ äº‹ä»¶/ æ¶ˆæ¯ç­‰å¼‚æ­¥æ“ä½œä¸­æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿, è®©æˆ‘ä»¬åœ¨æ›´æ–¹ä¾¿çš„æ“ä½œå¼‚æ­¥ä¹Ÿè®©ä»£ç æ›´åŠ æ¸…æ™°.åŒ…æ‹¬ ES7ä¸­çš„ Async/Await ä¹Ÿæ˜¯å¯¹å¼‚æ­¥æ“ä½œçš„å°è£…, ä¸è¿‡ Async æ›´åƒæ˜¯ Generator çš„è¯­æ³•ç³–.</p><h3 id="åŸºç¡€å®ç°"><a href="#åŸºç¡€å®ç°" class="headerlink" title="åŸºç¡€å®ç°"></a>åŸºç¡€å®ç°</h3><p>å­¦ä¹ <a href="https://tech.meituan.com/promise-insight.html" target="_blank" rel="noopener">å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</a>ç”¨ä¸€ä¸ªæœ€å¸¸è§çš„åº”ç”¨æ¥å‰–æ <code>Promise</code>, é€šè¿‡å¼‚æ­¥è·å–ç”¨æˆ· Id, ç„¶åä½œä¸€äº›å¤„ç†. å¹³å¸¸æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ˜¯å›è°ƒçš„æ–¹å¼æ¥å¤„ç†, ä¸‹é¢ç”¨ <code>Promise</code> çš„æ–¹å¼æ¥å¤„ç†.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getUserId = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">'http://example.com/api'</span>, <span class="attr">params</span>: param).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(<span class="built_in">JSON</span>.parse(res).id)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getUserId().then(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(id)</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>getUserId å‡½æ•°è¿”å›ä¸€ä¸ª <code>Promise</code>, åœ¨ä»–çš„ <code>then</code> æ–¹æ³•ä¸­æ”¾å…¥å¼‚æ­¥æ“ä½œæˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°. è¿™ç§æ–¹å¼æ˜æ˜¾æ¯”æˆ‘ä»¬ä¹‹å‰å¸¸ç”¨çš„å›è°ƒå‡½æ•°æ›´åŠ æ–¹ä¾¿è€Œä¸”æ˜“è¯», ä¹Ÿæ›´åŠ å®¹æ˜“é¿å… callback hell.</p><p>é‚£ä¹ˆæ»¡è¶³è¿™æ ·çš„åœºæ™¯çš„<code>Promise</code>æ˜¯æ€æ ·å®ç°çš„å‘¢, ä¸‹é¢æˆ‘ä»¬å¯ä»¥ç®€å•çš„å®ç°ä¸€ä¸‹æœ€åŸºç¡€çš„<code>Promise</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> deferreds = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. å­˜å…¥å¼‚æ­¥æˆåŠŸéœ€è¦çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶æŒ‡å‘ä¸¤ä¸ªå›è°ƒå‡½æ•° id =&gt; &#123;&#125;</span></span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">        deferreds.push(onFulfilled)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. æ‰§è¡Œ deferreds é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ value ä¸º123</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">            deferred(value)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. æ‰§è¡Œåˆ›å»º Promise å®ä¾‹æ—¶ä¼ å…¥çš„å‡½æ•°</span></span><br><span class="line">    <span class="comment">// å¹¶ä¼ å…¥ resolve ä¾›åœ¨é€‚å½“æ—¶è§¦å‘å›è°ƒ</span></span><br><span class="line">    fn(resolve)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserId = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 2. æ‰§è¡Œ resolve</span></span><br><span class="line">        resolve(<span class="number">123</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getUserId().then( <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this is callback!'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(id) <span class="comment">// 123</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this is second callback!'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(id) <span class="comment">// 123</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li>è°ƒç”¨ <code>then</code> æ–¹æ³•å°†å›è°ƒå‡½æ•°å­˜å…¥ deferreds é˜Ÿåˆ—.</li><li>åˆ›å»º <code>Promise</code> å®ä¾‹æ—¶ä¼ å…¥å‡½æ•°å’Œ <code>resolve</code>, <code>resolve</code> ç”¨äºåœ¨é€‚å½“çš„æ—¶é—´è§¦å‘å›è°ƒå‡½æ•°.</li><li>çœŸæ­£æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ˜¯ <code>deferreds</code> é˜Ÿåˆ—ä¸­çš„å…ƒç´ .</li><li><code>resolve</code> å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°, ç”¨äºå›è°ƒå‡½æ•°ä½¿ç”¨, å³å¼‚æ­¥æ“ä½œçš„è¿”å›ç»“æœ.</li></ul><p>å¯èƒ½å¤§å®¶å·²ç»å‘ç°, ä»¥ä¸Šä»£ç å¹¶ä¸èƒ½çœŸæ­£æ‰§è¡Œåˆ°å›è°ƒå‡½æ•°.æ ¹æ®ä¸Šé¢æ ‡æ³¨çš„åºå·å°±æ˜¯ä»£ç çš„æ‰§è¡Œé¡ºåº, è¿™æ˜¯å› ä¸ºç°åœ¨è¿˜æ˜¯åŒæ­¥å‡½æ•°, <code>Promise</code> å‡½æ•°ä¸­çš„ <code>resolve</code> å‡½æ•°ä¼šå…ˆäº <code>this.then</code> å‡½æ•°æ‰§è¡Œ,æ­¤æ—¶ <code>deferreds</code> é˜Ÿåˆ—ä¸­è¿˜æ˜¯ç©ºçš„, ä»¥è‡³äºåé¢çš„å›è°ƒå‡½æ•°ä¹Ÿæ— æ³•æ‰§è¡Œ. æ‰€ä»¥æˆ‘ä»¬è¦ä¿è¯å›è°ƒä»¥å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œ, ä»¥ä¿è¯æ‰§è¡Œé¡ºåº. å¯ä»¥é€šè¿‡ <code>setTimeout</code> å°† <code>resolve</code> ä¸­çš„å›è°ƒå‡½æ•°æ”¾åœ¨æ‰§è¡Œæ ˆçš„æœ«å°¾.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å°†æ‰§è¡Œçš„å›è°ƒçš„é€»è¾‘æ”¾å…¥æ‰§è¡Œæ ˆæœ«å°¾</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">            deferred(value)</span><br><span class="line">        &#125;)    </span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å°±å¯ä»¥çœ‹åˆ°, then ä¸­çš„å›è°ƒå‡½æ•°èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œäº†.</p><h4 id="å¼•å…¥çŠ¶æ€"><a href="#å¼•å…¥çŠ¶æ€" class="headerlink" title="å¼•å…¥çŠ¶æ€"></a>å¼•å…¥çŠ¶æ€</h4><p>ç°åœ¨æˆ‘ä»¬å¼•å…¥è§„èŒƒ <code>Promises/A+</code> ä¸­æ‰€è¯´çš„ States, å®ƒæœ‰ä¸‰ä¸ªäº’æ–¥çš„çŠ¶æ€: pending/ fulfilled/ rejected.</p><p>ç°åœ¨æˆ‘ä»¬æ¥æ”¹è¿›ä¸‹ä»£ç :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> deferreds = []</span><br><span class="line">    <span class="keyword">let</span> state = <span class="string">'pending'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">            deferreds.push(onFulfilled)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">        onFulfilled(value)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        value = newValue</span><br><span class="line">        state = <span class="string">'fulfilled'</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">            deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">                deferred(value)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fn(resolve)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä¸²è¡Œ-Promise"><a href="#ä¸²è¡Œ-Promise" class="headerlink" title="ä¸²è¡Œ Promise"></a>ä¸²è¡Œ Promise</h3><p>ä¸²è¡Œ <code>Promise</code> æ˜¯æŒ‡å½“ promise è¾¾åˆ° fuifilled çŠ¶æ€ä¹‹å, å†è¿›è¡Œä¸‹ä¸€ä¸ª promise. æ¯”å¦‚ä¸Šä¾‹ä¸­çš„æˆ‘ä»¬æ‹¿åˆ° userId ä¹‹åè¿˜éœ€è¦ç”¨è¿™ä¸ª userId å»è·å–ç”¨æˆ·çš„åç§°/ ä½å€/ æ‰‹æœºå·ç­‰å…¶ä»–ä¿¡æ¯.</p><p>ä½¿ç”¨çš„ä¼ªä»£ç ç±»ä¼¼è¿™æ ·:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getUserId()</span><br><span class="line">    .then(getUserInfoById)</span><br><span class="line">    .then(<span class="function"><span class="params">userInfo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">const</span> getUserInfoById = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">'http://example.com/api'</span>, <span class="attr">params</span>: &#123;</span><br><span class="line">            id: <span class="number">123</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(<span class="built_in">JSON</span>.parse(response).info)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getUserId = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="number">123</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸²è¡Œçš„å›°éš¾åœ¨äºå¦‚ä½•å°†å‰åçš„ <code>Promise</code> è¡”æ¥èµ·æ¥, é¦–å…ˆå¯¹ <code>then</code> æ–¹æ³•æ”¹é€ :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// bridge promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        handle(&#123;</span><br><span class="line">            onFulfilled: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">            resolve: resolve</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handle = <span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">        deferreds.push(deferred)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> ret = deferred.onFulfilled(value)</span><br><span class="line">    deferred.resolve(ret)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><code>then</code> æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„ Promise å®ä¾‹ä½œä¸ºè¿”å›å€¼, è¿™æ˜¯ä¸²è¡Œçš„åŸºç¡€, ç”±äºè¿”å›ç±»å‹ä¸€æ ·æ‰€ä»¥ä¾ç„¶æ”¯æŒé“¾å¼.</li><li><code>then</code> æ–¹æ³•ä¸­çš„å½¢å‚ <code>onFulfilled</code> å’Œæ–°åˆ›å»ºçš„ Promise å®ä¾‹ä¸­çš„ <code>resolve</code> å‡æ”¾å…¥å½“å‰ promise çš„ deferreds é˜Ÿåˆ—ä¸­.</li><li><code>handle</code> æ–¹æ³•ä½œä¸ºå½“å‰ promise çš„å†…éƒ¨æ–¹æ³•, è¾ƒä¹‹å‰çš„ <code>then</code> æ–¹æ³•åªå¢åŠ äº†ä¸€è¡Œ<code>deferred.resolve(ret)</code>.</li></ul><p>åœ¨å½“å‰ promise çš„å¼‚æ­¥æˆåŠŸä¹‹åæ‰§è¡Œ <code>handle</code> æ–¹æ³•æ—¶, å…ˆæ‰§è¡Œ <code>onFulfilled</code> æ–¹æ³•, ç„¶åå°†å…¶è¿”å›å€¼ä½œä¸º <code>resolve</code> æ–¹æ³•çš„å®å‚ä¼ å…¥.</p><p>å†æ”¹é€  <code>resolve</code> æ–¹æ³•, æŠŠä»£ç æ•´ç†ä¸€ä¸‹:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> deferreds = []</span><br><span class="line">    <span class="keyword">let</span> state = <span class="string">'pending'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Promiseä½œä¸ºè¿”å›å€¼</span></span><br><span class="line">        <span class="comment">// å°†å½“å‰ promise çš„å›è°ƒå‡½æ•°å’Œæ–°åˆ›å»ºçš„ resolve</span></span><br><span class="line">        <span class="comment">// æ”¾å…¥ deferreds é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span> (<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            handle(&#123;</span><br><span class="line">                onFulfilled: onFulfilled || <span class="literal">null</span></span><br><span class="line">                resolve: resolve</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handle = <span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–çŠ¶æ€æ—¶, å¾€ deferreds é˜Ÿåˆ—æ·»åŠ </span></span><br><span class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">            deferreds.push(deferred)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“å‰ promise è¾¾åˆ° 'fulfilled' çŠ¶æ€ä¹‹å</span></span><br><span class="line">        <span class="comment">// å…ˆæ‰§è¡Œå›è°ƒå‡½æ•°, å†å°†å›è°ƒå‡½æ•°çš„è¿”å›å€¼(ret)</span></span><br><span class="line">        <span class="comment">// ä¼ é€’ç»™ resolve å‡½æ•°</span></span><br><span class="line">        <span class="keyword">let</span> ret = deferred.onFulfilled(value)</span><br><span class="line">        deferred.resolve(ret)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">            <span class="keyword">let</span> then = newValue.then</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">                then.call(newValue, resolve)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        value = newValue</span><br><span class="line">        state = <span class="string">'fulfilled'</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">            deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">                handle(deferred)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œ promise å®ä¾‹ä¸­çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    fn(resolve)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getUserId()</span><br><span class="line">    .then(getUserInfoById)</span><br><span class="line">    .then(<span class="function"><span class="params">userInfo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'this is second callback'</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ <code>resolve</code> æ”¯æŒä¼ å…¥ä¸€ä¸ª promise å®ä¾‹çš„å‚æ•°äº†, æ‰§è¡Œé¡ºåºå¦‚ä¸‹:</p><ol><li><code>getUserId</code> ç”Ÿæˆçš„ promise1, è¿›å…¥ Promise å‡½æ•°æ‰§è¡Œ <code>fn(resolve)</code> ç”±äº<code>getUserId</code> çš„å†…éƒ¨æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œ, ä¸‹ä¸€æ­¥ä¼šç›´æ¥æ‰§è¡Œ <code>this.then(onFulfilled)</code>.</li><li><code>this.then()</code> è¿”å›ä¸€ä¸ªæ–°çš„ promise2 å‡½æ•°( å³: bridge promise)ä½œä¸ºé“¾å¼è°ƒç”¨, promise2 é‡æ–°å®ä¾‹åŒ–å†æ‰§è¡Œ <code>fn(resolve)</code>, åˆ™è¿›å…¥<code>handle({...})</code> æ­¤æ—¶ handle çš„å‚æ•°ä¸º getUserInfoById å’Œ resolve2, æ¥ç€è¢« push åˆ° <code>deferreds1</code> é˜Ÿåˆ—ä¸­; å†æ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ª<code>this.then()</code> ç”Ÿæˆ promise3, <code>deferreds2</code> é˜Ÿåˆ—ä¸­ push è¿›ç¬¬äºŒä¸ª then çš„åŒ¿åå‡½æ•°(userInfo =&gt; {â€¦}) å’Œ resolve3.</li><li>æ‰§è¡Œ<code>resolve(123)</code>, è¿›å…¥ <code>resolve(newValue)</code> æ‰§è¡Œ<code>handle(deferred)</code> æ­¤æ—¶ deferred ä¸º getUserInfoById å’Œ resolve2, æ‰§è¡Œ handle å†…éƒ¨çš„ <code>deferred.onFulfilled(value)</code> ä¹Ÿå°±æ˜¯ getUserInfoById æ–¹æ³•ä»è€Œç”Ÿæˆ promise4, å†åˆ° <code>deferred.resolve(ret)</code> è¿™ä¸ªæ—¶å€™ ret å°±ä¸º promise4, ä¼ å…¥ <code>resolve(newValue)</code> æ‰§è¡Œ <code>then.call(promise4, resolve2)</code>.</li><li>æ¥ç€ä¸Šä¸€æ­¥è¿›å…¥ <code>this.then()</code> ç”Ÿæˆ promise5(bridge promise), deferred4 å‹å…¥ resolve2 å’Œ resolve5; åœ¨æ‰§è¡Œ getUserInfoById ä¸­çš„ <code>resolve({name: &#39;cara&#39;...})</code>, è¿›å…¥ setTimeout ä¸­çš„ <code>handle(deferred)</code>, åˆ° handle å‡½æ•°å†…éƒ¨ <code>deferred.onFulfilled(value)</code> å…¶å®æ‰§è¡Œçš„æ˜¯ <code>resolve2({...})</code> resolve2ä¸­çš„ <code>deferred</code> ä¿å­˜çš„æ˜¯çš„ <code>uerInfo =&gt; {}</code> åŒ¿åå‡½æ•°å’Œ <code>resolve3</code>; <code>deferred.resolve</code> å…¶å®æ‰§è¡Œçš„æ˜¯ <code>resolve5</code>, ç”±äº resolve3 å’Œ resolve5 ä¸­çš„ <code>deferred</code> éƒ½æ˜¯ç©ºçš„äºæ˜¯å®Œæˆæ•´ä¸ªæµç¨‹.</li></ol><p>æ¥ä¸‹æ¥å†åŠ å…¥é”™è¯¯å¤„ç†å’Œå¼‚å¸¸åˆ¤æ–­:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> state = <span class="string">'pending'</span>,</span><br><span class="line">        value = <span class="literal">null</span>,</span><br><span class="line">        deferreds = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">            handle(&#123;</span><br><span class="line">                onFulfilled: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">                onRejected: onRejected || <span class="literal">null</span>,</span><br><span class="line">                resolve: resolve,</span><br><span class="line">                reject: reject</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">            deferreds.push(deferred);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> cb = state === <span class="string">'fulfilled'</span> </span><br><span class="line">            ? deferred.onFulfilled </span><br><span class="line">            : deferred.onRejected,</span><br><span class="line">                ret;</span><br><span class="line">        <span class="keyword">if</span> (cb === <span class="literal">null</span>) &#123;</span><br><span class="line">            cb = state === <span class="string">'fulfilled'</span> </span><br><span class="line">                ? deferred.resolve </span><br><span class="line">                : deferred.reject;</span><br><span class="line">            cb(value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ret = cb(value);</span><br><span class="line">            deferred.resolve(ret);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            deferred.reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">            <span class="keyword">var</span> then = newValue.then;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">                then.call(newValue, resolve, reject);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        state = <span class="string">'fulfilled'</span>;</span><br><span class="line">        value = newValue;</span><br><span class="line">        finale();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">        state = <span class="string">'rejected'</span>;</span><br><span class="line">        value = reason;</span><br><span class="line">        finale();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">finale</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            deferreds.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">                handle(deferred);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn(resolve, reject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>ä¹‹å‰çš„æ–‡å­—æè¿°ä¸å¥½ç†è§£, æ‰€ä»¥è¿˜æ˜¯ç”»äº†ä¸€ä¸ªæ‰§è¡Œæµç¨‹å›¾</strong><br><img src="/img/Promiseæ‰§è¡Œè¿‡ç¨‹.png" alt="promiseæ‰§è¡Œè¿‡ç¨‹"></p><p>æ²¡æœ‰ç”» <code>reject</code> çš„æƒ…å†µ, å› ä¸º<code>reject</code> è·Ÿ <code>resolve</code> çš„æµç¨‹æ˜¯ä¸€æ ·çš„, ä¸¤ä¸ªä¸€èµ·ç”»æ˜¾å¾—æ›´ä¹±å°±å•ç‹¬æŠŠ <code>resolve</code> æ‹å‡ºæ¥. åœ¨åŠ å…¥ <code>handle</code> å’Œ <code>resolve</code> åœ¨ promise å‡½æ•°ä¸­ä½œä¸ºå†…éƒ¨æ–¹æ³•åå®åœ¨ä¸æ˜“ç†è§£. ä¸»è¦å°±æ˜¯é€šè¿‡é—­åŒ…æ¥ä¿å­˜ promise å¯¹è±¡çš„å˜é‡å¼•ç”¨, å°†å›è°ƒå‡½æ•°å’Œ resolve å‡½æ•°ä¿å­˜åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­, åœ¨é€šè¿‡ resolve å®Œæˆé“¾å¼è°ƒç”¨.</p><h2 id="å…¶ä»–å®ç°"><a href="#å…¶ä»–å®ç°" class="headerlink" title="å…¶ä»–å®ç°"></a>å…¶ä»–å®ç°</h2><p>çœ‹å®Œä¹‹å‰çš„é‚£ç¯‡æ–‡ç« å®åœ¨è§‰å¾—æœ‰ç‚¹éš¾ç†è§£, äºæ˜¯åˆæ‰¾äº†å…¶ä»–çš„å®ç°æ–¹å¼<a href="http://bruce-xu.github.io/blogs/js/promise" target="_blank" rel="noopener">JS Promiseçš„å®ç°åŸç†</a>æ¯”ä¹‹å‰é‚£ç¯‡æ›´å¥½ç†è§£ä¸€äº›, æ‰€ä»¥è¿˜æ˜¯è®°å½•ä¸€ä¸‹å¥½äº†.</p><blockquote><p>è¿™ç¯‡æ–‡ç« ä½œè€…è¯´åˆ°çš„ <code>Promise</code> é‡ç‚¹:</p><ol><li><code>Promise</code> æ˜¯ä¸€ä¸ªæ‰¿è¯º, æ‰€ä»¥ä¸ç®¡æˆåŠŸä¸å¦éƒ½è¦æœ‰ä¸€ä¸ªæ‰§è¡Œç»“æœ, å› æ­¤ Promise æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•° <code>resolver</code> æ¥ä½œä¸ºä¸è¯¥ promise å¯¹è±¡å…³è”çš„ä»»åŠ¡.</li><li>ä¸‰ç§çŠ¶æ€ä¸å¯é€†è½¬.</li><li><code>resolver</code> å‡½æ•°å°è£…äº†éœ€è¦æ‰§è¡Œçš„å¼‚æ­¥æ“ä½œ, å†…éƒ¨: <code>resolve</code> å’Œ <code>reject</code> ä¸¤ä¸ªå‚æ•°; åˆ†åˆ«ä»£è¡¨æ‰§è¡ŒæˆåŠŸå’Œæ‰§è¡Œå¤±è´¥éœ€è¦æ‰§è¡Œçš„æ“ä½œ.</li><li><code>then</code> æä¾›æˆåŠŸæˆ–å¤±è´¥çš„å“åº”å¤„ç†, äºæ˜¯æœ‰äº†<code>onResolve</code> å’Œ <code>onReject</code>.</li><li><code>then</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ promise(bridge promise), æä¾›é“¾å¼æ“ä½œåŠä¸²è¡Œ, å¦‚æœç›´æ¥è¿”å› this é‚£ä¹ˆå°±æ˜¯å¹¶è¡Œæ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚. å‰ä¸€ä¸ª promise éœ€è¦çŸ¥é“ä¸‹ä¸€ä¸ª promise å¯¹è±¡æ˜¯è°åŠå…¶ä»»åŠ¡å¼•ç”¨, è€Œåä¸€ä¸ª promise è¦æä¾›ä¸€ä¸ªç»™å‰ä¸€ä¸ª promise æˆåŠŸæˆ–å¤±è´¥æ—¶éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡, å› æ­¤æ·»åŠ ä¸€ä¸ªé—­åŒ…</li><li><code>makeCallback</code> è°ƒç”¨å°† promise åŠå…¶å…³è”ä»»åŠ¡ä¼ é€’è¿›å», è¿”å›ä¸€ä¸ªæ–°å‡½æ•°, å‰ä¸€ä¸ª promise å¯¹è±¡å°±å°†æŒæœ‰è¿”å›å‡½æ•°çš„å¼•ç”¨, è°ƒç”¨è¿”å›å‡½æ•°æ—¶å°±èƒ½è®¿é—®åˆ° promise å¯¹è±¡å’Œå…³è”ä»»åŠ¡.</li><li><code>resolve</code> å’Œ <code>reject</code> å‡½æ•°åœ¨å¼‚æ­¥æˆåŠŸæˆ–å¤±è´¥çš„æ—¶å€™è°ƒç”¨, å¹¶ä¼ é€’æˆåŠŸçš„æ•°æ®å’Œå¤±è´¥çš„åŸå› .</li><li><code>run</code> å‡½æ•°æ‰§è¡Œå¼‚æ­¥ç›¸å…³çš„å›è°ƒå‡½æ•°.</li></ol></blockquote><h3 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h3><ul><li>æ„é€ å‡½æ•°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">resolver</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">this</span>._status = <span class="string">'pending'</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆåŠŸé˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">this</span>._doneCallbacks = []</span><br><span class="line">    <span class="comment">// å¤±è´¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">this</span>._failCallbacks = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¼ é€’å…³è”ä»»åŠ¡</span></span><br><span class="line">    resolver(resolve, reject)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>then</code> æ–¹æ³•</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onResolve, onReject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ é—­åŒ…è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜å¯¹ä¸Šä¸€ä¸ª promise çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">this</span>._doneCallbacks.push(makeCallback(promise, onResolve, <span class="string">'reslove'</span>))</span><br><span class="line">    <span class="keyword">this</span>._failCallbacks.push(makeCallback(promise, onReject, <span class="string">'reject'</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>makeCallback</code> å‡½æ•°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise å¯¹è±¡/ å›è°ƒå‡½æ•°(å…³è”ä»»åŠ¡)/ ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCallback</span> (<span class="params">promise, callback, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseCallback</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>resolve</code> å‡½æ•°å’Œ <code>reject</code> å‡½æ•°<br>è¿™ä¸¤ä¸ªå‡½æ•°éƒ½éœ€è¦ä¸€ä¸ªå‚æ•°æ¥æ¥æ”¶ç»“æœ, ç”±äºçŠ¶æ€åªèƒ½è½¬æ¢ä¸€æ¬¡æ‰€ä»¥ä¸¤ä¸ªå‡½æ•°éƒ½éœ€è¦åˆ¤æ–­çŠ¶æ€.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆåŠŸ</span></span><br><span class="line"><span class="comment">// promise: å±äºå“ªä¸ª promise å¯¹è±¡</span></span><br><span class="line"><span class="comment">// data: å¼‚æ­¥æ“ä½œçš„ç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">promise, data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å·²ç»è¢« resolve è¿‡çš„è¯ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (promise._status !== <span class="string">'pending'</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿®æ”¹ promise çŠ¶æ€</span></span><br><span class="line">    promise._status = <span class="string">'fulfilled'</span></span><br><span class="line">    <span class="comment">// ä¿å­˜å¼‚æ­¥æ“ä½œçš„å€¼</span></span><br><span class="line">    promise._value = data</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œç›¸å…³å›è°ƒå‡½æ•°</span></span><br><span class="line">    run(promise)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤±è´¥</span></span><br><span class="line"><span class="comment">// promise: å±äºå“ªä¸ª promise å¯¹è±¡</span></span><br><span class="line"><span class="comment">// reason: å¤±è´¥åŸå› </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reject</span> (<span class="params">promise, reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (promise._status !== <span class="string">'pending'</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    promise._status = <span class="string">'rejected'</span></span><br><span class="line">    promise._value = reason</span><br><span class="line">    </span><br><span class="line">    run(promise)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>run</code> å‡½æ•°<br>ç”¨æ¥æ‰§è¡Œå¼‚æ­¥ç›¸å…³çš„å›è°ƒå‡½æ•°.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span> (<span class="params">promise</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// then æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨, æ­¤å¤„å†åšä¸€æ¬¡åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (promise._status === <span class="string">'pending'</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> value = promise._value</span><br><span class="line">    <span class="comment">// æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">let</span> callbacks = promise._status === <span class="string">'fulfilled'</span></span><br><span class="line">        ? promise._doneCallbacks</span><br><span class="line">        : promise._failCallbacks</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿™é‡Œéœ€è¦å¼‚æ­¥</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line">        callbacks.map(<span class="function"><span class="params">cb</span> =&gt;</span> cb(value))</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    promise._doneCallbacks = []</span><br><span class="line">    promise._failCallbacks = []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>run</code> å‡½æ•°ä¸­çš„ callbacks å°±æ˜¯ <code>makeCallback</code> æ‰€è¿”å›çš„å‡½æ•°</strong></p><ul><li>å®Œå–„ <code>makeCallback</code> å‡½æ•°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCallback</span> (<span class="params">promise, callback, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseCallback</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœ callback æ˜¯ä¸ªå‡½æ•°, ä½¿ç”¨å‰ä¸€ä¸ª promise</span></span><br><span class="line">        <span class="comment">// ä¼ é€’çš„å€¼ä½œä¸º callback çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">'function'</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> x</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                x = callback(value)</span><br><span class="line">            &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="comment">// å¼‚å¸¸æ—¶, ç”¨å½“å‰ promise çš„ reject</span></span><br><span class="line">                reject(promise, e)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœ callback è¿”å›çš„æ˜¯å½“å‰çš„ promise</span></span><br><span class="line">            <span class="comment">// è¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (x === promise) &#123;</span><br><span class="line">                <span class="keyword">let</span> reason = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Error: return value could not be same with the promise'</span>)</span><br><span class="line">                reject(promise, reason)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ª promise å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// åˆ™å½“è¿”å› promise å¯¹è±¡è¢« reoslve/ rejectå</span></span><br><span class="line">            <span class="comment">// å†æ‰§è¡Œå½“å‰çš„ promise çš„ resolve/ reject</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">                x.then(</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                        resolve(promise, data)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">                        reject(promise, reason)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> then</span><br><span class="line">                (<span class="function"><span class="keyword">function</span> <span class="title">resolveThenable</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ª Thenable å¯¹è±¡</span></span><br><span class="line">                    <span class="keyword">if</span> (x &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">'object'</span> || <span class="keyword">typeof</span> x === <span class="string">'function'</span>)) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            then = x.then</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                            reject(promise, e)</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">                            <span class="comment">// è°ƒç”¨ Thenable å¯¹è±¡çš„ thenæ–¹æ³•</span></span><br><span class="line">                            <span class="comment">// ä¼ é€’è¿›å»çš„ resolvePromise å’Œ rejectPromise ä»¥åŠä¸‹é¢ä¸¤ä¸ªåŒ¿åå‡½æ•°</span></span><br><span class="line">                            <span class="comment">// å¯èƒ½ä¼šé‡å¤è°ƒç”¨, ä½†æ˜¯è§„èŒƒåªèƒ½æœ‰å…¶ä¸­ä¸€ä¸ªè¢«è°ƒç”¨ä¸€æ¬¡, å…¶ä»–è¦è¢«å¿½ç•¥</span></span><br><span class="line">                            <span class="keyword">let</span> invoked = <span class="literal">false</span></span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                then.call(x,</span><br><span class="line">                                    <span class="function"><span class="keyword">function</span> (<span class="params">y</span>) </span>&#123;</span><br><span class="line">                                        <span class="keyword">if</span> (invoked) <span class="keyword">return</span></span><br><span class="line">                                        invoked = <span class="literal">true</span></span><br><span class="line">                                        </span><br><span class="line">                                        <span class="comment">// é¿å…ä¸¤ä¸ª promise æ’ç­‰</span></span><br><span class="line">                                        <span class="keyword">if</span> (y === x) &#123;</span><br><span class="line">                                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Error: return value could not be same with the promise'</span>)</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        </span><br><span class="line">                                    <span class="comment">// y æœ‰å¯èƒ½è¿˜æ˜¯ thenable å¯¹è±¡    </span></span><br><span class="line">                                    resolveThenable(y)</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">                                        <span class="keyword">if</span> (invoked) <span class="keyword">return</span></span><br><span class="line">                                        invoked = <span class="literal">true</span></span><br><span class="line">                                        </span><br><span class="line">                                        reject(promise, e)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                )</span><br><span class="line">                            &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                                    <span class="comment">// å¦‚æœ`resolvePromise`å’Œ`rejectPromise`æ–¹æ³•è¢«è°ƒç”¨åï¼Œå†æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™å¿½ç•¥å¼‚å¸¸</span></span><br><span class="line">                                    <span class="comment">// å¦åˆ™ç”¨å¼‚å¸¸å¯¹è±¡rejectæ­¤Promiseå¯¹è±¡</span></span><br><span class="line">                                <span class="keyword">if</span> (!invoked) &#123;</span><br><span class="line">                                    reject(promise, e)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            resolve(promise, x)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        resolve(promise, x)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;(x))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ä¼  callbackç›´æ¥ä½¿ç”¨å‰ä¸€ä¸ª promise</span></span><br><span class="line">        <span class="comment">// ä¼ è¿‡æ¥çš„å€¼ resolve/reject å½“å‰ promise å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            action === <span class="string">'resolve'</span></span><br><span class="line">                ? resolve(promise, value)</span><br><span class="line">                : reject(promise, value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æˆ‘ä¸€å¼€å§‹æ˜¯å…ˆçœ‹çš„<strong>å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</strong>, å‰åŠéƒ¨åˆ†ç¡®å®å¾ˆäº²æ°‘, ä½†æ˜¯åˆ°åŠ å…¥ <code>hanlde</code> å’Œæ”¹é€  <code>resolve</code> å‡½æ•° å°±å¼€å§‹æ‡µäº†, ç„¶åæ‡µæ‡µæ‡‚æ‡‚çš„å»çœ‹<strong>JS Promise çš„åŸç†å®ç°</strong>, ä¸è¿‡åœ¨æœ€å¤æ‚çš„ <code>makeCallback</code> å‡½æ•°ä¸­è§£é‡Šæœ‰ç‚¹ä¸€ç¬”å¸¦è¿‡çš„æ„æ€. ä¸è¿‡çœ‹äº†è¿™ç¯‡å¸®åŠ©æˆ‘ç†è§£ä¹‹å‰çš„<strong>å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</strong>, å°±è¿”å›å»çœ‹åŸºç¡€ç¯‡ç”»äº†ä¸€éæµç¨‹å›¾æ‰ç®—çœ‹æ‡‚, é‡Œé¢çš„é—­åŒ…ç”¨çš„å¤ªç²¾å¦™äº†.</p><blockquote><p>å‚è€ƒæ–‡ç« <br><a href="https://tech.meituan.com/promise-insight.html" target="_blank" rel="noopener">å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</a><br><a href="http://bruce-xu.github.io/blogs/js/promise" target="_blank" rel="noopener">JS Promise çš„åŸç†å®ç°</a><br><a href="https://github.com/xieranmaya/blog/issues/3" target="_blank" rel="noopener">å‰–æPromiseå†…éƒ¨ç»“æ„</a></p></blockquote><p>Created on 2017-12-26 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Promise æ˜¯ ES6ä¸­ä¸­æ”¶å½•çš„å¼‚æ­¥æ“ä½œå°è£…, é€šå¸¸åœ¨å›è°ƒ/ äº‹ä»¶/ æ¶ˆæ¯ç­‰å¼‚æ­¥æ“ä½œä¸­æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿, è®©æˆ‘ä»¬åœ¨æ›´æ–¹ä¾¿çš„æ“ä½œå¼‚æ­¥ä¹Ÿè®©ä»£ç æ›´åŠ æ¸…æ™°.åŒ…æ‹¬ ES7ä¸­çš„ Async/Await ä¹Ÿæ˜¯å¯¹å¼‚æ­¥æ“ä½œçš„å°è£…, ä¸è¿‡ Async æ›´åƒæ˜¯ Generator çš„è¯­æ³•ç³–.&lt;/
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šå›¾è§£ HTTPã€‹(ä¸Š)</title>
    <link href="https://yoursite.com/2018/01/03/HTTP-%E4%B8%8A/"/>
    <id>https://yoursite.com/2018/01/03/HTTP-ä¸Š/</id>
    <published>2018-01-03T14:03:05.000Z</published>
    <updated>2018-05-13T03:49:29.854Z</updated>
    
    <content type="html"><![CDATA[<p>Webä½¿ç”¨HTTP(HyperText Transfer Protocal) è¶…æ–‡æœ¬ä¼ è¾“åè®®ä½œä¸ºè§„èŒƒ, å®Œæˆä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ä¸€ç³»åˆ—æµç¨‹. å¯ä»¥è¯´ Web æ˜¯åœ¨ HTTP åè®®ä¸Šé€šä¿¡çš„.</p><h3 id="1-0-ç½‘ç»œåŸºç¡€TCP-IP"><a href="#1-0-ç½‘ç»œåŸºç¡€TCP-IP" class="headerlink" title="1.0 ç½‘ç»œåŸºç¡€TCP/IP"></a>1.0 ç½‘ç»œåŸºç¡€TCP/IP</h3><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„ç½‘ç»œæ˜¯åœ¨ TCP/IP åè®®æ—çš„åŸºç¡€ä¸Šè¿è¡Œçš„, è€Œ HTTP æ˜¯å±äº TCP/IP æ—ç¾¤ä¸­çš„ä¸€ç§åè®®. åœ¨è®¡ç®—æœºå’Œç½‘ç»œç›¸äº’é€šä¿¡çš„æ—¶å€™, ä¸¤è€…éƒ½å¿…é¡»è¦éµå®ˆåŒä¸€ç§åè®®.</p><h4 id="1-1-TCP-IPåˆ†å±‚ç®¡ç†"><a href="#1-1-TCP-IPåˆ†å±‚ç®¡ç†" class="headerlink" title="1.1 TCP/ IPåˆ†å±‚ç®¡ç†"></a>1.1 TCP/ IPåˆ†å±‚ç®¡ç†</h4><p>TCP/IPåè®®æ—é‡Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯åˆ†å±‚, æ¯ä¸€å±‚å°±åªéœ€è¦ä¸“æ³¨äºè‡ªå·±ä»»åŠ¡å°±è¡Œäº†, æŒ‰å±‚æ¬¡åˆ†åˆ«ä¸ºä»¥ä¸‹å››å±‚:</p><ol><li><p>åº”ç”¨å±‚<br>å†³å®šå‘ç”¨æˆ·æä¾›åº”ç”¨æœåŠ¡æ—¶çš„é€šä¿¡æ´»åŠ¨, åœ¨ TCP/IP ä¸­é¢„å­˜äº†å„ç±»é€šç”¨çš„åº”ç”¨æœåŠ¡. æ¯”å¦‚: FTP(File Transfer Protocol, æ–‡ä»¶ä¼ è¾“åè®®)å’Œ DNS(Domain Name System, åŸŸåç³»ç»Ÿ), HTTP åè®®ä¹Ÿå±äºè¿™å±‚.</p></li><li><p>ä¼ è¾“å±‚<br>ç»™ä¸¤ä¸ªè®¡ç®—æœºåœ¨ç½‘ç»œä¸­æä¾›æ•°æ®ä¼ è¾“. TCP(ä¼ è¾“æ§åˆ¶åè®®)å’Œ UDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)</p></li><li><p>ç½‘ç»œå±‚<br>å¤„ç†ç½‘ä¸ŠæµåŠ¨çš„æ•°æ®åŒ…, å†³å®šæ•°æ®é€šè¿‡å“ªæ¡ä¼ è¾“è·¯çº¿åˆ°å¯¹æ–¹è®¡ç®—æœºå¹¶æŠŠæ•°æ®ä¼ è¾“ç»™å¯¹æ–¹.</p></li><li><p>é“¾è·¯å±‚<br>å¤„ç†è¿æ¥ç½‘ç»œçš„ç¡¬ä»¶éƒ¨åˆ†. ç½‘å¡/ é©±åŠ¨/ å…‰çº¤ä»€ä¹ˆçš„</p></li></ol><h4 id="1-2-TCP-IP-ä¼ è¾“æµç¨‹"><a href="#1-2-TCP-IP-ä¼ è¾“æµç¨‹" class="headerlink" title="1.2 TCP/IP ä¼ è¾“æµç¨‹"></a>1.2 TCP/IP ä¼ è¾“æµç¨‹</h4><p>TCP/IP åœ¨ç½‘ç»œé€šä¿¡æ—¶, ä¼šæŒ‰ç…§åˆ†å±‚é¡ºåºä¸å¯¹æ–¹é€šä¿¡. å‘é€ç«¯ä»åº”ç”¨å±‚å¾€ä¸‹, æ¥æ”¶ç«¯ä»åº”ç”¨ç«¯ç½‘ä¸Š.</p><p><img src="/img/http.jpg" alt="TCP/IPä¼ è¾“æµç¨‹"></p><h3 id="2-0-ä¸-HTTP-å…³ç³»å¯†åˆ‡çš„åè®®-IP-TCP-å’Œ-DNS"><a href="#2-0-ä¸-HTTP-å…³ç³»å¯†åˆ‡çš„åè®®-IP-TCP-å’Œ-DNS" class="headerlink" title="2.0 ä¸ HTTP å…³ç³»å¯†åˆ‡çš„åè®®: IP/TCP å’Œ DNS"></a>2.0 ä¸ HTTP å…³ç³»å¯†åˆ‡çš„åè®®: IP/TCP å’Œ DNS</h3><ul><li>è´Ÿè´£ä¼ è¾“çš„ IP åè®®<br>å°†æ•°æ®åŒ…ä¼ é€’ç»™å¯¹æ–¹å¹¶ç¡®è®¤åˆ°è¾¾, ç¡®è®¤åˆ°è¾¾çš„é‡è¦æ¡ä»¶åŒ…æ‹¬: IP åœ°å€å’Œ MAC åœ°å€.<br><img src="/img/ip.jpg" alt="IP"></li><li>ç¡®ä¿å¯é æ€§çš„ TCP åè®®<br>ä¸ºäº†æ–¹ä¾¿ä¼ è¾“å°†å¤§æ•°æ®åŒ…åˆ†å‰²æˆä»¥æŠ¥æ–‡æ®µä¸ºå•ä½çš„æ•°æ®åŒ…è¿›è¡Œç®¡ç†, å†å°†æ•°æ®å‡†ç¡®å¯é çš„ä¼ é€’ç»™å¯¹æ–¹. é‚£ä¹ˆå¦‚ä½•å‡†ç¡®å¯é çš„ä¼ é€’ç»™å¯¹æ–¹å‘¢, æ‰€ä»¥å°±æœ‰äº†TCP çš„ä¸‰æ¬¡æ¡æ‰‹ç­–ç•¥: å‘é€ç«¯å…ˆå‘é€ä¸€ä¸ªå¸¦æœ‰ <code>SYN</code>æ ‡å¿—çš„æ•°æ®åŒ…ç»™å¯¹æ–¹, æ¥æ”¶ç«¯å›ä¼ ä¸€ä¸ªå¸¦æœ‰<code>SYN/ACK</code>æ ‡å¿—çš„æ•°æ®åŒ…ä¼ è¾¾ç¡®è®¤ä¿¡æ¯, æœ€åå‘é€ç«¯å†å›ä¼ ä¸€ä¸ªå¸¦æœ‰<code>ACK</code>æ ‡å¿—çš„æ•°æ®åŒ…, ä»£è¡¨æ¡æ‰‹ç»“æŸ.<br><img src="/img/tcp.jpg" alt="TCP"></li><li>è´Ÿè´£åŸŸååè®®çš„ DNS æœåŠ¡<br>æä¾›åŸŸååˆ° IP åœ°å€ä¹‹é—´è§£ææœåŠ¡.<br><img src="/img/dns.jpg" alt="DNS"></li></ul><h4 id="2-1-HTTP-åè®®çš„é€šä¿¡è¿‡ç¨‹"><a href="#2-1-HTTP-åè®®çš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="2.1 HTTP åè®®çš„é€šä¿¡è¿‡ç¨‹"></a>2.1 HTTP åè®®çš„é€šä¿¡è¿‡ç¨‹</h4><p>é€šè¿‡ä¸€æ•´å¥—æµç¨‹æ¥çœ‹ä¸€ä¸‹, IPåè®®/ TCPåè®® å’Œ DNSæœåŠ¡åœ¨ HTTPåè®®çš„é€šä¿¡è¿‡ç¨‹ä¸­å„è‡ªå‘æŒ¥äº†ä»€ä¹ˆä½œç”¨.<br><img src="/img/HTTP_IP_TCP_DNS.jpg" alt="HTTPåè®®é€šä¿¡è¿‡ç¨‹"></p><p><strong>ä»ä¸Šå›¾æ¥çœ‹, ä»è¾“å…¥ä¸€ä¸ªç½‘å€åˆ°é¡µé¢çš„å±•ç¤ºè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹:</strong></p><ol><li>åŸŸåè§£æ(DNS æœåŠ¡)</li><li>å»ºç«‹TCP, å‘é€ HTTP è¯·æ±‚(ä¸‰æ¬¡æ¡æ‰‹)<ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚(SYN)</li><li>æœåŠ¡å™¨åº”ç­”å¹¶è¦æ±‚ç¡®è®¤(SYN/ACK)</li><li>å®¢æˆ·ç«¯ç¡®è®¤(ACK)</li></ol></li><li>IP æœç´¢å¯¹æ–¹åœ°å€, ä¸€è¾¹ä¸­è½¬ä¸€è¾¹ä¼ è¾“æ•°æ®åŒ…</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚è¿”å› HTTP å“åº”æŠ¥æ–‡</li><li>è¿æ¥ç»“æŸ(å››æ¬¡æŒ¥æ‰‹)<ol><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN æ¥å‘Šè¯‰æœåŠ¡å™¨æ•°æ®å‘é€å®Œæ¯•</li><li>æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ª FIN ä¹‹åå›å‘ä¸€ä¸ª ACK(è¿™ä¸ªæ—¶å€™æœåŠ¡å™¨è¿˜å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ•°æ®)</li><li>æœåŠ¡å™¨å‘é€ä¸€ä¸ª FIN å‘Šè¯‰å®¢æˆ·ç«¯æœåŠ¡å™¨çš„æ•°æ®å‘é€å®Œæ¯•, è¯·æ±‚å…³é—­è¿æ¥</li><li>å®¢æˆ·ç«¯å›å‘ ACK ç¡®è®¤, å…³é—­è¿æ¥</li></ol></li><li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</li></ol><h4 id="2-2-HTTP-æ˜¯å¦ä¿å­˜çŠ¶æ€"><a href="#2-2-HTTP-æ˜¯å¦ä¿å­˜çŠ¶æ€" class="headerlink" title="2.2 HTTP æ˜¯å¦ä¿å­˜çŠ¶æ€"></a>2.2 HTTP æ˜¯å¦ä¿å­˜çŠ¶æ€</h4><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€(æ— çŠ¶æ€)åè®®, åè®®æœ¬èº«ä¸ä¼šä¿ç•™ä¹‹å‰çš„è¯·æ±‚æˆ–å“åº”æŠ¥æ–‡çš„ä¿¡æ¯. è¿™æ˜¯ä¸ºäº†æ›´å¿«çš„å¤„ç†å¤§é‡è¯·æ±‚, ä½†æ˜¯éšç€ Web å‘å±•<br>å¾ˆå¤šä¸šåŠ¡éƒ½éœ€è¦ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€, å› æ­¤å¼•å…¥ Cookie æ¥ç®¡ç†çŠ¶æ€.</p><h3 id="3-0-HTTP-è¿”å›çŠ¶æ€ç "><a href="#3-0-HTTP-è¿”å›çŠ¶æ€ç " class="headerlink" title="3.0 HTTP è¿”å›çŠ¶æ€ç "></a>3.0 HTTP è¿”å›çŠ¶æ€ç </h3><p>çŠ¶æ€ç æ˜¯ç”¨æ¥å‘Šè¯‰å®¢æˆ·ç«¯ä»æœåŠ¡å™¨å“åº”çš„è¯·æ±‚ç»“æœ, å¯ä»¥é€šè¿‡çŠ¶æ€ç çŸ¥é“è¯¥æ¬¡è¯·æ±‚æ˜¯æ­£å¸¸å¤„ç†äº†è¿˜æ˜¯å‘ç”Ÿäº†é”™è¯¯.</p><h4 id="3-1-çŠ¶æ€ç çš„ç±»åˆ«"><a href="#3-1-çŠ¶æ€ç çš„ç±»åˆ«" class="headerlink" title="3.1 çŠ¶æ€ç çš„ç±»åˆ«"></a>3.1 çŠ¶æ€ç çš„ç±»åˆ«</h4><table><thead><tr><th></th><th style="text-align:left">ç±»åˆ«</th><th style="text-align:left">åŸå› çŸ­å¥</th></tr></thead><tbody><tr><td>1XX</td><td style="text-align:left">ä¿¡æ¯ç±»</td><td style="text-align:left">æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç†</td></tr><tr><td>2XX</td><td style="text-align:left">æˆåŠŸç±»</td><td style="text-align:left">è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•</td></tr><tr><td>3XX</td><td style="text-align:left">é‡å®šå‘ç±»</td><td style="text-align:left">éœ€è¦é™„åŠ æ“ä½œå®Œæˆè¯·æ±‚</td></tr><tr><td>4XX</td><td style="text-align:left">å®¢æˆ·ç«¯é”™è¯¯ç±»</td><td style="text-align:left">æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚</td></tr><tr><td>5XX</td><td style="text-align:left">æœåŠ¡å™¨é”™è¯¯ç±»</td><td style="text-align:left">æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯</td></tr></tbody></table><h4 id="3-2-å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç "><a href="#3-2-å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç " class="headerlink" title="3.2 å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç "></a>3.2 å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç </h4><ul><li>2XX æˆåŠŸç±»<ol><li>200 OK<br>è¡¨ç¤ºè¯·æ±‚åœ¨æœåŠ¡ç«¯è¢«æ­£å¸¸å¤„ç†äº†</li><li>204  No Content<br>è¡¨ç¤ºè¯·æ±‚å¤„ç†æˆåŠŸä½†æ˜¯å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“(æœ¬èº«ä¹Ÿä¸å…è®¸è¿”å›å®ä½“çš„ä¸»ä½“)</li><li>206  Partial Content<br>æœåŠ¡ç«¯æˆåŠŸå¤„ç†äº†å®¢æˆ·ç«¯å‘å‡ºçš„èŒƒå›´è¯·æ±‚</li></ol></li><li>3XX é‡å®šå‘<ol><li>301 Moved Permanently<br>æ°¸ä¹…æ€§é‡å®šå‘. è¯·æ±‚çš„èµ„æºå·²ç»è¢«åˆ†é…äº†æ–°çš„ URI åº”è¯¥ä½¿ç”¨æ–°çš„ URI</li><li>302 Found<br>ä¸´æ—¶æ€§é‡å®šå‘. è¯·æ±‚çš„èµ„æºè¢«åˆ†é…äº†æ–°çš„ URI, å¸Œæœ›æœ¬æ¬¡è¯·æ±‚ç”¨æ–°çš„ URI</li><li>303 See Other<br>è¯·æ±‚çš„èµ„æºå­˜åœ¨å¦ä¸€ä¸ª URI, åº”ä½¿ç”¨ GET æ–¹æ³•å®šå‘è·å–è¯·æ±‚çš„èµ„æº(è·Ÿ302çš„åŠŸèƒ½ç›¸åŒ)</li><li>304 Not Modified<br>è¡¨ç¤ºè¯·æ±‚æ—¶é™„å¸¦äº†æ¡ä»¶, æœåŠ¡ç«¯å…è®¸è¯·æ±‚èµ„æºä½†ä¸ºæ»¡è¶³æ¡ä»¶. æ‰€ä»¥è¿”å›æ—¶, ä¸åŒ…å«ä»»ä½•å“åº”çš„ä¸»ä½“éƒ¨åˆ†(è·Ÿé‡å®šå‘å¹¶æ²¡æœ‰åŠæ¯›é’±å…³ç³»).</li><li>307 Temporary Redirect<br>ä¸´æ—¶é‡å®šå‘, è·Ÿ302æœ‰ç€åŒæ ·çš„ä¸€æ ·. å°½ç®¡302æ ‡å‡†ä¸å…è®¸ POST å˜ä¸º GET, ä½†æ˜¯å¹¶æ²¡æœ‰äººéµå®ˆ; 307ä¼šéµå®ˆæ ‡å‡†ä½†æ˜¯å¤„ç†å“åº”æ—¶, æ¯ä¸ªæµè§ˆå™¨æœ‰å¯èƒ½å‡ºç°ä¸åŒçš„æƒ…å†µ</li></ol></li><li>4XX å®¢æˆ·ç«¯é”™è¯¯<ol><li>400 Bad Request<br>è¯·æ±‚æŠ¥æ–‡ä¸­æœ‰è¯­æ³•é”™è¯¯</li><li>401 Unauthorized<br>è¯·æ±‚éœ€è¦é€šè¿‡ HTTP è®¤è¯</li><li>403 Forbidden<br>è¯·æ±‚èµ„æºè®¿é—®è¢«æœåŠ¡ç«¯æ‹’ç»(ä¸€èˆ¬éƒ½æ˜¯æƒé™é—®é¢˜)</li><li>404 Not Found<br>æœåŠ¡ç«¯ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æº</li><li>405 Not Allow<br>å¯¹äºè¯·æ±‚çš„èµ„æº, æœåŠ¡ç«¯ä¸å…è®¸ä½¿ç”¨è¯·æ±‚ä¸­ä½¿ç”¨çš„æ–¹æ³•</li></ol></li><li>5XX æœåŠ¡å™¨é”™è¯¯<ol><li>500 Internal Server Error<br>æœåŠ¡ç«¯åœ¨æ‰§è¡Œè¯·æ±‚ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯</li><li>503 Service Unavailable<br>æœåŠ¡ç«¯æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–è€…åœæœºç»´æŠ¤, æ— æ³•å¤„ç†è¯·æ±‚(ä¸€èˆ¬å°±æ˜¯æœåŠ¡å™¨æŒ‚äº†)</li></ol></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸»è¦ä¸ºäº†å¤§è‡´äº†è§£ä¸€ä¸‹ HTTP çš„åŸºç¡€/å¤§æ¦‚çš„æ‰§è¡Œæµç¨‹å’Œå¸¸è§çš„HTTP çŠ¶æ€ç . å¯¹äºçŠ¶æ€ç ä¹‹å‰ä¸€ç›´åˆ†ä¸å¤ªæ¸…301å’Œ302çš„åŒºåˆ«, ç®€å•çš„æ¥è¯´: 301 æ”¹å˜èµ„æºçš„URI å, å¦‚æœè¿™ä¸ªèµ„æºæ˜¯è¢«ä¿å­˜åœ¨ä¹¦ç­¾ä¸­çš„, é‚£ä¹ˆè¿™æ—¶è¦æ ¹æ®æ–°çš„ URI ä¿å­˜; 302 è¡¨ç¤ºè¿™ä¸ªèµ„æºåªæ˜¯ä¸´æ—¶æ€§çš„ç§»åŠ¨, ä¹‹åè¿™ä¸ª URI å¯èƒ½è¿˜ä¼šå˜åŒ–. é‚£ä¹ˆå¦‚æœä¹Ÿè¢«ä¿å­˜åœ¨äº†ä¹¦ç­¾ä¸­, ä»ç„¶ä¼šä¿ç•™åŸæ¥çš„ URI. çŠ¶æ€ç ä¸­çš„ 304 æ”¾åœ¨ä¸‹æ¬¡æ”¾åœ¨ç¼“å­˜ç­–ç•¥ä¸­å†æ‹ä¸€æ‹å§.</p><p>Create on 2018-1-3 By Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Webä½¿ç”¨HTTP(HyperText Transfer Protocal) è¶…æ–‡æœ¬ä¼ è¾“åè®®ä½œä¸ºè§„èŒƒ, å®Œæˆä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ä¸€ç³»åˆ—æµç¨‹. å¯ä»¥è¯´ Web æ˜¯åœ¨ HTTP åè®®ä¸Šé€šä¿¡çš„.&lt;/p&gt;
&lt;h3 id=&quot;1-0-ç½‘ç»œåŸºç¡€TCP-IP&quot;&gt;&lt;a href=&quot;#1-0-ç½‘
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="HTTP" scheme="https://yoursite.com/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>å£°æ˜æå‡</title>
    <link href="https://yoursite.com/2017/12/20/%E5%A3%B0%E6%98%8E%E6%8F%90%E5%8D%87/"/>
    <id>https://yoursite.com/2017/12/20/å£°æ˜æå‡/</id>
    <published>2017-12-20T13:54:07.000Z</published>
    <updated>2018-05-13T03:49:29.859Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨è¯´å£°æ˜æå‡ä¹‹å‰, é¦–å…ˆåº”è¯¥äº†è§£ä¸‰ä¸ªæ¦‚å¿µæ€§çš„ä¸œè¥¿, æ‰§è¡Œä¸Šä¸‹æ–‡(Execution Context)/ å˜é‡å¯¹è±¡(Variable Object)å’Œæ´»åŠ¨å¯¹è±¡(Activation Object), è¿™ä¸‰ä¸ªæ¦‚å¿µæ˜¯åœ¨ ES3 ä¸­å‡ºç°çš„.</p><ul><li><p>æ‰§è¡Œä¸Šä¸‹æ–‡(Execution Context)<br>æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿå¯ä»¥è¯´æ˜¯ js ä»£ç çš„è¿è¡Œç¯å¢ƒ, ä»£ç ä¸€æ—¦è¢«åŠ è½½ js çš„è§£é‡Šå™¨é¦–å…ˆè¿›å…¥çš„å°±æ˜¯è¿™ä¸ªç¯å¢ƒ. ä»–æœ‰å…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡(eval ä¸è¯´, å®ƒå†…éƒ¨ä¹Ÿæœ‰), js çš„è§£é‡Šå™¨é»˜è®¤å…ˆè¿›å…¥çš„æ˜¯å…¨å±€ä¸Šä¸‹æ–‡æ‰€ä»¥æˆ‘ä»¬ä¸€å¼€å§‹å°±èƒ½ç›´æ¥ä½¿ç”¨ä¸€äº›çš„å†…ç½®æ–¹æ³•, æ¯”å¦‚: Array/ Numberâ€¦ æ¯å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶, å°±ä¼šåˆ›å»ºä»–è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡, æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„å˜é‡å¯¹è±¡.</p></li><li><p>ä½œç”¨åŸŸé“¾(ä¹Ÿç§°è°ƒç”¨æ ˆ)<br>çŸ¥é“äº†æ¯å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¶ä¼šåˆ›å»ºè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡, è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡å°±ä¼šè¢«æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾çš„é¡¶ç«¯. è€Œè§£é‡Šå™¨æ€»æ˜¯å…ˆè¿è¡Œä½œç”¨åŸŸé“¾é¡¶ç«¯çš„æ‰§è¡Œä¸Šä¸‹æ–‡, ä¸€æ—¦å‡½æ•°è°ƒç”¨å®Œæ¯•, å®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡å°±ä¼šä»ä½œç”¨åŸŸé“¾çš„é¡¶ç«¯ç§»é™¤å¹¶å°†æ§åˆ¶æƒäº¤ç”±ä¸Šä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡, ç›´åˆ°å›åˆ°å…¨å±€ä¸Šä¸‹æ–‡. å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="/img/event-loop.gif" alt="æ‰§è¡Œç¯å¢ƒ"></p></li></ul><ul><li>å˜é‡å¯¹è±¡(Variable Object)<br>å½“æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºå, è¿›å…¥å»ºç«‹é˜¶æ®µ(å‡½æ•°è°ƒç”¨, å…·ä½“ä»£ç æ‰§è¡Œä¹‹å‰), åœ¨è¿™ä¸ªé˜¶æ®µå˜é‡å¯¹è±¡/ ä½œç”¨åŸŸé“¾/ <code>this</code>çš„æŒ‡å‘éƒ½ä¼šè¢«ç¡®å®š. å˜é‡å¯¹åƒä¼šæŒ‰é¡ºåºå¡«å……:</li></ul><ol><li>å‡½æ•°å‚æ•°(æ²¡æœ‰å°±æ˜¯ undefined)</li><li>å‡½æ•°å£°æ˜(å‘½åå†²çª, ä¼šè¦†ç›–ä¹‹å‰çš„)</li><li>å˜é‡å£°æ˜(å€¼ä¸º undefined, å‘½åå†²çª, ä¼šè¢«å¿½ç•¥)</li></ol><ul><li>æ´»åŠ¨å¯¹è±¡(ä¹Ÿç§°æ¿€æ´»å¯¹è±¡)<br>å‡½æ•°è°ƒç”¨æ´»åŠ¨å¯¹è±¡å°±ä½œä¸ºå˜é‡å¯¹è±¡, æ‰€ä»¥åœ¨å‡½æ•°è°ƒç”¨æ—¶<code>å˜é‡å¯¹è±¡ === æ´»åŠ¨å¯¹è±¡</code>, æ´»åŠ¨å¯¹è±¡ä¼šå…ˆåŒ…å«<code>arguments</code>å¯¹è±¡åŠæ–¹æ³•.</li></ul><p>è¿˜æ˜¯çœ‹ä¸ªä»£ç æ¥è¯´å§:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">11</span>)</span><br><span class="line"><span class="comment">// å»ºç«‹é˜¶æ®µ</span></span><br><span class="line">fooExecutionContext = &#123;</span><br><span class="line">variableObject: &#123;</span><br><span class="line"><span class="built_in">arguments</span>: &#123;</span><br><span class="line"><span class="number">0</span>: <span class="number">11</span>,</span><br><span class="line">length: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line">i: <span class="number">11</span>, <span class="comment">// åªæœ‰å‚æ•°è¢«èµ‹å€¼</span></span><br><span class="line">c: pointer to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"><span class="title">a</span>: <span class="title">undefined</span>,</span></span><br><span class="line"><span class="function"><span class="title">b</span>: <span class="title">undefined</span>,</span></span><br><span class="line"><span class="function">&#125;,</span></span><br><span class="line"><span class="function"><span class="title">scopeChain</span>: </span>&#123;...&#125;,</span><br><span class="line"><span class="keyword">this</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œé˜¶æ®µ</span></span><br><span class="line">fooExecutionContext = &#123;</span><br><span class="line">variableObject: &#123;</span><br><span class="line"><span class="built_in">arguments</span>: &#123;</span><br><span class="line"><span class="number">0</span>: <span class="number">11</span>,</span><br><span class="line">length: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line">i: <span class="number">11</span>,</span><br><span class="line">c: pointer to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>),</span></span><br><span class="line"><span class="function"><span class="title">a</span>: '<span class="title">hello</span>', // å˜é‡åœ¨è¿™ä¸ªæ—¶å€™æ‰è¢«èµ‹å€¼</span></span><br><span class="line"><span class="function"><span class="title">b</span>: <span class="title">pointer</span> <span class="title">to</span> <span class="title">function</span> <span class="title">bar</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">&#125;,</span></span><br><span class="line"><span class="function"><span class="title">scopeChain</span>: </span>&#123;...&#125;,</span><br><span class="line"><span class="keyword">this</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šä¸‰ä¸ªæ¦‚å¿µéƒ½æ— æ³•ç”¨è¿‡ä»£ç è®¿é—®, æ˜¯è§£é‡Šå™¨åœ¨åå°ä½¿ç”¨.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨è¯´å£°æ˜æå‡ä¹‹å‰, é¦–å…ˆåº”è¯¥äº†è§£ä¸‰ä¸ªæ¦‚å¿µæ€§çš„ä¸œè¥¿, æ‰§è¡Œä¸Šä¸‹æ–‡(Execution Context)/ å˜é‡å¯¹è±¡(Variable Object)å’Œæ´»åŠ¨å¯¹è±¡(Activation Object), è¿™ä¸‰ä¸ªæ¦‚å¿µæ˜¯åœ¨ ES3 ä¸­å‡ºç°çš„.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ‰§è¡Œä¸Šä¸‹
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>äº‹ä»¶</title>
    <link href="https://yoursite.com/2017/12/10/%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86-%E5%A7%94%E6%89%98/"/>
    <id>https://yoursite.com/2017/12/10/äº‹ä»¶ä»£ç†-å§”æ‰˜/</id>
    <published>2017-12-10T14:05:49.000Z</published>
    <updated>2018-05-13T03:49:29.858Z</updated>
    
    <content type="html"><![CDATA[<p>JavaScript å’Œ HTML äº¤äº’æ˜¯é€šè¿‡äº‹ä»¶å®ç°, è€Œäº‹ä»¶å¤„ç†ç¨‹åºè®¢é˜…äº‹ä»¶ä»è€Œæ‰§è¡Œç›¸åº”çš„æ“ä½œ.</p><h4 id="äº‹ä»¶æµ"><a href="#äº‹ä»¶æµ" class="headerlink" title="äº‹ä»¶æµ"></a>äº‹ä»¶æµ</h4><p>äº‹ä»¶æµæè¿°çš„æ˜¯ ä»é¡µé¢æ¥æ”¶äº‹ä»¶çš„é¡ºåº.<br>äº‹ä»¶å†’æ³¡: ä»æœ€å…·ä½“çš„å…ƒç´ åˆ°æœ€ä¸å…·ä½“çš„å…ƒç´ (ä»å†…åˆ°å¤–); â€” IE<br>äº‹ä»¶æ•è·: ä»æœ€ä¸å…·ä½“çš„å…ƒç´ åˆ°æœ€å…·ä½“çš„å…ƒç´ (ä»å¤–åˆ°å†…); â€” Netscape<br>DOM äº‹ä»¶æµ: å…ˆæ•è·åå†’æ³¡çš„æ–¹å¼.</p><p>DOMäº‹ä»¶æµåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µ:</p><ol><li>æ•è·é˜¶æ®µ (IE ä½ç‰ˆæœ¬ä¸æ”¯æŒè¯¥é˜¶æ®µ)</li><li>ç›®æ ‡é˜¶æ®µ (è§¦å‘äº‹ä»¶)</li><li>å†’æ³¡é˜¶æ®µ (å›ä¼ æ–‡æ¡£)</li></ol><h4 id="äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="äº‹ä»¶å¤„ç†ç¨‹åº"></a>äº‹ä»¶å¤„ç†ç¨‹åº</h4><p>äº‹ä»¶æ˜¯ç”¨æˆ·æˆ–æµè§ˆå™¨è‡ªèº«æ‰§è¡Œçš„åŠ¨ä½œ, äº‹ä»¶å¤„ç†ç¨‹åº(äº‹ä»¶ç›‘å¬å™¨)æ˜¯å“åº”äº‹ä»¶çš„åŠ¨ä½œ. æ¯”å¦‚ click äº‹ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åºå°±æ˜¯ onclick, ä¸ºäº‹ä»¶æŒ‡å®šå¤„ç†ç¨‹åºçš„æ–¹å¼ä¹Ÿæœ‰å‡ ç§.</p><h5 id="HTML-äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#HTML-äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="HTML äº‹ä»¶å¤„ç†ç¨‹åº"></a>HTML äº‹ä»¶å¤„ç†ç¨‹åº</h5><p>åœ¨æ ‡ç­¾ä¸Šç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº, HTML å’Œ js ç´§å¯†è€¦åˆ<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">'alert('</span><span class="attr">clicked</span>')'&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h5 id="DOM-0çº§äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#DOM-0çº§äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="DOM 0çº§äº‹ä»¶å¤„ç†ç¨‹åº"></a>DOM 0çº§äº‹ä»¶å¤„ç†ç¨‹åº</h5><p>å°†ä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå±æ€§<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>);</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'clicked'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="DOM-2çº§äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#DOM-2çº§äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="DOM 2çº§äº‹ä»¶å¤„ç†ç¨‹åº"></a>DOM 2çº§äº‹ä»¶å¤„ç†ç¨‹åº</h5><p>å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•, ç”¨äºç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åºå’Œåˆ é™¤äº‹ä»¶å¤„ç†ç¨‹åº: <code>addEventListener()</code>å’Œ<code>removeEventListener()</code>. æ‰€æœ‰çš„ DOM èŠ‚ç‚¹éƒ½åŒ…å«è¿™ä¸¤ä¸ªæ–¹æ³•, æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°: éœ€è¦å¤„ç†çš„äº‹ä»¶å/ å¤„ç†å‡½æ•°/ å¸ƒå°”å€¼(true ä¸ºåœ¨æ•è·é˜¶æ®µè°ƒç”¨; false ä¸ºåœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>);</span><br><span class="line"><span class="comment">// ç»‘å®šå¤„ç†ç¨‹åº</span></span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'clicked'</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// ç§»é™¤å¤„ç†ç¨‹åº(ç§»é™¤å¤„ç†ç¨‹åºæ—¶, ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»å’Œç»‘å®šæ—¶ä¸€æ ·)</span></span><br><span class="line">btn.removeEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'remove'</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p><h4 id="IE-å’Œ-DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«"><a href="#IE-å’Œ-DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«" class="headerlink" title="IE å’Œ  DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«"></a>IE å’Œ  DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«</h4><ul><li>IE äº‹ä»¶å¤„ç†ç¨‹åº<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = docuemnt.querySelector(<span class="string">'#btn'</span>);</span><br><span class="line"><span class="comment">// ç»‘å®šäº‹ä»¶</span></span><br><span class="line">btn.attachEvent(<span class="string">'onclick'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// this === window</span></span><br><span class="line">alert(<span class="string">'click on IE'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç§»é™¤äº‹ä»¶</span></span><br><span class="line">btn.detachEvent(<span class="string">'onclick'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'remove on IE'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä»¥ä¸Šä¸¤ç§äº‹ä»¶å¤„ç†ç¨‹åºéƒ½æ”¯æŒç»‘å®šå¤šä¸ªäº‹ä»¶, DOM2çº§æŒ‰ç…§é¡ºåº</strong></p><ul><li>è·¨æµè§ˆå™¨äº‹ä»¶å¤„ç†<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventUtil = &#123;</span><br><span class="line"><span class="comment">// ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº</span></span><br><span class="line">addHanlder: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (element.addEventListener) &#123;</span><br><span class="line">element.addEventListener(type, handler, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent) &#123;</span><br><span class="line">element.attachEvent(<span class="string">'on'</span> + type, handler)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">element[<span class="string">'on'</span> + type] = handler;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åº</span></span><br><span class="line">removeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (element.removeEventListener) &#123;</span><br><span class="line">element.removeEventListener(type, handler, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (element.detachEvent) &#123;</span><br><span class="line">element.detachEvent(<span class="string">'on'</span> + type, handler)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">element[<span class="string">'on'</span> + type] = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="äº‹ä»¶ä»£ç†-å§”æ‰˜"><a href="#äº‹ä»¶ä»£ç†-å§”æ‰˜" class="headerlink" title="äº‹ä»¶ä»£ç†/ å§”æ‰˜"></a>äº‹ä»¶ä»£ç†/ å§”æ‰˜</h4><p>ç”±äºäº‹ä»¶å¤„ç†ç¨‹åºè¶Šå¤š, æ€§èƒ½è¶Šå·®, æ‰€ä»¥æœ‰äº†äº‹ä»¶å¤„ç†ç¨‹åº. äº‹ä»¶ä»£ç†çš„åŸç†æ˜¯åŸºäºäº‹ä»¶çš„å†’æ³¡æœºåˆ¶å®ç°çš„, ç”±ä¸Šçº§èŠ‚ç‚¹ä»£ç†å®Œæˆäº‹ä»¶ç»‘å®š, ä¼˜ç‚¹æ˜¯: </p><blockquote><p>èŠ‚çœå†…å­˜å ç”¨, å‡å°‘äº‹ä»¶æ³¨å†Œ. æ¯”å¦‚åœ¨<code>ul</code>ä»£ç†æ‰€æœ‰<code>li</code>çš„ç‚¹å‡»äº‹ä»¶<br>åŠ¨æ€æ–°å¢å­çº§æ—¶, æ— éœ€å†æ¬¡ç»‘å®šäº‹ä»¶.</p></blockquote><p>å¯èƒ½ä¼šæåˆ°<code>currentTarget</code>å’Œ<code>target</code>çš„åŒºåˆ«: currentTarget æ˜¯æ³¨å†Œäº‹ä»¶æ—¶çš„ç›®æ ‡(åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­<code>this</code>å§‹ç»ˆæŒ‡å‘ currentTarget), target æ˜¯çœŸæ­£è§¦å‘äº‹ä»¶çš„ç›®æ ‡.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.onclick = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line"><span class="comment">// äº‹ä»¶æ³¨å†Œæ—¶çš„å…ƒç´ </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.body === event.currentTarget); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">document</span>.body); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// çœŸæ­£ç‚¹å‡»çš„å…ƒç´ </span></span><br><span class="line"><span class="built_in">console</span>.log(event.target === <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>)); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº‹ä»¶å¯¹è±¡"><a href="#äº‹ä»¶å¯¹è±¡" class="headerlink" title="äº‹ä»¶å¯¹è±¡"></a>äº‹ä»¶å¯¹è±¡</h4><p>äº‹ä»¶å†…ç½®çš„ event å¯¹è±¡, ä¸‹é¢åˆ—ä¸¾å¸¸ç”¨çš„å‡ ä¸ªäº‹ä»¶å¯¹è±¡å±æ€§:</p><ul><li>event || window.event</li><li>event.preventDefault() || window.event.cancelBubble(Boolean)<br>é˜»æ­¢æµè§ˆå™¨é»˜è®¤äº‹ä»¶</li><li>event.stopPropagation() || window.event.returnValue(Boolean)<br>é˜»æ­¢å†’æ³¡äº‹ä»¶</li><li>event.target || winow.event.srcElement</li></ul><p>Created on 2017-12-10 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;JavaScript å’Œ HTML äº¤äº’æ˜¯é€šè¿‡äº‹ä»¶å®ç°, è€Œäº‹ä»¶å¤„ç†ç¨‹åºè®¢é˜…äº‹ä»¶ä»è€Œæ‰§è¡Œç›¸åº”çš„æ“ä½œ.&lt;/p&gt;
&lt;h4 id=&quot;äº‹ä»¶æµ&quot;&gt;&lt;a href=&quot;#äº‹ä»¶æµ&quot; class=&quot;headerlink&quot; title=&quot;äº‹ä»¶æµ&quot;&gt;&lt;/a&gt;äº‹ä»¶æµ&lt;/h4&gt;&lt;p&gt;äº‹ä»¶æµæè¿°çš„æ˜¯ 
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Flex å¼¹æ€§ç›’å­</title>
    <link href="https://yoursite.com/2017/11/23/Flex-%E5%BC%B9%E6%80%A7%E7%9B%92%E5%AD%90/"/>
    <id>https://yoursite.com/2017/11/23/Flex-å¼¹æ€§ç›’å­/</id>
    <published>2017-11-23T11:15:28.000Z</published>
    <updated>2018-05-13T03:49:29.854Z</updated>
    
    <content type="html"><![CDATA[<p>Flex æ˜¯ Flexible box çš„ç¼©å†™(å¼¹æ€§å¸ƒå±€), ç”¨æ¥ä¸ºç›’æ¨¡å‹æä¾›æœ€å¤§çµæ´»æ€§çš„å¸ƒå±€, æ›´ä¸ºæ–¹ä¾¿çš„å®ç°å“åº”å¼å¸ƒå±€.</p><blockquote><p>å¦‚ä½•ä½¿ç”¨ Flex<br>ä»»ä½•ä¸€ä¸ªå®¹å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ª Flex å¸ƒå±€.  </p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* è¡Œå†…å…ƒç´  */</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: inline-flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å†…æ ¸ä¸º webkit çš„æµè§ˆå™¨ */</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line"><span class="comment">/* Safari */</span></span><br><span class="line"><span class="attribute">display</span>: -webkit-flex;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾å®š Flexå¸ƒå±€ä¹‹åçš„å­å…ƒç´ <code>float</code>/ <code>clear</code>/ <code>vertical-align</code>éƒ½å°†å¤±æ•ˆ.</p><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><p>æ‰€æœ‰é‡‡ç”¨ Flex å¸ƒå±€çš„çš„å…ƒç´ éƒ½ç§°ä¸º Flex å®¹å™¨, å®ƒçš„æ‰€æœ‰èµ„æºéƒ½ä¸º Flex å®¹å™¨çš„å®¹å™¨æˆå‘˜, æˆä¸º Flex é¡¹ç›®.<br>Flex å®¹å™¨éƒ½å­˜åœ¨ä¸¤æ ¹è½´: æ°´å¹³çš„ä¸»è½´(main axis)å’Œå‚ç›´çš„äº¤å‰è½´(cross axis), é¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—. æ¯ä¸ªé¡¹ç›®å ä¸»è½´çš„ç©ºé—´ç§°ä¸º<code>main size</code>, å äº¤å‰è½´çš„ç©ºé—´ç§°ä¸º<code>cross size</code>.</p><h4 id="Flex-å®¹å™¨çš„å±æ€§"><a href="#Flex-å®¹å™¨çš„å±æ€§" class="headerlink" title="Flex å®¹å™¨çš„å±æ€§"></a>Flex å®¹å™¨çš„å±æ€§</h4><ul><li><p>flex-direction<br>é¡¹ç›®æ’åˆ—åœ¨ä¸»è½´çš„æ–¹å‘ </p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">flex-direction</span>: row | row-reverse | column | column-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>row: é»˜è®¤å€¼, ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘, èµ·ç‚¹ä¸ºå·¦è¾¹</li><li>row-reverse: ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘, èµ·ç‚¹ä¸ºå³è¾¹</li><li>column: ä¸»è½´ä¸ºäº¤å‰è½´æ–¹å‘, èµ·ç‚¹åœ¨é¡¶éƒ¨</li><li>column-reverse: ä¸»è½´ä¸ºäº¤å‰è½´æ–¹å‘, èµ·ç‚¹åœ¨åº•éƒ¨</li></ul></li><li><p>flex-wrap<br>é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„æ¢è¡Œæ–¹å¼</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">flex-wrap</span>: nowrap | wrap | wrap-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>nowrap: é»˜è®¤å€¼, ä¸æ¢è¡Œ</li><li>wrap: æ¢è¡Œ, ç¬¬ä¸€è¡Œåœ¨ä¸Šé¢</li><li>wrap-reverse: æ¢è¡Œ, ç¬¬ä¸€è¡Œåœ¨ä¸‹é¢</li></ul></li><li><p>flex-flow<br>è¯¥å±æ€§ä¸º<code>flex-direction</code>å’Œ<code>flex-wrap</code>çš„ç¼©å†™, é»˜è®¤å€¼ä¸º<code>row nowrap</code></p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">flex-flow</span>: flex-direction || flex-wrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>justify-content<br>é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼, æ‰€ä»¥å®ƒçš„å¯¹é½æ–¹å¼è·Ÿè½´çš„æ–¹å‘æœ‰å…³</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">justify-content</span>: flex-start | center | space-around | space-between | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>flex-start: é»˜è®¤å€¼, å·¦å¯¹é½</li><li>center: å±…ä¸­</li><li>space-around: å·¦å³å±…ä¸­å¯¹é½, é¡¹ç›®ä¹‹é—´é—´éš”ä¸ºé¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€</li><li>space-between: ä¸¤ç«¯å¯¹é½</li><li>flex-end: å³å¯¹é½ </li></ul></li><li><p>align-items<br>é¡¹ç›®åœ¨äº¤å‰è½´åœ¨çš„å¯¹é½æ–¹å¼, ä¸äº¤å‰è½´æ–¹å‘æœ‰å…³</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">align-items</span>: flex-start | center | baseline | stretch | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>flex-start: äº¤å‰è½´èµ·ç‚¹å¯¹é½</li><li>center: å±…ä¸­</li><li>baseline: é¡¹ç›®ç¬¬ä¸€è¡Œæ–‡å­—åŸºçº¿å¯¹é½, ç±»ä¼¼åœ¨æ–‡å­—çš„ä¸‹åˆ’çº¿ä½ç½®</li><li>stretch: é»˜è®¤å€¼, é¡¹ç›®æ²¡æœ‰é«˜åº¦æˆ–ä¸º<code>auto</code>æ—¶, å æ»¡æ•´ä¸ªå®¹å™¨</li><li>flex-end: ç»ˆç‚¹å¯¹é½</li></ul></li><li><p>align-content<br>å¤šæ ¹è½´çº¿å¯¹é½æ–¹å¼. å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿, è¯¥å±æ€§åˆ™ä¸èµ·ä½œç”¨. è·Ÿ<code>align-items</code>å®¹æ˜“æ··æ·†, åŒºåˆ«åœ¨äº <code>align-content</code>é¡¹ç›®æœ‰å¤šè¡Œæ—¶èµ·ä½œç”¨, è€Œ<code>align-items</code>é¡¹ç›®å•è¡Œå°±å¯èµ·ä½œç”¨.</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">align-content</span>: flex-start | center | space-around | space-between | stretch | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>flex-start: äº¤å‰è½´å¯¹é½æ–¹å¼</li><li>center: å±…ä¸­</li><li>space-around: å·¦å³å±…ä¸­å¯¹é½</li><li>space-between: ä¸¤ç«¯å¯¹é½</li><li>stretch: é»˜è®¤å€¼, é¡¹ç›®è½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´</li></ul></li></ul><h4 id="Flex-é¡¹ç›®å±æ€§"><a href="#Flex-é¡¹ç›®å±æ€§" class="headerlink" title="Flex é¡¹ç›®å±æ€§"></a>Flex é¡¹ç›®å±æ€§</h4><ul><li><p>order<br>å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåº, æ•°å€¼è¶Šå°è¶Šé å‰, é»˜è®¤ä¸º0</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">order</span>: &lt;number&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex-grow<br>å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹, é»˜è®¤ä¸º0(æœ‰å‰©ä½™ç©ºé—´ä¹Ÿä¸æ”¾å¤§). å¦‚æœæ‰€æœ‰é¡¹ç›®éƒ½ä¸º1, å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´; å¦‚æœå…¶ä¸­ä¸€ä¸ªé¡¹ç›®ä¸º2, å…¶å®ƒé¡¹ç›®ä¸º1, é‚£ä¹ˆå±æ€§ä¸º2çš„é¡¹ç›®å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å±æ€§ä¸º1çš„é¡¹ç›®å¤§ä¸€å€</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">flex-grow</span>: &lt;number&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex-shrink<br>å®šä¹‰é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹, é»˜è®¤ä¸º1(å¦‚æœç©ºé—´ä¸è¶³, å°†ç¼©å°). å¦‚æœæ‰€æœ‰é¡¹ç›®éƒ½ä¸º1, å½“ç©ºé—´ä¸è¶³æ—¶, æ‰€æœ‰é¡¹ç›®éƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°; å¦‚æœå…¶ä¸­ä¸€ä¸ªé¡¹ç›®ä¸º0, å…¶å®ƒé¡¹ç›®ä¸º1, é‚£ä¹ˆå½“ç©ºé—´ä¸è¶³æ—¶, å‰è€…å°†ä¸ç¼©å°</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">flex-shrink</span>: &lt;number&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex-basis<br>å®šä¹‰å±æ€§åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰é¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´(main size). æµè§ˆå™¨ä¼šæ ¹æ®è¿™ä¸ªå±æ€§è®¡ç®—æ˜¯å¦æœ‰å¤šäºç©ºé—´. é»˜è®¤å€¼ä¸º auto(é¡¹ç›®æœ¬èº«çš„å¤§å°). å¦‚æœä¸ä½¿ç”¨<code>box-sizing</code>æ¥æ”¹å˜ç›’æ¨¡å‹çš„è¯, è¯¥å±æ€§å°†å†³å®šé¡¹ç›®çš„å†…å®¹ç›’(content-box)çš„å®½æˆ–è€…é«˜(å®½æˆ–é«˜å–å†³äºä¸»è½´çš„æ–¹å‘).</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="comment">/* size çš„å•ä½å¯ä»¥ä¸º px/ em/rem ç™¾åˆ†æ¯”éƒ½è¡Œ(è´Ÿå€¼æ— æ•ˆ) */</span></span><br><span class="line"><span class="attribute">flex-basis</span>: &lt;size&gt; | &lt;content&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>size: è·Ÿå®½é«˜è®¾ç½®ä¸€æ ·, ä¸å¤šè¯´.</li><li>content: css3 çš„å‡ ä¸ª width æ–°å±æ€§. fill-available/ max-content/ min-content/ fit-content, å…¼å®¹æ€§ IE ä¸æ”¯æŒ.</li></ul></li><li><p>flex<br>è¯¥å±æ€§ä¸º<code>flex-grow</code>/<code>flex-shrink</code>å’Œ<code>flex-basis</code>çš„ç¼©å†™, é»˜è®¤å€¼ä¸º <code>0 1 auto</code>, åä¸¤ä¸ªå±æ€§å¯é€‰</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">flex</span>: none | flex-grow flex-shrink flex-basis</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>align-self<br>å…è®¸å•ä¸ªé¡¹ç›®ä¸å…¶ä»–é¡¹ç›®æœ‰ä¸åŒçš„å¯¹é½æ–¹å¼, å¯è¦†ç›–<code>align-items</code>å±æ€§, é»˜è®¤å€¼ä¸º auto, ç»§æ‰¿çˆ¶çº§å…ƒç´ çš„<code>align-items</code>å±æ€§, æ²¡æœ‰çš„è¯ç­‰åŒäº<code>stretch</code></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">align-self: auto | flex-start | center | stretch | baseline | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>é™¤äº† <code>auto</code>ä»¥å¤–å…¶ä»–å±æ€§å€¼è·Ÿ<code>align-items</code>ä¸€æ ·å°±ä¸å†é‡å¤äº†.</p><blockquote><p>è¯´ä¸€ä¸‹ CSS3 width çš„å‡ ä¸ªæ–°å±æ€§<br>éœ€è¦å¸¦æœ‰ç§æœ‰å‰ç¼€  </p></blockquote><ul><li>fill-available<br>è®©å…ƒç´ è‡ªåŠ¨100%å¾—å¡«å……çˆ¶çº§å®½åº¦, è®©å…ƒç´ è¡¨ç°å¾—åƒå—çº§å…ƒç´ ä¸€æ ·, <code>inline-block</code>çš„å…ƒç´ ä¹Ÿå¯ä»¥è‡ªåŠ¨å¡«å……, é¡ºä¾¿å†çˆ¶çº§åŠ ä¸€ä¸ª<code>line-height</code>è®©å…ƒç´ å‚ç›´å±…ä¸­.</li><li>max-content<br>å®ƒçš„è¡¨ç°å°±åƒè®¾ç½®äº†<code>white-space:nowrap</code>ä¸€æ ·, å…ƒç´ çš„å®½åº¦å–å­å…ƒç´ ä¸­è¾ƒå¤§å®½åº¦çš„å®½åº¦</li><li>min-content<br>å®ƒè¡¨ç¤ºçš„ä¸æ˜¯å­å…ƒç´ ä¸­å®½åº¦å°çš„é‚£ä¸ªå®½åº¦, è€Œæ˜¯å†…éƒ¨å…ƒç´ æœ€å°å®½åº¦å€¼æœ€å¤§çš„é‚£ä¸ªå…ƒç´ ä½œä¸ºæœ€ç»ˆå®½åº¦. æ¯”å¦‚: ä¸€ä¸ª<code>div</code>ä¸­, æœ‰ä¸€å¼ <code>img</code>çš„å®½åº¦ä¸º200px, æœ‰ä¸€ä¸ª<code>p</code>é‡Œé¢çš„æ–‡å­—å¯å¤šå¯å°‘é‡Œé¢æœ‰è‹±æ–‡(å¦‚æœæ–‡æœ¬å…¨æ˜¯ä¸­æ–‡, æœ€å°å®½åº¦å€¼å°±æ˜¯ä¸€ä¸ªä¸­æ–‡çš„å®½åº¦, å¦‚æœå¤¹æ‚è‹±æ–‡, ç”±äºè‹±æ–‡é»˜è®¤ä¸æ¢è¡Œ, æ‰€ä»¥æœ€å°å®½åº¦å€¼æ˜¯æœ€é•¿å•è¯çš„å®½åº¦), æ‰€ä»¥å‡è®¾è¿™é‡Œè‹±æ–‡çš„æœ€é•¿å•è¯ä¸è¶³200px, é‚£ä¹ˆæœ€ç»ˆçš„å…ƒç´ å®½åº¦å°±ä¸º200px</li><li>fit-content<br>è®¾ç½®è¯¥å±æ€§å, ä¸éœ€è¦å›ºå®šå®½åº¦, åœ¨çˆ¶çº§å…ƒç´ <code>margin: 0 auto</code>å°±å¯ä»¥å®ç°æ°´å¹³å±…ä¸­äº†</li></ul><p>Created on 2017-11-23 By Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Flex æ˜¯ Flexible box çš„ç¼©å†™(å¼¹æ€§å¸ƒå±€), ç”¨æ¥ä¸ºç›’æ¨¡å‹æä¾›æœ€å¤§çµæ´»æ€§çš„å¸ƒå±€, æ›´ä¸ºæ–¹ä¾¿çš„å®ç°å“åº”å¼å¸ƒå±€.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚ä½•ä½¿ç”¨ Flex&lt;br&gt;ä»»ä½•ä¸€ä¸ªå®¹å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ª Flex å¸ƒå±€.  &lt;/p&gt;
&lt;/blockquot
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="CSS" scheme="https://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>é—­åŒ…å’Œé«˜é˜¶å‡½æ•°</title>
    <link href="https://yoursite.com/2017/10/26/%E9%97%AD%E5%8C%85%E5%92%8C%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
    <id>https://yoursite.com/2017/10/26/é—­åŒ…å’Œé«˜é˜¶å‡½æ•°/</id>
    <published>2017-10-26T15:09:00.000Z</published>
    <updated>2018-05-13T03:49:29.860Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸€ç¯‡ç¬”è®°æ˜¯ä¸ºæ­£å¼å¼€å§‹å­¦ä¹  javadcript è®¾è®¡æ¨¡å¼åšé“ºå«ï¼Œç”±äºè®¸å¤šè®¾è®¡æ¨¡å¼éƒ½ç”¨åˆ°äº†é—­åŒ…å’Œé«˜é˜¶å‡½æ•°æ¥å®ç°, æ‰€ä»¥äº†è§£è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯å¿…è¦çš„.</p><blockquote><h3 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h3><p>é—­åŒ…ç®€å•çš„æ¥è¯´æ˜¯å‡½æ•°ä¸å‡½æ•°ä¹‹é—´çš„æ¡¥æ¢, è®©ä¸€ä¸ªå‡½æ•°æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œçš„å˜é‡. å®šä¹‰è¯´èµ·æ¥è¿˜æ˜¯å¾ˆç”Ÿæ¶©çš„, è¦ç†è§£é—­åŒ…æˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“å˜é‡çš„ä½œç”¨åŸŸä»¥åŠå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ‰è¡Œ.</p></blockquote><ul><li>å˜é‡çš„ä½œç”¨åŸŸ<br>å˜é‡çš„ä½œç”¨åŸŸæŒ‡çš„æ˜¯å˜é‡çš„æœ‰æ•ˆèŒƒå›´. åœ¨å‡½æ•°ä¸­ç”Ÿå‘½å˜é‡æ—¶, å¦‚æœæ²¡æœ‰å…³é”®å­— varã€letåŠconsté‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¼šå˜æˆå…¨å±€å˜é‡; å¦‚æœæœ‰è¿™ä¸ªæ—¶å€™çš„å˜é‡å°±æ˜¯å±€éƒ¨å˜é‡, åªæœ‰åœ¨å‡½æ•°å†…éƒ¨æ‰èƒ½å¤Ÿè®¿é—®åˆ°.<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">alert(a)</span><br><span class="line">&#125;</span><br><span class="line">fun()</span><br><span class="line">alert(a) <span class="comment">// a is not defined</span></span><br></pre></td></tr></table></figure></li></ul><p>å‡½æ•°è¿™ä¸ªæ—¶å€™å°±åƒä¸€å—å•é¢é•œ, é‡Œé¢å¯ä»¥çœ‹è§å¤–é¢, å¤–é¢ä¸èƒ½çœ‹åˆ°é‡Œé¢. å› ä¸ºå‡½æ•°åœ¨æœç´¢ä¸€ä¸ªå˜é‡çš„æ—¶å€™, å¦‚æœå‡½æ•°å†…æ²¡æœ‰è¿™ä¸ªå˜é‡, é‚£ä¹ˆè¿™ä¸ªæœç´¢è¿‡ç¨‹ä¼šéšç€ä»£ç çš„æ‰§è¡Œç¯å¢ƒåˆ›å»ºçš„ä½œç”¨åŸŸé“¾å‘å¤–æœç´¢ç›´è‡³å…¨å±€å¯¹è±¡.</p><ul><li>å˜é‡ç”Ÿå‘½å‘¨æœŸ<br>å¯¹äºå…¨å±€å˜é‡æ¥è¯´, å®ƒçš„ç”Ÿå‘½å‘¨æœŸè‡ªç„¶æ˜¯æ°¸ä¹…çš„é™¤éæˆ‘ä»¬æ‰‹åŠ¨é”€æ¯è¿™ä¸ªå˜é‡; å¯¹äºå±€éƒ¨å˜é‡, ä¸€èˆ¬æ¥è¯´å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åè¯¥å˜é‡å°±ä¼šè·Ÿç€è¢«é”€æ¯. è€Œé—­åŒ…åˆ™å¯ä»¥å»¶ç»­å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ, ä¸¾ä¸ªæ —å­:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">a++;</span><br><span class="line">alert(a);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fn = func();</span><br><span class="line">fn(); <span class="comment">// 1</span></span><br><span class="line">fn(); <span class="comment">// 2</span></span><br><span class="line">fn(); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° a å˜é‡ä¸ä»…åœ¨å¤–éƒ¨å¯ä»¥è¢«è®¿é—®åˆ°è€Œä¸”è¿˜ä¸€ç›´åœ¨é€’å¢, è¿™æ˜¯å› ä¸º <code>fn = func()</code>æ‰§è¡Œæ—¶, fn ä¿å­˜äº† func è¿”å›çš„åŒ¿åå‡½æ•°, è€Œè¿™ä¸ªåŒ¿åå‡½æ•°æ˜¯æœ‰æƒ func() è¢«è°ƒç”¨æ—¶äº§ç”Ÿçš„ç¯å¢ƒ. a å˜é‡å°±åœ¨è¿™ä¸ªç¯å¢ƒä¸­, æ‰€ä»¥æ—¢ç„¶å±€éƒ¨å˜é‡æ‰€åœ¨æ¢çš„ç¯å¢ƒæ²¡æœ‰è¢«é”€æ¯é‚£ä¹ˆ a å˜é‡ä¹Ÿä¸ä¼šè¢«é”€æ¯æ‰, è¿™ä¸ªä¾‹å­å°±äº§ç”Ÿäº†ä¸€ä¸ªé—­åŒ…ç»“æ„.</p><blockquote><h4 id="é—­åŒ…çš„ä½œç”¨"><a href="#é—­åŒ…çš„ä½œç”¨" class="headerlink" title="é—­åŒ…çš„ä½œç”¨"></a>é—­åŒ…çš„ä½œç”¨</h4></blockquote><ul><li>å°è£…å˜é‡<br>ä¼—æ‰€å‘¨çŸ¥å…¨å±€å˜é‡æ˜¯éå¸¸å®¹æ˜“å¼•èµ·å‘½åå†²çªçš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é—­åŒ…æŠŠä¸€äº›ä¸éœ€è¦æš´éœ²åœ¨å…¨å±€çš„å˜é‡å°è£…æˆç§æœ‰å˜é‡.</li></ul><p>å‡è®¾æœ‰ä¸€ä¸ªè®¡ç®—ä¹˜ç§¯çš„å‡½æ•°:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mult = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">// ç¼“å­˜(å°è£…èµ·æ¥)</span></span><br><span class="line"><span class="keyword">let</span> cache = &#123;&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> arg = [].join.call(<span class="built_in">arguments</span>, <span class="string">','</span>)</span><br><span class="line"><span class="comment">// å°è£…è®¡ç®—æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> calulate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class="line">a = a * <span class="built_in">arguments</span>[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­˜åœ¨ç¼“å­˜åˆ™ä¸è®¡ç®—</span></span><br><span class="line"><span class="keyword">if</span> (arg <span class="keyword">in</span> cache) <span class="keyword">return</span> cache[arg]</span><br><span class="line"><span class="keyword">return</span> cache[arg] = calulate.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mult(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure></p><p>å°†å˜é‡ cache å°è£…åœ¨ mult å‡½æ•°ä¸­æ¥ç¼“å­˜å·²ç»è®¡ç®—è¿‡çš„å‚æ•°, ä»¥å‡å°‘é‡å¤è®¡ç®—. è¿™ä¸ªç¼“å­˜æœºåˆ¶æœ¬æ¥æ˜¯å¯ä»¥æ‰”åœ¨å…¨å±€ç¯å¢ƒä¸­çš„.</p><ul><li>å»¶ç»­å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸ<br>å¹³å¸¸åšåŸ‹ç‚¹ä¼šç”¨åˆ°çš„ image å¯¹è±¡æ¥ä¸ŠæŠ¥æ•°æ®, å¦‚ä¸‹:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> report = <span class="function"><span class="keyword">function</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = src</span><br><span class="line">&#125;</span><br><span class="line">report(<span class="string">'http://xxxxx.com/xxx'</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•ä¼šé€ æˆæ•°æ®ä¸¢å¤±, å› ä¸ºåœ¨ HTTP è¿˜æœªç»“æŸæ—¶, report å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•è€Œ img ä¸º report å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡, åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åå°±ä¼šéšä¹‹é”€æ¯é€ æˆæ•°æ®ä¸¢å¤±çš„æƒ…å†µ. ä¸‹é¢ç”¨é—­åŒ…æŠŠå˜é‡å°è£…èµ·æ¥, æ¥è§£å†³è¿™ä¸€é—®é¢˜:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> report = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> imgs = []</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">imgs.push(img);</span><br><span class="line">img.src = src</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">report(<span class="string">'http://xxxxx.com/xxx'</span>)</span><br></pre></td></tr></table></figure></p><blockquote><h4 id="é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼"><a href="#é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼" class="headerlink" title="é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼"></a>é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼</h4><p>è¯´äº†è¿™ä¹ˆå¤šå°±æ¥çœ‹çœ‹å…³äºé—­åŒ…çš„è¿ç”¨å§, è¿™é‡Œç”¨é—­åŒ…ç®€å•å®ç°ä¸‹å‘½ä»¤æ¨¡å¼, é¡ºä¾¿é¢„å…ˆäº†è§£ä¸€ä¸‹å‘½ä»¤æ¨¡å¼.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">'open'</span> <span class="attr">onclick</span>=<span class="string">'execute'</span>&gt;</span>æ‰§è¡Œå‘½ä»¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">'close'</span> <span class="attr">onclick</span>=<span class="string">'undo'</span>&gt;</span>æ’¤é”€å‘½ä»¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é¢å‘å¯¹è±¡ç‰ˆ<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TV = &#123;</span><br><span class="line">open () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is open!'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">close () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is close!'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¥æ”¶å‘½ä»¤</span></span><br><span class="line"><span class="keyword">const</span> ReceiveCommand = <span class="function"><span class="params">receiver</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">this</span>.receiver = receiver</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å¼€ç”µè§†</span></span><br><span class="line">ReceiveCommand.prototype.execute = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.receiver.open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…³ç”µè§†</span></span><br><span class="line">ReceiveCommand.prototype.undo = functon () &#123;</span><br><span class="line"><span class="keyword">this</span>.receiver.close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å‘½ä»¤</span></span><br><span class="line"><span class="keyword">const</span> setCommand = <span class="function"><span class="keyword">function</span> (<span class="params">command</span>) </span>&#123;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'open'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">command.execute()</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'close'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">command.undo()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å°†å‘½ä»¤å‘Šè¯‰æ‰§è¡Œè€…, è®¾ç½®å‘½ä»¤ä¼ å…¥æ‰§è¡Œè€…</span></span><br><span class="line">setCommand(<span class="keyword">new</span> ReceiveCommand(TV))</span><br></pre></td></tr></table></figure></li></ul><p>å‘½ä»¤æ¨¡å¼æ˜¯æŠŠè¯·æ±‚å‘èµ·è€…å’Œæ‰§è¡Œå‘½ä»¤(æ‰§è¡Œè€…)åˆ†ç¦»å¼€æ¥, ä»¥è¾¾åˆ°è§£è€¦çš„ç›®çš„. åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰, æŠŠå‘½ä»¤æ”¾å…¥æ‰§è¡Œè€…æ¥å‘Šè¯‰æ‰§è¡Œè€…è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„å‘½ä»¤, å‘½ä»¤æ¨¡å¼å¤§æ¦‚å°±æ˜¯è¿™æ ·å•¦.</p><ul><li>é—­åŒ…ç‰ˆ<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TV = &#123;</span><br><span class="line">open () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is open!'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">close () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is close!'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œè€…</span></span><br><span class="line"><span class="keyword">const</span> receiveCommand = <span class="function"><span class="params">receiver</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> execute = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> receiver.open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> undo = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> receiver.close()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">execute: execute,</span><br><span class="line">undo: undo</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‘èµ·è€…</span></span><br><span class="line"><span class="keyword">const</span> setCommand = <span class="function"><span class="params">command</span> =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'open'</span>).onclick = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">execute.open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'close'</span>).onclick = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">undo.close()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">setCommand(receiveCommand(TV))</span><br></pre></td></tr></table></figure></li></ul><p>é—­åŒ…æ˜æ˜¾æ¸…æ™°æ›´å¤š, ä¹Ÿæ›´ç®€æ´.</p><blockquote><h3 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h3><p>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’æˆ–è®©å‡½æ•°æ‰§è¡Œç»“æœè¿”å›å¦ä¸€ä¸ªå‡½æ•°, æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€çš„å‡½æ•°éƒ½å¯ä»¥ç§°ä½œä¸ºé«˜é˜¶å‡½æ•°.</p></blockquote><h4 id="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’"><a href="#å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’" class="headerlink" title="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’"></a>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’</h4><p>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ä¸ä¸šåŠ¡ç›¸å…³çš„é€»è¾‘ä»£ç åˆ†ç¦»å‡ºæ¥, è§£é™¤ä¸šåŠ¡ä»£ç å’Œä¸å˜é€»è¾‘çš„è€¦åˆ, æœ€å¸¸è§çš„å°±æ˜¯æˆ‘ä»¬çš„å›è°ƒå‡½æ•°. å®é™…è¿ç”¨ä¸­ ajax å¼‚æ­¥è¯·æ±‚, å½“æˆ‘ä»¬ä¸çŸ¥é“è¿”å›å€¼åœ¨ä»€ä¹ˆæ—¶å€™è¿”å›å€¼åˆéœ€è¦åœ¨è¿”å›ååšä¸€äº›å¤„ç†, å°±è¦ç”¨åˆ°å›è°ƒå‡½æ•°äº†.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getPersonInfo = <span class="function"><span class="keyword">function</span> (<span class="params">userId, callback</span>) </span>&#123;</span><br><span class="line">$.ajax(<span class="string">`http://xxx/getPersonInfo?<span class="subst">$&#123;userId&#125;</span>`</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">callback &amp;&amp; callback(data)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œçš„åŒ¿åå‡½æ•°å°±æ˜¯ä¸Šé¢çš„ callback</span></span><br><span class="line">getPersonInfo(<span class="string">"54332123"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„å›è°ƒå‡½æ•°, åœ¨å…¶ä»–çš„æ–¹é¢, ä¹Ÿå¯ä»¥å°†ä¸€äº›è¯·æ±‚å§”æ‰˜ç»™å¦ä¸€ä¸ªå‡½æ•°ä»£ä¸ºæ‰§è¡Œ, å¦‚:<br>å‡å¦‚æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»º100çš„ div èŠ‚ç‚¹, ç„¶åæŠŠå®ƒä»¬éšè—æ‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count é»˜è®¤å€¼ä¸º100</span></span><br><span class="line"><span class="keyword">const</span> appendDiv = count = <span class="number">100</span>, callback =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (count &amp;&amp; <span class="keyword">typeof</span> count === <span class="string">'number'</span>) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++)&#123;</span><br><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">div.innerHTML = i</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line"><span class="comment">// å°†ä¸šåŠ¡ä»£ç å§”æ‰˜æ‰§è¡Œ</span></span><br><span class="line">callback &amp;&amp; callback(div)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// æŠŠæ”¹å˜æ ·å¼çš„ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥</span></span><br><span class="line">appendDiv(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">el.style.cssText = <span class="string">`display: none`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å°†ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥äº†, ä»¥åå¯èƒ½æˆ‘ä»¬æƒ³æ”¹é¢œè‰²å•¦æˆ–è€…ä½ç½®ä»€ä¹ˆçš„ä¹Ÿæ–¹ä¾¿ç»´æŠ¤.</p><h4 id="å‡½æ•°ä½œä¸ºè¿”å›å€¼"><a href="#å‡½æ•°ä½œä¸ºè¿”å›å€¼" class="headerlink" title="å‡½æ•°ä½œä¸ºè¿”å›å€¼"></a>å‡½æ•°ä½œä¸ºè¿”å›å€¼</h4><p>ç›¸æ¯”æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, å¯èƒ½å‡½æ•°å½“åšè¿”å›å€¼è¿”å›è¿ç”¨åœºæ™¯æ›´å¤šä¸€äº›, è®©å‡½æ•°è¿”å›å¦ä¸€ä¸ªå¯æ‰§è¡Œå‡½æ•°å°±æ„å‘³ç€è¿ç®—è¿‡ç¨‹å¯å»¶ç»­.ç›´æ¥æ¥çœ‹ä¸€äº›ä¾‹å­å§.</p><ul><li>æ£€æŸ¥ç±»å‹</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Type = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, type; type = [<span class="string">'Array'</span>, <span class="string">'String'</span>, <span class="string">'Number'</span>][i++];) &#123;</span><br><span class="line">Type[<span class="string">'is'</span> + type] = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object '</span>+ type +<span class="string">']'</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Type.isArray([])) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Type.isString(<span class="string">'123'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Type.isNumber(<span class="number">123</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>å•ä¾‹æ¨¡å¼<br>  è¿™é‡Œå…ˆä¸è®¨è®ºå•ä¾‹æ¨¡å¼, åªçœ‹ä»£ç å®ç°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fn å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’</span></span><br><span class="line"><span class="keyword">const</span> getSingle = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> ret;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// å¦‚æœ ret ä¸å­˜åœ¨, ret ç­‰äº fn å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> ret || (ret = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// è°ƒç”¨è¿™ä¸ªé«˜é˜¶å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> getDiv = getSingle(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// å‚æ•°ä¹Ÿä¼šä¸€èµ·ä¼ è¿‡æ¥, è¿™é‡Œè¿”å›['123']</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">getDiv(<span class="string">'123'</span>)</span><br></pre></td></tr></table></figure><p>getSingle è¿™ä¸ªé«˜é˜¶å‡½æ•°æ—¢å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, åˆè®©å‡½æ•°æ‰§è¡Œåè¿”å›å¦ä¸€ä¸ªå‡½æ•°.</p><blockquote><p>JavaScript è®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µè¿˜æœ‰ä¸ªä¾‹å­ä¹Ÿå¾ˆæœ‰æ„æ€<br>å«åš AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹), ä½œç”¨æ˜¯æŠŠä¸ä¸šåŠ¡é€»è¾‘ä¸ç›¸å…³çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å†é€šè¿‡åŠ¨æ€æ¤å…¥çš„æ–¹å¼åŠ å…¥ä¸šåŠ¡é€»è¾‘çš„æ¨¡å—ä¸­.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åŸå‡½æ•°ä¹‹å‰</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span> (<span class="params">beforeFn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> that = <span class="keyword">this</span>; <span class="comment">// ä¿å­˜åŸå‡½æ•°çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// A</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œæ–°å‡½æ•°å¹¶ä¿®æ­£ this</span></span><br><span class="line">beforeFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line"><span class="comment">// æ‰§è¡ŒåŸå‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> that.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨åŸå‡½æ•°ä¹‹å</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span> (<span class="params">afterFn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// B</span></span><br><span class="line"><span class="comment">// å…ˆæ‰§è¡Œ before å‡½æ•°</span></span><br><span class="line">that.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line"><span class="comment">// å†æ‰§è¡Œæ–°å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> afterFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn = fn.before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fn() <span class="comment">// æŒ‰é¡ºåºè¾“å‡º 1 2 3</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:</p><ol><li>Afterä¸­çš„å›è°ƒå‡½æ•° B<br>å› ä¸ºåœ¨æœ€åæ‰§è¡Œ fn å‡½æ•°æ—¶, fn å·²ç»æ˜¯ after å‡½æ•°äº†, å› æ­¤åœ¨ fn() æ‰§è¡Œæ—¶è°ƒç”¨çš„æ˜¯ after ä¸­è¿”å›çš„åŒ¿åå‡½æ•°B.</li><li>B ä¸­çš„ that.apply(this, arguments)<br>æ­¤æ—¶çš„ that æŒ‡å‘ before å‡½æ•°</li><li>æ‰§è¡ŒBeforeä¸­çš„å›è°ƒå‡½æ•° A</li><li>A ä¸­çš„ beforeFn.apply(this, arguments)<br>æ‰§è¡Œ console.log(1)</li><li>return that.apply(this, arguments)<br>æ‰§è¡Œ console.log(2)</li><li>å›åˆ° after å‡½æ•°ä¸­æ‰§è¡Œreturn afterFn.apply(this, arguments)<br>æ‰§è¡Œ console.log(3)</li></ol><h4 id="å‡½æ•°æŸ¯é‡ŒåŒ–"><a href="#å‡½æ•°æŸ¯é‡ŒåŒ–" class="headerlink" title="å‡½æ•°æŸ¯é‡ŒåŒ–"></a>å‡½æ•°æŸ¯é‡ŒåŒ–</h4><p>å‡½æ•°æŸ¯é‡ŒåŒ–å¯ä»¥è¯´æ˜¯é«˜é˜¶å‡½æ•°ç»å…¸ä¸­çš„ç»å…¸äº†, è¯´åˆ°é«˜é˜¶å‡½æ•°åº”è¯¥å¾ˆå¿«å°±ä¼šæƒ³åˆ°ä»–äº†. æˆ‘ç†è§£çš„å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯: å…ˆå°†å‚æ•°ä¾æ¬¡ç¼“å­˜, åœ¨çœŸæ­£éœ€è¦è®¡ç®—ç»“æœæ—¶, æ‰è¿›è¡Œè®¡ç®—è¿™æ ·å¯ä»¥å‡å°‘è¿ç®—æ¬¡æ•°.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šç”¨ curring</span></span><br><span class="line"><span class="keyword">const</span> curring = <span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> argsArr = []</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [...args].length === <span class="number">0</span></span><br><span class="line">            ? fn.apply(<span class="literal">null</span>, argsArr)</span><br><span class="line">            : [].push.apply(argsArr, [...args])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦è®¡ç®—çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> calculate = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> money = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...argsArr</span>) =&gt;</span> &#123;</span><br><span class="line">        argsArr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            money += item</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> money</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¯é‡ŒåŒ–</span></span><br><span class="line">calculate = curring(calculate)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜å‚æ•°, å…¶å®å¹¶æ²¡æœ‰è®¡ç®—</span></span><br><span class="line">calculate(<span class="number">20</span>)</span><br><span class="line">calculate(<span class="number">40</span>)</span><br><span class="line">calculate(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœŸæ­£è®¡ç®—çš„æ—¶å€™</span></span><br><span class="line">calculate()</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°èŠ‚æµ"><a href="#å‡½æ•°èŠ‚æµ" class="headerlink" title="å‡½æ•°èŠ‚æµ"></a>å‡½æ•°èŠ‚æµ</h4><p>åœ¨æŸäº›åœºæ™¯ä¸‹å‡½æ•°æœ‰å¯èƒ½ä¼šè¢«éå¸¸é¢‘ç¹åœ°è°ƒç”¨, ä»è€Œé€ æˆå¾ˆå¤§çš„æ€§èƒ½é—®é¢˜. ä¾‹å¦‚: window.resizeäº‹ä»¶ã€mousemove äº‹ä»¶, å®ƒä»¬è§¦å‘çš„é¢‘ç‡å¤ªé«˜äº†, è€Œç”¨æˆ·å¹¶ä¸éœ€è¦å¦‚æ­¤é«˜é¢‘ç‡çš„ä½¿ç”¨. å› æ­¤å‡½æ•°èŠ‚æµå°±æ˜¯ä¸ºäº†é™åˆ¶å‡½æ•°å‡ºå‘çš„é¢‘ç‡.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èŠ‚æµ</span></span><br><span class="line"><span class="keyword">const</span> throttle = <span class="function">(<span class="params">fn, interval = <span class="number">800</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> isFirst = <span class="literal">true</span>, timer</span><br><span class="line">    <span class="comment">// ...args =&gt; event</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">if</span> (isFirst) &#123;</span><br><span class="line">            fn.apply(that, [...args])</span><br><span class="line">            <span class="keyword">return</span> isFirst = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (timer) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">            fn.apply(that, [...args])</span><br><span class="line">        &#125;, interval)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥éœ€è¦èŠ‚æµçš„å‡½æ•°å’Œé—´éš”æ—¶é—´</span></span><br><span class="line"><span class="built_in">window</span>.onresize = throttle(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">800</span>)</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ—¶å‡½æ•°"><a href="#åˆ†æ—¶å‡½æ•°" class="headerlink" title="åˆ†æ—¶å‡½æ•°"></a>åˆ†æ—¶å‡½æ•°</h4><p>ä¸Šé¢æˆ‘ä»¬æä¾›äº†ä¸€ç§é™åˆ¶å‡½æ•°è°ƒç”¨é¢‘ç‡çš„è§£å†³æ–¹æ¡ˆ, ç°åœ¨æ˜¯å¦ä¸€ä¸ªé—®é¢˜: æŸäº›å‡½æ•°æ˜¯ç”±ç”¨æˆ·ä¸»åŠ¨å”¤èµ·çš„, ä½†æ˜¯å› ä¸ºä¸€äº›åŸå› å¯¼è‡´å‡½æ•°ä¸¥é‡å½±å“é¡µé¢çš„æ€§èƒ½. åˆ†æ—¶å‡½æ•°å¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ç†è§£çš„åˆ†æ—¶å‡½æ•°: å°†è¯·æ±‚åˆ†æ‰¹å¤„ç†, åœ¨ä¸€å®šçš„æ—¶é—´å†…æ‰§è¡Œä¸€éƒ¨åˆ†è¯·æ±‚, ç›´åˆ°è¯·æ±‚å…¨éƒ¨å®Œæˆ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†æ—¶å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> timeChunk = <span class="function">(<span class="params">data, fn, count = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> timer, obj</span><br><span class="line">    <span class="keyword">const</span> start = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.min(count, data.length); i++) &#123;</span><br><span class="line">            obj = data.shift()</span><br><span class="line">            fn.apply(<span class="literal">null</span>, obj)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data.length === <span class="number">0</span>) &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            start()</span><br><span class="line">        &#125;, <span class="number">200</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> ary = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    ary.push(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æ—¶åŒ–</span></span><br><span class="line"><span class="keyword">let</span> renderfriendList = timeChunk(ary, <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">    div.innerHTML = n</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line">&#125;, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸²æŸ“</span></span><br><span class="line">renderfriendList()</span><br></pre></td></tr></table></figure><h4 id="æƒ°æ€§åŠ è½½"><a href="#æƒ°æ€§åŠ è½½" class="headerlink" title="æƒ°æ€§åŠ è½½"></a>æƒ°æ€§åŠ è½½</h4><p>ä¸¾ä¸ªä¾‹å­, åœ¨ web ä¸­ä¸ºäº†æ»¡è¶³å„æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚, æˆ‘ä»¬ä¼šåšä¸€äº›å—…æ¢å·¥ä½œ. å¼‚äºå¸¸è§„æ–¹æ¡ˆ, æƒ°æ€§åŠ è½½åœ¨çœŸæ­£éœ€è¦æ—¶æ‰ä½¿ç”¨ä¸”è¿›å…¥æ¡ä»¶åˆ†æ”¯ååœ¨å†…éƒ¨é‡å†™è¯¥å‡½æ•°, è¿™æ ·é‡å†™åçš„å‡½æ•°å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å‡½æ•°.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> addEvent = <span class="function">(<span class="params">el, type, handler</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</span><br><span class="line">        <span class="comment">// é‡å†™å‡½æ•°</span></span><br><span class="line">        addEvent = <span class="function">(<span class="params">el, type, handler</span>) =&gt;</span> &#123;</span><br><span class="line">            el.addEventListener(type, handler, <span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</span><br><span class="line">        addEvent = <span class="function">(<span class="params">el, type, handler</span>) =&gt;</span> &#123;</span><br><span class="line">            el.attachEvent(<span class="string">'on'</span> + type, handler)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    addEvent(el, type, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">addEvent(btn, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'click!'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Created on 2017-10-26 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™ä¸€ç¯‡ç¬”è®°æ˜¯ä¸ºæ­£å¼å¼€å§‹å­¦ä¹  javadcript è®¾è®¡æ¨¡å¼åšé“ºå«ï¼Œç”±äºè®¸å¤šè®¾è®¡æ¨¡å¼éƒ½ç”¨åˆ°äº†é—­åŒ…å’Œé«˜é˜¶å‡½æ•°æ¥å®ç°, æ‰€ä»¥äº†è§£è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯å¿…è¦çš„.&lt;/p&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;é—­åŒ…&quot;&gt;&lt;a href=&quot;#é—­åŒ…&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="JavaScriptè®¾è®¡æ¨¡å¼" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>base64 è½¬ blob</title>
    <link href="https://yoursite.com/2017/10/22/base64-%E8%BD%AC-blob/"/>
    <id>https://yoursite.com/2017/10/22/base64-è½¬-blob/</id>
    <published>2017-10-22T13:44:12.000Z</published>
    <updated>2018-05-13T03:49:29.856Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = base64.split(<span class="string">','</span>), mime = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">    bstr = atob(arr[<span class="number">1</span>]), n = bstr.length, u8arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(n);</span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        <span class="comment">// charCodeAt() æ–¹æ³•å¯è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦çš„ Unicode ç¼–ç </span></span><br><span class="line">        u8arr[n] = bstr.charCodeAt(n);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 'application/octet-binary' (é»˜è®¤å€¼)</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([u8arr], &#123; <span class="attr">type</span>: mime &#125;)</span><br></pre></td></tr></table></figure><h4 id="Base64-çš„ç¼–ç ç å’Œè§£ç "><a href="#Base64-çš„ç¼–ç ç å’Œè§£ç " class="headerlink" title="Base64 çš„ç¼–ç ç å’Œè§£ç "></a>Base64 çš„ç¼–ç ç å’Œè§£ç </h4><p>ä½¿ç”¨atob å’Œ btoa æ–¹æ³•.</p><ul><li>atob() è§£ç </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">atob(<span class="string">"amF2YXNjcmlwdA=="</span>)</span><br><span class="line"><span class="comment">// è§£ç ç»“æœ "javascript"</span></span><br></pre></td></tr></table></figure><ul><li>btoa() ç¼–ç </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.btoa(javascript)</span><br><span class="line"><span class="comment">// è½¬ç ç»“æœ "amF2YXNjcmlwdA=="</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸¤ç§æ–¹æ³•å¯¹äºä¸­æ–‡æ˜¯æœ‰å±€é™æ€§çš„, è§£å†³å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"Chinaï¼Œä¸­å›½"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆç”¨ encodeURI() ç¼–ç </span></span><br><span class="line"><span class="built_in">window</span>.btoa(<span class="built_in">window</span>.encodeURIComponent(str))</span><br><span class="line"><span class="comment">// "Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ="</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// atob è§£ç  Base64 å†ç”¨ decodeURI() è§£ç </span></span><br><span class="line"><span class="built_in">window</span>.decodeURIComponent(<span class="built_in">window</span>.atob(<span class="string">'Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ='</span>))</span><br><span class="line"><span class="comment">// "Chinaï¼Œä¸­å›½"</span></span><br></pre></td></tr></table></figure><p>Created on 2017-9-4 by Cara*</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span 
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç›’æ¨¡å‹</title>
    <link href="https://yoursite.com/2017/10/21/%E7%9B%92%E6%A8%A1%E5%9E%8B/"/>
    <id>https://yoursite.com/2017/10/21/ç›’æ¨¡å‹/</id>
    <published>2017-10-21T15:58:06.000Z</published>
    <updated>2018-05-13T03:49:29.859Z</updated>
    
    <content type="html"><![CDATA[<p><code>CSS</code> ç›’æ¨¡å‹ (Box Model), åŒ…å«çš„è¦ç´ åˆ†åˆ«ä¸º: content/padding/border/margin.</p><h3 id="æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹"><a href="#æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹" class="headerlink" title="æ ‡å‡†ç›’æ¨¡å‹ &amp; æ€ªå¼‚ç›’æ¨¡å‹"></a>æ ‡å‡†ç›’æ¨¡å‹ &amp; æ€ªå¼‚ç›’æ¨¡å‹</h3><p>ç›’æ¨¡å‹åˆ†ä¸ºW3Cçš„æ ‡å‡†ç›’æ¨¡å‹å’ŒIEçš„æ ‡å‡†ç›’æ¨¡å‹.</p><ul><li><p>æ ‡å‡†ç›’æ¨¡å‹<br><code>content + padding+ border + margin</code>  æ ‡å‡†ç›’æ¨¡å‹çš„ content æ˜¯ä¸åŒ…å«å…¶ä»–éƒ¨åˆ†çš„, å¦‚ä¸‹å›¾:<br><img src="http://orf90agxq.bkt.clouddn.com/GitHub/boxW3C_BOX.jpeg" alt="W3C-BOX"></p></li><li><p>IEæ ‡å‡†ç›’æ¨¡å‹<br><code>content(padding + border) + margin</code> è€ŒIEæ ‡å‡†ç›’æ¨¡å‹çš„ content å·²ç»åŒ…å«paddingå’Œborderçš„å€¼, å¦‚ä¸‹å›¾:<br><img src="http://orf90agxq.bkt.clouddn.com/GitHub/boxIE_BOX.jpeg" alt="IE-BOX"></p></li></ul><p>åœ¨æ–‡æ¡£é¡¶éƒ¨å£°æ˜ <code>DOCTYPE</code> å°±æ˜¯ä¸ºäº†è®©æµè§ˆå™¨ä½¿ç”¨ W3Cæ ‡å‡†ç›’æ¨¡å‹, ä½†æ˜¯åœ¨ IE5/ IE6 ä¸‹ä¾ç„¶æ˜¯ IE æ ‡å‡†ç›’æ¨¡å‹. å½“ç„¶é€šè¿‡<code>box-sizing</code>å±æ€§å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´è½¬æ¢.</p><h4 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h4><ol><li><p>ä¸¤ä¸ªå‚ç›´æ–¹å‘ç›¸é‚»çš„å—çº§å…ƒç´ ç›¸é‡æ—¶, å¤–è¾¹è·ä¼šåˆå¹¶ä¸”å–å€¼ä¸¤è€…è¾ƒå¤§å€¼çš„ <code>margin</code> ä½œä¸ºå¤–è¾¹è·.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line"> *&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>; </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>margin å‡ºè½¨â€¦<br>å½“çˆ¶å…ƒç´ æ²¡æœ‰ <code>border</code> è¾¹æ¡†æ—¶, ç¬¬ä¸€ä¸ªå­å…ƒç´ æ·»åŠ  <code>margin-top</code> ä¼šè¶…å‡ºçˆ¶å…ƒç´ , ç›¸åŒæœ€åä¸€ä¸ªå­å…ƒç´ æ·»åŠ  <code>margin-bottom</code> ä¹ŸåŒæ ·ä¼šè¶…å‡ºçˆ¶å…ƒç´ , å¦‚ä¸‹å›¾: </p></li></ol><ul><li><p>ç¬¬ä¸€ä¸ªå­å…ƒç´ æ·»åŠ  margin-top<br><img src="http://orf90agxq.bkt.clouddn.com/box_modelmargin.png" alt="marginTop"></p></li><li><p>æœ€åä¸€ä¸ªå­å…ƒç´ æ·»åŠ  margin-bottom<br><img src="http://orf90agxq.bkt.clouddn.com/box_modelmarginBottom.png" alt="marginBottom"></p></li><li><p>å‰ä¸¤è€…åŒæ—¶å­˜åœ¨æ—¶, çˆ¶å…ƒç´ æ·»åŠ  border<br><img src="http://orf90agxq.bkt.clouddn.com/box_modelborder.png" alt="marginBottom"></p></li></ul><p>è§£å†³æ–¹æ¡ˆæœ‰å››ç§: </p><blockquote><ol><li>ç»™çˆ¶å…ƒç´ æ·»åŠ  border.</li></ol></blockquote><blockquote><ol start="2"><li>ç»™çˆ¶å…ƒç´ æ·»åŠ  padding.</li></ol></blockquote><blockquote><ol start="3"><li>ç»™çˆ¶å…ƒç´ æ·»åŠ  overflow: hidden.</li></ol></blockquote><blockquote><ol start="4"><li>ç»™çˆ¶å…ƒç´ æ·»åŠ ä¼ªç±». (æœ€ä½³)<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><p>Created on 2017-8-15 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;CSS&lt;/code&gt; ç›’æ¨¡å‹ (Box Model), åŒ…å«çš„è¦ç´ åˆ†åˆ«ä¸º: content/padding/border/margin.&lt;/p&gt;
&lt;h3 id=&quot;æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹&quot;&gt;&lt;a href=&quot;#æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹&quot; class=
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="CSS" scheme="https://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>ä½è¿ç®—ç¬¦</title>
    <link href="https://yoursite.com/2017/10/18/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
    <id>https://yoursite.com/2017/10/18/ä½è¿ç®—ç¬¦/</id>
    <published>2017-10-18T15:06:59.000Z</published>
    <updated>2018-05-13T03:49:29.858Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Cæˆ–è€…å…¶ä»–è¯­è¨€æ•°å€¼çš„è¿ç®—å…¶å®éƒ½æ˜¯å…ˆå°†æ•°å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶åœ¨åšè¿ç®—çš„,<br>è€Œä½è¿ç®—ç¬¦å°±æ˜¯ç›´æ¥è¿›è¡ŒäºŒè¿›åˆ¶è¿ç®—, å› æ­¤é€Ÿåº¦ä¼šéå¸¸å¿«. ä½†æ˜¯å¯¹äºJavaScript<br>æ¥è¯´, æ‰§è¡Œç¯å¢ƒä¸€èˆ¬æ¥è§¦ä¸åˆ°ç¡¬ä»¶, æ‰€ä»¥æ€§èƒ½å®Œå…¨ä¸èƒ½å’Œå…¶ä»–è¯­è¨€ç›¸æ¯”. ä¸è¿‡ä½œä¸º<br>äº†è§£è¿˜æ˜¯éœ€è¦çš„, åªå¯¹è¾ƒä¸ºå¸¸è§çš„ä½è¿ç®—ç¬¦ä½œè®°å½•.</p><h3 id="ä½è¿ç®—-NOT"><a href="#ä½è¿ç®—-NOT" class="headerlink" title="ä½è¿ç®— NOT"></a>ä½è¿ç®— NOT</h3><p>ä½è¿ç®— NOT ç”± ( ~ ) ç¬¦å·è¡¨ç¤º, å…¶å®å°±æ˜¯å¯¹æ•°å€¼æ±‚è´Ÿä¹‹åå†å‡ä¸€, å¦‚:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> num2 = ~num;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ~num æ•ˆæœåŒä¸‹</span></span><br><span class="line">num2 = -num - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num2); <span class="comment">// -11</span></span><br></pre></td></tr></table></figure><h3 id="å·¦ä½ç§»è¿ç®—"><a href="#å·¦ä½ç§»è¿ç®—" class="headerlink" title="å·¦ä½ç§»è¿ç®—"></a>å·¦ä½ç§»è¿ç®—</h3><p>å·¦ä½ç§»è¿ç®—ç”± ( &lt;&lt; ) ç¬¦å·è¡¨ç¤º. å°†æ•°å€¼çš„æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨æŒ‡å®šæ•°é‡.ä¾‹å¦‚:<br>å·¦ç§»ä¸€ä½ä¹˜2, å·¦ç§»2ä½ä¹˜4, ä»¥æ­¤ç±»æ¨.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> num2 = num &lt;&lt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•ˆæœåŒä¸‹</span></span><br><span class="line"> num2 = num * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num2); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><h3 id="æœ‰ç¬¦å·å³ç§»è¿ç®—"><a href="#æœ‰ç¬¦å·å³ç§»è¿ç®—" class="headerlink" title="æœ‰ç¬¦å·å³ç§»è¿ç®—"></a>æœ‰ç¬¦å·å³ç§»è¿ç®—</h3><p>æœ‰ç¬¦å·å³ç§»è¿ç®—ç¬¦ç”± ( &gt;&gt; ) ç¬¦å·è¡¨ç¤º, å°†æ•°å€¼çš„æ‰€æœ‰ä¸ºå‘å³ç§»åŠ¨æŒ‡å®šä½æ•°,<br>åŒæ—¶ä¿ç•™è¯¥æ•°çš„ç¬¦å· (æ­£å·æˆ–è€…è´Ÿå·) . æœ‰ç¬¦å·å³ç§»è¿ç®—ç¬¦è·Ÿå·¦ä½ç§»è¿ç®—ç¬¦æ­£å¥½<br>ç›¸å.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">let</span> num2 = num &gt;&gt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•ˆæœåŒä¸‹</span></span><br><span class="line">num2 = num / <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num2) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦"><a href="#æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦" class="headerlink" title="æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦"></a>æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦</h3><p>æ— ç¬¦å·è¿ç®—ç¬¦ç”± ( &gt;&gt;&gt; ) ç¬¦å·è¡¨ç¤º, å¯¹äºæ­£æ•°æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦è·Ÿæ— ç¬¦å·å³ä½ç§»<br>è¿ç®—ç¬¦è§„åˆ™ç›¸åŒ; è´Ÿæ•°æ—¶ä¼šå‡ºç°æ— é™å¤§çš„æ•°å€¼, æ‰€ä»¥å†³å®šä½¿ç”¨æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦<br>æ—¶ä¸€å®šè¦å°å¿ƒ.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨Cæˆ–è€…å…¶ä»–è¯­è¨€æ•°å€¼çš„è¿ç®—å…¶å®éƒ½æ˜¯å…ˆå°†æ•°å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶åœ¨åšè¿ç®—çš„,&lt;br&gt;è€Œä½è¿ç®—ç¬¦å°±æ˜¯ç›´æ¥è¿›è¡ŒäºŒè¿›åˆ¶è¿ç®—, å› æ­¤é€Ÿåº¦ä¼šéå¸¸å¿«. ä½†æ˜¯å¯¹äºJavaScript&lt;br&gt;æ¥è¯´, æ‰§è¡Œç¯å¢ƒä¸€èˆ¬æ¥è§¦ä¸åˆ°ç¡¬ä»¶, æ‰€ä»¥æ€§èƒ½å®Œå…¨ä¸èƒ½å’Œå…¶ä»–è¯­è¨€ç›¸æ¯”. ä¸è¿‡ä½œä¸º&lt;br&gt;äº†è§£è¿˜æ˜¯éœ€è¦çš„, åªå¯¹
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>this/ call and apply</title>
    <link href="https://yoursite.com/2017/10/17/this-call-and-apply/"/>
    <id>https://yoursite.com/2017/10/17/this-call-and-apply/</id>
    <published>2017-10-17T15:01:38.000Z</published>
    <updated>2018-06-18T15:39:45.431Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ JavaScript ä¸­, <code>this</code>å…³é”®å­—å¾ˆå®¹æ˜“ä½¿å¤§å®¶ç–‘æƒ‘, å†åŠ ä¸Š <code>Function.prototype.call</code>å’Œ<code>Function.prototype.apply</code>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¹¿æ³›è¿ç”¨, æ‰€ä»¥å¾ˆæœ‰å¿…è¦å¼„æ¸…<code>this</code>çš„ä½¿ç”¨.</p><blockquote><h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p>é¦–å…ˆå…ˆè¯´ä¸€ä¸‹<code>this</code>çš„æ¦‚å¿µ: <code>this</code>æ€»æ˜¯æŒ‡å‘ä¸€ä¸ªå¯¹è±¡, è€Œè¿™ä¸ªå¯¹è±¡å…·ä½“æ˜¯è°, æ˜¯æ ¹æ®è¿è¡Œæ—¶çš„å‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒåŠ¨æ€ç»‘å®šçš„, è€Œéå‡½æ•°è¢«å£°æ˜æ—¶çš„ç¯å¢ƒ. å½“ç„¶åˆ°ç°åœ¨ç®­å¤´å‡½æ•°çš„å‡ºç°, <code>this</code>å¯¹ä¸äº†è§£çš„åŒå­¦ä»¬æ¥è¯´, æ— ç–‘æ˜¯æ·»äº†ä¸€æŠŠä¹±â€¦ æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„æ¥è¯´å§.</p></blockquote><h4 id="1-thisçš„æŒ‡å‘"><a href="#1-thisçš„æŒ‡å‘" class="headerlink" title="1. thisçš„æŒ‡å‘"></a>1. <code>this</code>çš„æŒ‡å‘</h4><p>æˆ‘ä»¬é™¤å¼€ä¸å¸¸ç”¨çš„ with å’Œ eval çš„æƒ…å†µ, å…·ä½“åˆ°å®é™…åº”ç”¨ä¸­, <code>this</code>çš„æŒ‡å‘å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç§æƒ…å†µ.</p><ul><li>ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨</li><li>ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨</li><li>æ„é€ å™¨è°ƒç”¨</li><li><p>è¢« call å’Œ apply æ–¹æ³•è°ƒç”¨<br>ä¸‹é¢æ¥ç”¨ &lt; JavaScript è®¾è®¡æ¨¡å¼ &gt; ä¸­çš„ä¾‹å­è¯´æ˜è¿™å››ç§æƒ…å†µ.</p><ol><li><p>ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨<br>å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶, <code>this</code>æŒ‡å‘è¯¥å¯¹è±¡:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'cara'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span> === obj)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.getName() <span class="comment">// true 'cara'</span></span><br></pre></td></tr></table></figure></li><li><p>ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨<br>å½“å‡½æ•°ä¸ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶, ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„æ™®é€šå‡½æ•°çš„æ–¹å¼, æ­¤æ—¶çš„<code>this</code>æ€»æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">let</span> getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getName()) <span class="comment">// 'window'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'obj'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œ obj çš„ getNameæ–¹æ³•èµ‹å€¼ç»™äº†ä¸€ä¸ªå˜é‡</span></span><br><span class="line"><span class="comment">// è°ƒç”¨çš„æ—¶å€™å°±åªä¼šä½œä¸ºä¸€ä¸ªæ™®é€šå‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="keyword">let</span> getName = obj.gatName;</span><br><span class="line"><span class="built_in">console</span>.log(getName()) <span class="comment">// 'window'</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸­ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨çš„æ–¹å¼å¸¸å¸¸ä¼šå¸¦æ¥ä¸€äº›å›°æ‰°, æ¯”å¦‚åœ¨æŸä¸ª div èŠ‚ç‚¹çš„äº‹ä»¶å‡½æ•°ä¸­, å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨çš„ callback æ–¹æ³•. è€Œè¿™ä¸ª callback æ–¹æ³•æˆ‘ä»¬å¾€å¾€æ˜¯æƒ³è®©å®ƒçš„ <code>this</code>æŒ‡å‘ div èŠ‚ç‚¹, ä½†å®ƒå†…éƒ¨å´æŒ‡å‘<code>window</code>. å¦‚:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div1'</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ª div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.id = <span class="string">'window'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'div1'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// 'div1'</span></span><br><span class="line">    <span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// 'window'</span></span><br><span class="line">    &#125;</span><br><span class="line">    callback() <span class="comment">// ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³ä»¥ä¸Šé—®é¢˜å…¶å®ä¹Ÿå¾ˆç®€å•, å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.id = <span class="string">'window'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'div1'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id);</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span>; <span class="comment">// ç”¨ä¸€ä¸ªå˜é‡æ¥å‚¨å­˜èŠ‚ç‚¹çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(that.id); <span class="comment">// 'div1'</span></span><br><span class="line">    &#125;</span><br><span class="line">    callback() <span class="comment">// ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ„é€ å™¨è°ƒç”¨<br>å…ˆè¯´è¯´æ„é€ å™¨å§, js ä¸­æ²¡æœ‰ç±»çš„æ¦‚å¿µ, ä½†æ˜¯å¯ä»¥ä»æ„é€ å™¨ä¸­åˆ›å»ºå¯¹è±¡, åŒæ—¶æä¾› <code>new</code> è¿ç®—ç¬¦, è®©æ„é€ å™¨çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªç±». Js ä¸­å¤§éƒ¨åˆ†å‡½æ•°éƒ½å¯ä»¥å½“åšæ„é€ å™¨æ¥ä½¿ç”¨, æ‰€ä»¥å®ƒçš„å¤–è¡¨çœ‹èµ·æ¥è·Ÿæ™®é€šå‡½æ•°ä¸€æ ·, åŒºåˆ«åœ¨äºè¢«è°ƒç”¨çš„æ–¹å¼. å½“ç”¨ <code>new</code> è¿ç®—ç¬¦è°ƒç”¨æ—¶, è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡. é€šå¸¸æƒ…å†µä¸‹, æ„é€ å™¨é‡Œçš„ <code>this</code> å°±æŒ‡å‘è¿”å›çš„è¿™ä¸ªå¯¹è±¡, å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Myobj = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'cara'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Myobj();</span><br><span class="line"><span class="built_in">console</span>.log(obj.name); <span class="comment">// 'cara'</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä½¿ç”¨ <code>new</code>è°ƒç”¨æ„é€ å™¨æ—¶, è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜. å¦‚æœæ„é€ å™¨æ˜¾å¼åœ°è¿”å›äº†ä¸€ä¸ªå¯¹è±¡, é‚£ä¹ˆæœ€ç»ˆå°±ä¼šè¿”å›è¿™ä¸ªå¯¹è±¡, è€Œä¸æ˜¯æˆ‘ä»¬çš„æœŸæœ›çš„ <code>this</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Myobj = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'cara'</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name: <span class="string">'somebody'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Myobj();</span><br><span class="line"><span class="built_in">console</span>.log(obj.name); <span class="comment">// 'somebody'</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ„é€ å™¨ä¸æ˜¾å¼åœ°è¿”å›ä»»ä½•æ•°æ®æˆ–æ˜¯è¿”å›ä¸€ä¸ªéå¯¹è±¡ç±»å‹çš„æ•°æ®, å°±ä¸ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µ</p></li><li><p>call æˆ– apply æ–¹æ³•è°ƒç”¨<br>è·Ÿæ™®é€šçš„å‡½æ•°è°ƒç”¨ç›¸æ¯”, ç”¨ call æˆ–è€… apply æ–¹æ³•è°ƒç”¨å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ä¼ å…¥å‡½æ•°çš„ <code>this</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">    name: <span class="string">'cara'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">    name: <span class="string">'ben'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1.name); <span class="comment">// 'cara'</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.name.call(obj2)); <span class="comment">// 'ben'</span></span><br></pre></td></tr></table></figure><p>call å’Œ apply æ–¹æ³•èƒ½å¤Ÿå¾ˆå¥½çš„ä½“ç° js çš„å‡½æ•°å¼è¯­è¨€ç‰¹æ€§. åœ¨ js ä¸­å‡ ä¹æ¯ä¸€æ¬¡ç¼–å†™å‡½æ•°å¼è¯­è¨€é£æ ¼çš„ä»£ç éƒ½ç¦»ä¸å¼€ call å’Œ apply.</p></li></ol></li></ul><h4 id="2-ä¸¢å¤±çš„-this"><a href="#2-ä¸¢å¤±çš„-this" class="headerlink" title="2. ä¸¢å¤±çš„ this"></a>2. ä¸¢å¤±çš„ this</h4><p>è¿™æ˜¯ä¸€ä¸ªç»å¸¸é‡åˆ°çš„é—®é¢˜, åœ¨åˆšåˆšå¼€å§‹å­¦ä¹  js æ—¶,<code>this</code>çš„æŒ‡å‘å¸¸å¸¸ä»¤æˆ‘ç–‘æƒ‘, å°¤å…¶æ˜¯çœ‹åˆ°ç½‘ä¸Šå…³äº<code>this</code>æŒ‡å‘çš„é¢˜ç›®, ç®€ç›´äº‘é‡Œé›¾é‡Œ. ä¸‹é¢å°±æ¥çœ‹ä¸€äº›ä¾‹å­å§!</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'apple'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.getName()); <span class="comment">// 'apple'</span></span><br><span class="line"><span class="keyword">let</span> getMyName = obj.getName;</span><br><span class="line"><span class="built_in">console</span>.log(getMyName()); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­å¥½ç†è§£, å°±æ˜¯é€šè¿‡ä¸€ä¸ªå˜é‡æ¥å¼•ç”¨<code>obj.getName</code>æ–¹æ³•, å¹¶ä¸”è°ƒç”¨ getMyName æ—¶, å°±æ˜¯ç”¨çš„æ™®é€šå‡½æ•°è°ƒç”¨æ–¹å¼, <code>this</code>æ˜¯æŒ‡å‘å…¨å±€ window çš„.</p><pre><code>æ¥ä¸‹æ¥å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­å§:</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">    name: <span class="string">'person'</span>,</span><br><span class="line">    showName1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;,</span><br><span class="line">    showName2: <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.name),</span><br><span class="line">    showName3: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    showName4: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> person2 = &#123;<span class="attr">name</span>: <span class="string">'person2'</span>&#125;;</span><br><span class="line"></span><br><span class="line">person.showName1();</span><br><span class="line">person.showName1().call(person2);</span><br><span class="line"></span><br><span class="line">person.showName2();</span><br><span class="line">person.showName2().call(person2);</span><br><span class="line"></span><br><span class="line">person.showName3()();</span><br><span class="line">person.showName3().call(person2);</span><br><span class="line">person.showName3.call(person2)();</span><br><span class="line"></span><br><span class="line">person.showName4()();</span><br><span class="line">person.showName4().call(person2);</span><br><span class="line">person.showName4.call(person2)();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å¯èƒ½å¤§å®¶å·²ç»å¾ˆçœ¼ç†Ÿäº†, ä¸è¿‡å½“æ—¶æˆ‘ç¬¬ä¸€æ¬¡åšçš„æ—¶å€™å‡ ä¹é”™äº†ä¸€å¤§åŠğŸ˜’â€¦. ç°åœ¨å†æ‹¿å‡ºæ¥çœ‹çœ‹å…¶å®è¿˜æ˜¯å¾ˆç»å…¸çš„: åœ¨ person å’Œ person2 ä¹‹é—´ç–¯ç‹‚ç© showName æ–¹æ³•. åœ¨ç»™å‡ºç­”æ¡ˆä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹ç®­å¤´å‡½æ•°çš„ä¸€äº›ç‰¹ç‚¹:</p><ul><li>ç®­å¤´å‡½æ•°ä¸å¯ç”¨ä½œæ„é€ å‡½æ•°.</li><li>ä¸å¯ä»¥ä½¿ç”¨ <code>arguments</code>å¯¹è±¡, å¦‚æœè¦ç”¨å¯ä»¥ä½¿ç”¨ rest å‚æ•°ä»£æ›¿.</li><li>ä¸èƒ½ä½¿ç”¨<code>yield</code>å‘½ä»¤, æ‰€ä»¥ç®­å¤´å‡½æ•°ä¹Ÿä¸èƒ½ä½œä¸º Generator å‡½æ•°.</li><li><p>ç®­å¤´å‡½æ•°çš„<code>this</code>æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡, è€Œä¸æ˜¯æ‰§è¡Œæ—¶æ‰€åœ¨çš„å¯¹è±¡.</p><p>  åœ¨æœ€åä¸€ç‚¹çš„<code>this</code>æŒ‡å‘ä¸Š, æˆ‘ä¸ªäººè§‰å¾—æœ‰ç‚¹è¯¯å¯¼(ä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡ç†è§£åˆ°ä½)â€¦ å› ä¸ºå¦‚æœåœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„æ–¹æ³•æ˜¯é€šè¿‡ç®­å¤´å‡½æ•°å®šä¹‰çš„è¯, <code>this</code>çš„æŒ‡å‘å°±ä¼šå’Œä½ æœŸæœ›çš„ä¸ä¸€æ ·äº†. </p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'window'</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'obj'</span>,</span><br><span class="line">    getName: <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line">obj.getName(); <span class="comment">// 'window'</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘è§‰å¾—å…³äºç†è§£ç®­å¤´å‡½æ•°<code>this</code>åœ¨å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡æ˜¯è¿™æ ·: <code>this</code>ç»§æ‰¿è‡ªçˆ¶çº§çš„æ‰§è¡Œä¸Šä¸‹æ–‡(ç®€å•å¯¹è±¡å³éå‡½æ•°, æ˜¯æ²¡æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„), æ‰€ä»¥ä¸Šé¢ä¾‹å­å°±æ˜¯ getName æ–¹æ³•çš„çˆ¶çº§æ˜¯ obj, è€Œ obj çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯<code>window</code>, å› æ­¤è¾“å‡ºå…¨å±€å¯¹è±¡çš„ name. ç†è§£äº†å…³äºç®­å¤´å‡½æ•°<code>this</code>çš„æŒ‡å‘, ç°åœ¨å†æ¥çœ‹çœ‹ç­”æ¡ˆå§:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">person.showName1(); <span class="comment">// 'person'</span></span><br><span class="line">person.showName1().call(person2); <span class="comment">//  'person2'</span></span><br><span class="line"></span><br><span class="line">person.showName2(); <span class="comment">// 'window'</span></span><br><span class="line">person.showName2().call(person2); <span class="comment">// 'window'</span></span><br><span class="line"></span><br><span class="line">person.showName3()(); <span class="comment">// 'window'</span></span><br><span class="line">person.showName3().call(person2); <span class="comment">// 'person2'</span></span><br><span class="line">person.showName3.call(person2)(); <span class="comment">// 'window'</span></span><br><span class="line"></span><br><span class="line">person.showName4()(); <span class="comment">// 'person'</span></span><br><span class="line">person.showName4().call(person2); <span class="comment">// 'person'</span></span><br><span class="line">person.showName4.call(person2)(); <span class="comment">// 'perons2'</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ¥åˆ†æä¸€ä¸‹ç­”æ¡ˆå§:</p><ul><li><p>è°ƒç”¨ showName1()<br>è¿™ä¸¤ä¸ªæ–¹å¼å¥½ç†è§£, ç¬¬ä¸€ç§æ˜¯é€šè¿‡ person å¯¹è±¡æ¥è°ƒç”¨çš„ showName1 æ–¹æ³•, ä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´è¿‡çš„<strong>ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨</strong>, æ‰€ä»¥<code>this</code>è‡ªç„¶æŒ‡å‘çš„æ˜¯person å¯¹è±¡; ç¬¬äºŒç§æ˜¯<strong>è¢« call å’Œ apply æ–¹æ³•è°ƒç”¨</strong>, æ‰€ä»¥<code>this</code>æŒ‡å‘çš„æ˜¯è¢« call æ–¹æ³•çŸ«æ­£çš„ person2.</p></li><li><p>è°ƒç”¨ showName2()<br>showName2 æ–¹æ³•æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°, æ ¹æ®æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ç®­å¤´å‡½æ•°æŒ‡å‘é—®é¢˜æ¥çœ‹. ç¬¬ä¸€ç§é€šè¿‡ person å¯¹è±¡æ¥è°ƒç”¨, ç”±äº person æ˜¯ä¸€ä¸ªç®€å•å¯¹è±¡æ‰€ä»¥è¿™é‡Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡å°±æ˜¯<code>window</code>, é‚£ä¹ˆå°±æ˜¯ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨, <code>this</code>æŒ‡å‘ <code>window</code>; ç¬¬äºŒç§è·Ÿç¬¬ä¸€ç§æ˜¯ç›¸åŒçš„è°ƒç”¨æ–¹å¼, åªæ˜¯æŠŠ person å¯¹è±¡æ¢ä¸º person2.</p></li><li><p>è°ƒç”¨ showName3()<br>Person.showName3 æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°, è¿”å›äº†ä¸€ä¸ªåŒ¿åå‡½æ•°. ç¬¬ä¸€ç§æ–¹å¼ç›¸å½“äºç›´æ¥è°ƒç”¨é‚£ä¸ªåŒ¿åå‡½æ•°æ‰§è¡Œç¯å¢ƒå°±æ˜¯<code>window</code>, æ‰€ä»¥<code>this</code>æŒ‡å‘<code>window</code>; ç¬¬äºŒç§æ–¹å¼é€šè¿‡ person2 æ¥è°ƒç”¨ person çš„é«˜é˜¶å‡½æ•°, è¾“å‡º person2; ç¬¬ä¸‰ç§å…ˆé€šè¿‡ person2 è°ƒç”¨ person çš„é«˜é˜¶å‡½æ•°, ç„¶ååœ¨å…¨å±€ä½œç”¨åŸŸä¸‹æ‰§è¡Œ, å› æ­¤<code>this</code>æŒ‡å‘<code>window</code>.</p></li><li><p>è°ƒç”¨ showName4()<br>æœ€åè¿™ä¸‰ç»„è°ƒç”¨ä¹Ÿæ˜¯é«˜é˜¶å‡½æ•°, ä¸è¿‡è¿”å›çš„åŒ¿åå‡½æ•°ç”¨çš„ç®­å¤´å‡½æ•°. å‰ä¸¤ç§æ–¹å¼ä¹Ÿå°±å°è¯äº†æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„<strong>ç®­å¤´å‡½æ•°çš„ this ç»§æ‰¿è‡ªçˆ¶çº§æ‰§è¡Œä¸Šä¸‹æ–‡</strong>, æ‰€ä»¥å‰ä¸¤ç§éƒ½è¾“å‡º person, å°±ç®—ç¬¬äºŒç§æ–¹å¼åé¢ç”¨ call æ–¹æ³•æ¥çŸ«æ­£ä¹Ÿæ˜¯ä¸è¡Œçš„; ç¬¬ä¸‰ç§ä¹Ÿå°±æ˜¯é€šè¿‡ person2 æ¥è°ƒç”¨æ‰§è¡Œçš„ showName4 æ–¹æ³•, è‡ªç„¶ä¹Ÿå°±è¾“å‡º person2 å•¦.</p></li></ul><blockquote><h3 id="call-å’Œ-apply"><a href="#call-å’Œ-apply" class="headerlink" title="call å’Œ apply"></a>call å’Œ apply</h3><p>Function.prototype.call() å’Œ Function.prototype.apply() éƒ½æ˜¯éå¸¸å¸¸ç”¨çš„æ–¹æ³•, åœ¨å®é™…å¼€å‘ä¸­å’Œ JavaScript çš„è®¾è®¡æ¨¡å¼ä¸­è¿™ä¸¤ä¸ªæ–¹æ³•åº”ç”¨å¹¿æ³›. å…¶å®å®ƒä»¬çš„ä½œç”¨æ˜¯ä¸€æ ·çš„, åªæ˜¯æœ‰ä¼ å…¥å‚æ•°å½¢å¼ä¸åŒçš„åŒºåˆ«.</p></blockquote><ul><li><p>apply<br>apply æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°: ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå‡½æ•°ä½“ä¸­ <code>this</code>çš„æŒ‡å‘; ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªå¸¦ä¸‹æ ‡çš„åˆé›†(å¯ä»¥æ˜¯æ•°ç»„æˆ–è€…ç±»æ•°ç»„), è¿™ä¸ªå‚æ•°å°†ä¼šä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c); <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸º null çš„è¯, è¡¨ç¤ºä¸æ”¹å˜ this çš„æŒ‡å‘</span></span><br><span class="line">fn.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure></li><li><p>call<br>call æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å’Œ apply æ–¹æ³•ä¸€æ ·, æŒ‡å®š<code>this</code>çš„æŒ‡å‘; ç¬¬äºŒä¸ªå‚æ•°ä¸åŒ, call æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°çš„æ•°é‡ä¸å›ºå®š, ä»ç¬¬äºŒå‚æ•°å¼€å§‹ä¸€æ¬¡æŒ‰é¡ºåºä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c); <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;</span><br><span class="line">fn.call(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨æˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“æœ‰å¤šå°‘å‚æ•°è¢«ä¼ å…¥å‡½æ•°æ—¶, å°±å¯ä»¥ä½¿ç”¨ apply æ–¹æ³•ä¸€è‚¡è„‘æ¨è¿‡å»å°±è¡Œäº†; å½“æˆ‘ä»¬æ˜ç¡®çš„çŸ¥é“æœ‰å¤šå°‘å‚æ•°, æƒ³ä¸€ç›®äº†ç„¶çš„è¡¨è¾¾å½¢å‚å’Œå®å‚çš„å¯¹åº”å…³ç³»æ—¶, é‚£ä¹ˆå°±å¯ä»¥ç”¨ call æ–¹æ³•.</p><ul><li><p>å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•<br>call å’Œ apply ç»å¸¸è¢«ç”¨æ¥å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•, å¸¸ç”¨çš„å°±æœ‰å€Ÿç”¨<code>Array</code>çš„æ–¹æ³•æ¥æ“ä½œ<code>arguments</code>æˆ–è€…å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°ä¸€äº›ç±»ä¼¼ç»§æ‰¿çš„æ•ˆæœ.</p><ol><li><p>å€Ÿç”¨æ„é€ å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> A = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å€Ÿç”¨æ„é€ å‡½æ•° A</span></span><br><span class="line"><span class="keyword">let</span> B = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">A.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;;</span><br><span class="line">B.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B(<span class="string">'cara'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b.getName); <span class="comment">// 'cara'</span></span><br></pre></td></tr></table></figure></li><li><p>å€Ÿç”¨ Array çš„æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.call(<span class="built_in">arguments</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// &#123;'0': 1, '1': 2, '2': 3&#125;</span></span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure></li></ol></li></ul><p>å€Ÿç”¨çš„æ—¶å€™è¦ä¿è¯ä¸¤ä¸ªå¿…è¦æ¡ä»¶: 1. å¯¹è±¡æœ¬èº«è¦å¯ä»¥å­˜å–å±æ€§; 2. å¯¹è±¡çš„ length å±æ€§å¯è¯»å†™.</p><blockquote><h3 id="Function-prototype-bind"><a href="#Function-prototype-bind" class="headerlink" title="Function.prototype.bind"></a>Function.prototype.bind</h3><p>ç»‘å®šå‡½æ•° bind ä¹Ÿæ˜¯å¯ä»¥ç”¨ä½œçŸ«æ­£ <code>this</code>çš„æŒ‡å‘, bind å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°(ç»‘å®šå‡½æ•°), æ–°å‡½æ•°å’Œç›®æ ‡å‡½æ•°å°†æ‹¥æœ‰ç›¸åŒçš„å‡½æ•°ä½“. ç¬¬ä¸€ä¸ªå‚æ•°ç»‘å®š<code>this</code>çš„æŒ‡å‘, ä»ç¬¬äºŒå‚æ•°èµ·åé¢çš„å‚æ•°å°†ä½œä¸ºå®å‚ç»‘å®šåˆ°ç›®æ ‡å‡½æ•°çš„å½¢å‚.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> result = sum.bind(<span class="literal">null</span>, <span class="number">1</span>); <span class="comment">// 1 å°†ä½œä¸ºå®å‚ä¼ å…¥ sum</span></span><br><span class="line"><span class="built_in">console</span>.log(result(<span class="number">2</span>)); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦å¤–å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨çš„è¯, ç»‘å®šçš„<code>this</code>å°†è¢«å¿½ç•¥, å®å‚ä¼ å…¥ç›®æ ‡å‡½æ•°.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> original = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">this</span>.b = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.a + x</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">a: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newObj = <span class="keyword">new</span> (original.bind(obj, <span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(newObj.a); <span class="comment">// 1 =&gt; this çš„æŒ‡å‘è¢«å¿½ç•¥</span></span><br><span class="line"><span class="built_in">console</span>.log(newObj.b()); <span class="comment">// 3 =&gt; 2 è¢«ä¼ å…¥ original</span></span><br></pre></td></tr></table></figure><p>call å’Œ apply æ–¹æ³•éƒ½æ˜¯æ”¹å˜<code>this</code>æŒ‡å‘åç«‹å³æ‰§è¡Œè€Œ bind å¯ä»¥åœ¨ä½ æƒ³æ‰§è¡Œçš„<br>æ—¶å€™å†æ‰§è¡Œ.</p><p>å·®ä¸å¤šå°±åˆ°è¿™å„¿å§, è¦æ˜¯æœ‰è¡¥å……å†æ¥ç€å†™â€¦</p><p>Created on 2017-10-17 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ JavaScript ä¸­, &lt;code&gt;this&lt;/code&gt;å…³é”®å­—å¾ˆå®¹æ˜“ä½¿å¤§å®¶ç–‘æƒ‘, å†åŠ ä¸Š &lt;code&gt;Function.prototype.call&lt;/code&gt;å’Œ&lt;code&gt;Function.prototype.apply&lt;/code&gt;è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¹¿æ³›è¿ç”¨, æ‰€
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="JavaScriptè®¾è®¡æ¨¡å¼" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript å…³äºè¿ç®—çš„å°æŠ€å·§</title>
    <link href="https://yoursite.com/2017/10/17/JavaScript-%E5%85%B3%E4%BA%8E%E8%BF%90%E7%AE%97%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://yoursite.com/2017/10/17/JavaScript-å…³äºè¿ç®—çš„å°æŠ€å·§/</id>
    <published>2017-10-17T14:10:33.000Z</published>
    <updated>2018-05-13T03:49:29.854Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h4 id="1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼"><a href="#1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼" class="headerlink" title="1. ä½¿ç”¨ !! æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼"></a>1. ä½¿ç”¨ <code>!!</code> æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼</h4><p>ç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨æˆ–è€…æ˜¯æœ‰æ•ˆå€¼, å¯¹å˜é‡ä½¿ç”¨ <code>!!variable</code> æ¥éªŒè¯,<br>åªè¦å˜é‡çš„å€¼ä¸º: 0, null, undefined, NaNéƒ½å°†è¿”å› false, åä¹‹è¿”å› true. å¦‚: </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> ( count ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.cash = count;</span><br><span class="line">        <span class="keyword">this</span>.myCash = !!count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> emptyFoo = <span class="keyword">new</span> Foo(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo.cash); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.myCash); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo(<span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo.cash); <span class="comment">// 100</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.myCash); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><h4 id="2-ä½¿ç”¨-å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—"><a href="#2-ä½¿ç”¨-å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—" class="headerlink" title="2. ä½¿ç”¨ + å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—"></a>2. ä½¿ç”¨ <code>+</code> å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—</h4><p>åªé€‚åˆå°†å­—ç¬¦ä¸²æ•°æ®è½¬æ¢ä¸ºæ•°å­—, ç»™åå°ä¼ æ•°æ®çš„æ—¶å€™ç»å¸¸ç”¨åˆ°,<br>å¦‚æœä¸æ˜¯å­—ç¬¦ä¸²æ•°æ®ä¼šè¿”å› NaN.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toNumber = <span class="function"><span class="params">strNumber</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> +strNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log( toNumber(<span class="string">"123"</span>) ); <span class="comment">// 123</span></span><br><span class="line"><span class="built_in">console</span>.log( toNumber(<span class="string">" abc"</span>)); <span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Dateä¹Ÿå¯ä»¥ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">console</span>.log( +<span class="keyword">new</span> <span class="built_in">Date</span>() ); <span class="comment">// è¿”å›æ—¶é—´æˆ³</span></span><br></pre></td></tr></table></figure><blockquote><h4 id="3-å¹¶ç¬¦æ¡ä»¶"><a href="#3-å¹¶ç¬¦æ¡ä»¶" class="headerlink" title="3. å¹¶ç¬¦æ¡ä»¶"></a>3. å¹¶ç¬¦æ¡ä»¶</h4><p>ç»å¸¸ç”¨åˆ°è¿™æ ·çš„æ¡ä»¶åˆ¤æ–­.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isConcat) &#123;</span><br><span class="line">    Login()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç®€å†™æˆè¿™æ · <code>isConact &amp;&amp; Login()</code></p><h3 id="4-è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ "><a href="#4-è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ " class="headerlink" title="4. è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ "></a>4. è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ </h3><p><code>Array.prototype.slice (begin, end)</code> ç»å¸¸ç”¨è¿™æ ·çš„æ–¹å¼æ¥æˆªå–æ•°ç»„çš„å…ƒç´ ,<br>å¦‚æœä¸è®¾ç½® end çš„å€¼, é‚£ä¹ˆé»˜è®¤ä¼šå°†æ•°ç»„çš„é•¿åº¦ä½œä¸º end å€¼.<br>å¦‚æœå°†è´Ÿæ•°ä½œä¸ºå‚æ•°çš„ begin å€¼, å°±å¯ä»¥è·å–æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ .</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="built_in">console</span>.log( arr.slice(<span class="number">-1</span>) ); <span class="comment">// [5]</span></span><br><span class="line">conosle.log( arr.slice(<span class="number">-2</span>) ); <span class="comment">// [4,5]</span></span><br><span class="line">ä»¥æ­¤ç±»æ¨</span><br></pre></td></tr></table></figure><blockquote><h4 id="5-æˆªæ–­æ•°ç»„"><a href="#5-æˆªæ–­æ•°ç»„" class="headerlink" title="5. æˆªæ–­æ•°ç»„"></a>5. æˆªæ–­æ•°ç»„</h4><p>ç”¨æ¥é”å®šæ•°ç»„çš„é•¿åº¦, åˆ é™¤æ•°ç»„ä¸­çš„ä¸€äº›å…ƒç´ . æ¯”å¦‚æ•°ç»„ä¸€å…±æœ‰10ä¸ªå…ƒç´ ,<br>ä½†æˆ‘åªéœ€è¦å‰5ä¸ªå…ƒç´ , å°±å¯ä»¥é€šè¿‡ <code>array.length = 5</code> æ¥æˆªæ–­æ•°ç»„, å¦‚: </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="built_in">console</span>.log( arr.length); <span class="comment">// 5</span></span><br><span class="line">arr.length = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log( arr.length ); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log( arr ); <span class="comment">// [1,2,3]</span></span><br></pre></td></tr></table></figure><blockquote><h4 id="6-å°†NodeListè½¬æ¢ä¸ºæ•°ç»„"><a href="#6-å°†NodeListè½¬æ¢ä¸ºæ•°ç»„" class="headerlink" title="6. å°†NodeListè½¬æ¢ä¸ºæ•°ç»„"></a>6. å°†NodeListè½¬æ¢ä¸ºæ•°ç»„</h4><p>å¦‚æœé€šè¿‡ <code>doucment.querySelectorAll(&#39;p&#39;)</code> è·å–å…ƒç´ , å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªDOMå…ƒç´ çš„<br>æ•°ç»„ ( NodeList ) å¯¹è±¡, ä½†æ˜¯è¿™ä¸ªæ•°ç»„ä¸å…·æœ‰æ•°ç»„çš„åŠŸèƒ½,<br>æ¯”å¦‚ <code>push() / sort()</code> ç­‰. è¿™å°±éœ€è¦å°†è¿™ä¸ª NodeList è½¬æ¢ä¸ºçœŸæ­£çš„æ•°ç»„.<br>å¯ä»¥ä½¿ç”¨ <code>[].slice.call( NodeList )</code> æ¥å®ç°. å¦‚:</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> els = <span class="built_in">document</span>.querySelectorAll( <span class="string">'p'</span> );</span><br><span class="line">[].slice.call( els );</span><br><span class="line">OR:</span><br><span class="line"><span class="keyword">var</span> arrElement = <span class="built_in">Array</span>.from( els );</span><br><span class="line">ES6:</span><br><span class="line"><span class="keyword">var</span> arr = [...els]</span><br></pre></td></tr></table></figure><blockquote><h4 id="7-æ•°ç»„å…ƒç´ é‡æ’"><a href="#7-æ•°ç»„å…ƒç´ é‡æ’" class="headerlink" title="7. æ•°ç»„å…ƒç´ é‡æ’"></a>7. æ•°ç»„å…ƒç´ é‡æ’</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(list.sort(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="built_in">Math</span>.random() - <span class="number">0.5</span>&#125;))</span><br></pre></td></tr></table></figure></blockquote><p>Created on 2017-6-14 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h4 id=&quot;1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼&quot;&gt;&lt;a href=&quot;#1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼&quot; class=&quot;headerlink&quot; title=&quot;1. ä½¿ç”¨ !! æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼&quot;&gt;&lt;/a&gt;1. ä½¿ç”¨ &lt;code&gt;!!&lt;/code&gt; æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title> JavaScript æ¨¡å—åŒ–</title>
    <link href="https://yoursite.com/2017/10/17/JavaScript-%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    <id>https://yoursite.com/2017/10/17/JavaScript-æ¨¡å—åŒ–/</id>
    <published>2017-10-17T13:49:59.000Z</published>
    <updated>2018-05-13T03:49:29.855Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨å‡½æ•°å’Œé—­åŒ…æ¥æ„é€ æ¨¡å—. æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›æ¥å£å´éšè—çŠ¶æ€ä¸ç°å®çš„å‡½æ•°æˆ–å¯¹è±¡.<br>é€šè¿‡æ¨¡å—å¯ä»¥æ‘’å¼ƒå…¨å±€å˜é‡çš„ä½¿ç”¨, æ¨¡å—æ¨¡å¼çš„ä¸€èˆ¬å½¢å¼æ˜¯: ä¸€ä¸ªå®šä¹‰ç§æœ‰å˜é‡å’Œå‡½æ•°çš„å‡½æ•°;<br>åˆ©ç”¨é—­åŒ…åˆ›å»ºå¯ä»¥è®¿é—®ç§æœ‰å˜é‡å’Œå‡½æ•°çš„ç‰¹æƒå‡½æ•°.<br>â€”â€” &lt;&lt; JavaScriptè¯­è¨€ç²¾ç²¹ &gt;&gt;</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serial_maker = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// ç§æœ‰å˜é‡</span></span><br><span class="line"><span class="keyword">let</span> prefix = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="comment">// ç‰¹æƒæ–¹æ³•</span></span><br><span class="line">set_prefix: <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">prefix = <span class="built_in">String</span>(str);</span><br><span class="line">&#125;,</span><br><span class="line">set_num: <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">num = +n;</span><br><span class="line">&#125;,</span><br><span class="line">get_sum: <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> result = prefix + num;</span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> seqer = serial_maker();</span><br><span class="line">seqer.set_prefix(<span class="string">'Hi'</span>);</span><br><span class="line">seqer.set_num(<span class="number">0101</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(seqer.get_sum()) <span class="comment">// 'Hi0101'</span></span><br></pre></td></tr></table></figure><h3 id="CommonJs-ä¸-AMD"><a href="#CommonJs-ä¸-AMD" class="headerlink" title="CommonJs ä¸ AMD"></a>CommonJs ä¸ AMD</h3><p>å› ä¸ºæœ‰äº†æ¨¡å—çš„æ¦‚å¿µ, æ‰€ä»¥æˆ‘ä»¬èƒ½å°†å¾ˆå¤šé‡å¤æ€§çš„ä»£ç å°è£…æˆä¸€ä¸ªæ¨¡å—, æƒ³ç”¨ä»€ä¹ˆ<br>åŠŸèƒ½å°±åŠ è½½ä»€ä¹ˆæ¨¡å—, ä¹Ÿèƒ½æ›´æ–¹ä¾¿æ˜¯ä½¿ç”¨åˆ«äººçš„ä»£ç . ä½†æ˜¯è¿™æ ·å°±ä¼šè¦æ±‚å¤§å®¶éƒ½ç”¨<br>åŒæ ·çš„æ–¹å¼å°è£…æ¨¡å—, æ‰€ä»¥å°±æœ‰äº† CommonJs å’Œ AMD æ¥è§„èŒƒå¤§å®¶çš„å†™æ³•.</p><ul><li>CommonJs<br>Node.jsçš„æ¨¡å—å°±æ˜¯å‚ç…§ CommonJs æ¥å®ç°çš„, åœ¨æœåŠ¡å™¨ç«¯æ˜¯ä¸€å®šä¼šç”¨åˆ°æ¨¡å—çš„. CommonJs<br>æ˜¯åŒæ­¥åŠ è½½, ä¹Ÿå°±æ˜¯è¯´å½“å¼•å…¥ä¸€ä¸ªæ¨¡å—å¿…é¡»ç­‰å¾…è¯¥æ¨¡å—åŠ è½½å®Œæˆä¹‹å, æ‰ä¼šæ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç .<br>å¯¹äºæœåŠ¡å™¨æ¥è¯´æ‰€æœ‰çš„æ¨¡å—éƒ½æ”¾åœ¨æœ¬åœ°, æ‰€ä»¥ç­‰å¾…çš„æ—¶é—´å¾ˆçŸ­; ä½†å¯¹äºæµè§ˆå™¨æ¥è¯´, æ‰€æœ‰çš„æ¨¡å—<br>éƒ½æ”¾åœ¨æœåŠ¡å™¨, æ‰€ä»¥ç­‰å¾…çš„æ—¶é—´å®Œå…¨å–å†³äºç½‘é€Ÿ, å°±å¾ˆå®¹æ˜“å‡ºç°å‡æ­»çš„çŠ¶æ€.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br><span class="line"></span><br><span class="line">math.add(<span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><ul><li>AMD<br>AMDæ˜¯â€Asynchronous Module Definitionâ€çš„ç¼©å†™, æ„æ€å°±æ˜¯â€å¼‚æ­¥æ¨¡å—å®šä¹‰â€. å®ƒå°±æ˜¯é‡‡ç”¨å¼‚æ­¥<br>åŠ è½½, å› æ­¤æ¨¡å—çš„åŠ è½½å¹¶ä¸å½±å“åé¢çš„è¯­å¥æ‰§è¡Œ. å°†æ‰€æœ‰ä¾èµ–äºè¿™ä¸ªæ¨¡å—çš„è¯­å¥éƒ½æ”¾åœ¨ä¸€ä¸ªå®šä¹‰çš„å›è°ƒ<br>å‡½æ•°ä¸­æ‰§è¡Œ, è¿™æ ·ç­‰å¾…æ¨¡å—åŠ è½½å®Œæˆä¹‹åå°±ä¼šå»æ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•°.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="built_in">module</span>], callback);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'module'</span>], <span class="built_in">module</span> =&gt; &#123;</span><br><span class="line"><span class="built_in">module</span>.increment(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="export-export-default"><a href="#export-export-default" class="headerlink" title="export / export default"></a>export / export default</h3><p>åœ¨JavaScript ES6ä¸­ï¼Œexportä¸export defaultå‡å¯ç”¨äºå¯¼å‡ºå¸¸é‡/å‡½æ•°/æ–‡ä»¶/æ¨¡å—ç­‰,<br>ä»¥ä¾¿åœ¨å…¶å®ƒæ–‡ä»¶æˆ–æ¨¡å—ä¸­é€šè¿‡importå°†å…¶å¯¼å…¥ä½¿ç”¨.</p><ul><li>export<br>export å¯ä»¥å¯¼å‡ºå¤šä¸ª</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> foo = <span class="string">'foo'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fn = <span class="function"><span class="params">n</span> =&gt;</span> n+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ index.html å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo, fn&#125; <span class="keyword">from</span> <span class="string">'types.js'</span></span><br></pre></td></tr></table></figure><ul><li>export default<br>åªèƒ½å¯¼å‡ºä¸€ä¸ª</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">const</span> foo = <span class="string">'foo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ index.html å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">'types.js'</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> foo&#125; <span class="keyword">from</span> <span class="string">'types.js'</span></span><br></pre></td></tr></table></figure><p>Created on 2017-9-15 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½¿ç”¨å‡½æ•°å’Œé—­åŒ…æ¥æ„é€ æ¨¡å—. æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›æ¥å£å´éšè—çŠ¶æ€ä¸ç°å®çš„å‡½æ•°æˆ–å¯¹è±¡.&lt;br&gt;é€šè¿‡æ¨¡å—å¯ä»¥æ‘’å¼ƒå…¨å±€å˜é‡çš„ä½¿ç”¨, æ¨¡å—æ¨¡å¼çš„ä¸€èˆ¬å½¢å¼æ˜¯: ä¸€ä¸ªå®šä¹‰ç§æœ‰å˜é‡å’Œå‡½æ•°çš„å‡½æ•°;&lt;br&gt;åˆ©ç”¨é—­åŒ…åˆ›å»ºå¯ä»¥è®¿é—®ç§æœ‰å˜é‡å’Œå‡½æ•°çš„ç‰¹æƒå‡½æ•°.&lt;br&gt;â€”â€” &amp;lt;&amp;lt; JavaScri
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Quick Sort</title>
    <link href="https://yoursite.com/2017/10/17/Quick-Sort/"/>
    <id>https://yoursite.com/2017/10/17/Quick-Sort/</id>
    <published>2017-10-17T13:42:33.000Z</published>
    <updated>2018-05-13T03:49:29.856Z</updated>
    
    <content type="html"><![CDATA[<p>å¿«é€Ÿæ’åºçš„å®ç°, å‚è€ƒèµ„æ–™<a href="http://www.ruanyifeng.com/blog/2011/04/quicksort_in_javascript.html" target="_blank" rel="noopener">é˜®ä¸€å³°</a></p><blockquote><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å¿«æ’æ³•çš„æ€æƒ³ï¼Œ åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥</p><ol><li>åœ¨æ•°æ®é›†ä¸­ï¼Œ é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°æ®ä½œä¸ºå‚ç…§ç‰©ï¼ˆä¸€èˆ¬å–ä¸­é—´ä½ç½®çš„å…ƒç´ ï¼‰ã€‚</li><li>æ‰€æœ‰å°äºå‚ç…§ç‰©çš„å…ƒç´ éƒ½æ”¾åœ¨å·¦è¾¹ï¼Œå¤§äºå‚ç…§ç‰©çš„å…ƒç´ éƒ½æ”¾åœ¨å³è¾¹ã€‚</li><li>å¯¹å·¦å³ä¸¤è¾¹çš„å­é›†é€’å½’ï¼Œ è‡³åˆ°æ’åºå®Œæˆã€‚</li></ol></blockquote><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><ul><li><p>éåŸåœ°å¿«é€Ÿæ’åº</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">11</span>, <span class="number">65</span>, <span class="number">23</span>, <span class="number">108</span>, <span class="number">99</span>, <span class="number">11</span>, <span class="number">55</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">100</span>, <span class="number">108</span>, <span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'å¿«æ’'</span>);</span><br><span class="line"><span class="keyword">const</span> quickSort = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ•°ç»„åªå‰©ä¸€ä¸ªå…ƒç´ æ—¶åœæ­¢</span></span><br><span class="line">    <span class="keyword">if</span> (array.length &lt;= <span class="number">1</span>) <span class="keyword">return</span> array;</span><br><span class="line">    <span class="comment">// å–å‚ç…§ç‰©</span></span><br><span class="line">    <span class="keyword">let</span> pivotIndex = <span class="built_in">Math</span>.floor(array.length / <span class="number">2</span>),</span><br><span class="line">        <span class="comment">// è¿™é‡Œç”¨spliceåˆ é™¤å‚ç…§ç‰©é¿å…é‡å¤å¾ªç¯</span></span><br><span class="line">        pivot = array.splice(pivotIndex, <span class="number">1</span>),</span><br><span class="line">        leftArr = [],</span><br><span class="line">        rightArr = [];</span><br><span class="line">    <span class="comment">// åˆ†åŒº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array[i] &lt; pivot) &#123;</span><br><span class="line">            leftArr.push(array[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            rightArr.push(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> quickSort(leftArr).concat(pivot, quickSort(rightArr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(quickSort(array)); <span class="comment">// [ 11, 11, 11, 23, 33, 55, 65, 99, 100, 100, 108, 108 ]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'å¿«æ’'</span>); <span class="comment">// 4ms å·¦å³</span></span><br></pre></td></tr></table></figure></li><li><p>åŸåœ°å¿«é€Ÿæ’åº</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">'å¿«æ’2'</span>);</span><br><span class="line"><span class="comment">// äº’æ¢</span></span><br><span class="line"><span class="keyword">const</span> swap = <span class="function">(<span class="params">items, firstIndex, secondIndex</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temp = items[firstIndex];</span><br><span class="line">    items[firstIndex] = items[secondIndex];</span><br><span class="line">    items[secondIndex] = temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ†åŒº</span></span><br><span class="line"><span class="keyword">const</span> partition = <span class="function">(<span class="params">items, left, right</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pivot = items[<span class="built_in">Math</span>.floor((right + left) / <span class="number">2</span>)],</span><br><span class="line">        i = left,</span><br><span class="line">        j = right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="keyword">while</span> (items[i] &lt; pivot) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (items[j] &gt; pivot) &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt;= j) &#123;   </span><br><span class="line">            swap(items, i, j);</span><br><span class="line">            i++;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ’åº</span></span><br><span class="line"><span class="keyword">const</span> quickSortTwo = <span class="function">(<span class="params">items, left, right</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> index;</span><br><span class="line">    <span class="keyword">if</span> (items.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        left = <span class="keyword">typeof</span> left != <span class="string">"number"</span> ? <span class="number">0</span> : left;</span><br><span class="line">        right = <span class="keyword">typeof</span> right != <span class="string">"number"</span> ? items.length - <span class="number">1</span> : right;</span><br><span class="line"></span><br><span class="line">        index = partition(items, left, right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (left &lt; index - <span class="number">1</span>) &#123;</span><br><span class="line">            quickSortTwo(items, left, index - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index &lt; right) &#123;</span><br><span class="line">            quickSortTwo(items, index, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(quickSortTwo(array));</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'å¿«æ’2'</span>);</span><br></pre></td></tr></table></figure></li><li><p>åŸç”Ÿsort</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">'åŸç”Ÿ'</span>);</span><br><span class="line">array.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (a &gt; b) <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (a &lt; b) <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(array);</span><br><span class="line"><span class="comment">// 5ms å·¦å³</span></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'åŸç”Ÿ'</span>)</span><br></pre></td></tr></table></figure></li></ul><p>ä¸‰ç§æ–¹æ³•ï¼Œ å½“æ•°ç»„è¾¾åˆ°1Wæ—¶å·®è·å°±æ¯”è¾ƒå¤§äº†ï¼ŒåŸç”Ÿéœ€è¦17mså·¦å³ï¼ŒåŸåœ°å¿«æ’éœ€è¦13mså·¦å³ï¼Œè€ŒéåŸåœ°å¿«æ’åˆ™éœ€è¦88mså·¦å³ã€‚</p><p>Created on 2017-9-7 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¿«é€Ÿæ’åºçš„å®ç°, å‚è€ƒèµ„æ–™&lt;a href=&quot;http://www.ruanyifeng.com/blog/2011/04/quicksort_in_javascript.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é˜®ä¸€å³°&lt;/a&gt;&lt;/p&gt;
&lt;bl
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Inheritance ç»§æ‰¿</title>
    <link href="https://yoursite.com/2017/10/16/Inheritance-%E7%BB%A7%E6%89%BF/"/>
    <id>https://yoursite.com/2017/10/16/Inheritance-ç»§æ‰¿/</id>
    <published>2017-10-16T14:37:47.000Z</published>
    <updated>2018-05-13T03:49:29.854Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h1><p>åœ¨é‚£äº›åŸºäºç±»çš„è¯­è¨€, ç»§æ‰¿æ˜¯ä¸€ç§ä»£ç é‡ç”¨çš„å½¢å¼, å¦‚æœä¸€ä¸ªæ–°çš„ç±»ä¸ä¸€ä¸ªå·²å­˜<br>åœ¨çš„ç±»æ‹¥æœ‰å¤§éƒ¨åˆ†ç›¸åŒçš„åŠŸèƒ½, é‚£ä¹ˆå°±åªéœ€è¦è¯´æ˜ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«å³å¯. ä½†æ˜¯<br> JavaScript å¹¶æ²¡æœ‰ç±»çš„æ¦‚å¿µ, ä½†æ˜¯æœ‰å¾ˆå¤šä»£ç é‡ç”¨çš„æ¨¡å¼, å®ƒå¯ä»¥æ¨¡æ‹Ÿç±»çš„<br>æ¨¡å¼, ä¹Ÿå¯ä»¥æ”¯æŒå…¶ä»–çš„æ¨¡å¼.</p></blockquote><h3 id="ä¼ªç±»"><a href="#ä¼ªç±»" class="headerlink" title="ä¼ªç±»"></a>ä¼ªç±»</h3><p>åœ¨ C++ å’Œ Javaä¸­éƒ½æ˜¯ç”¨ new å‘½ä»¤æ¥ç”Ÿæˆç¤ºå®ä¾‹, åœ¨ä½¿ç”¨ new å‘½ä»¤æ—¶éƒ½ä¼šè°ƒç”¨ç±»çš„<br>æ„é€ å‡½æ•°(constructor), å› æ­¤ Brendan Eich ( JavaScript ä½œè€…)å°† new å¼•å…¥äº† JavaScript,<br>ä»åŸå‹å¯¹è±¡ä¸Šç”Ÿæˆä¸€ä¸ªå®ä¾‹å¯¹è±¡. å› ä¸º js æ²¡æœ‰ç±», æ‰€ä»¥åœ¨ new å‘½ä»¤åé¢è·Ÿçš„æ˜¯æ„é€ å‡½æ•°,<br>è€Œä¸æ˜¯åƒ Java ä¸€æ ·è·Ÿçš„æ˜¯ç±». ç®€å•çš„æ¥è¯´å°±æ˜¯é€šè¿‡æ„é€ å™¨ç”Ÿäº§å¯¹è±¡.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆæ‰©å±•ä¸€ä¸ªæ–¹æ³•, æ‡’å¾—æ¯æ¬¡æ‰“prototype</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªä¸æ˜¯å¿…é¡»çš„</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.method = <span class="function"><span class="keyword">function</span> (<span class="params">name, fn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.prototype[name] = fn;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­è¨€ç²¾ç²¹é‡Œçš„ä¾‹å­ (å…¶å®è¿™ä¸€æ­¥å°±æ˜¯åœ¨æ¨¡ä»¿ new çš„å®ç°)</span></span><br><span class="line"><span class="built_in">Function</span>.method(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡, å®ƒç»§æ‰¿æ„é€ å™¨å‡½æ•°çš„åŸå‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> that = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨æ„é€ å™¨å‡½æ•°, å°† this ç»‘å®šåˆ°æ–°å¯¹è±¡ä¸Š</span></span><br><span class="line"><span class="keyword">let</span> other = <span class="keyword">this</span>.apply(that, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">typeof</span> other === <span class="string">'object'</span> &amp;&amp; other) || that</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å®šä¹‰ä¸€ä¸ªæ„é€ å™¨</span></span><br><span class="line"><span class="keyword">let</span> Bar = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±•è¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹</span></span><br><span class="line">Bar.prototype.get_name = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line">Bar.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.saying || <span class="string">''</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// ç„¶åæ„é€ ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="keyword">let</span> myBar = <span class="keyword">new</span> Bar(<span class="string">'å¦²å·±'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myBar.get_name()) <span class="comment">// å¦²å·±</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  æ©ç›–æ‰ä¸‘é™‹çš„ prototype</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å€ŸåŠ©ä¸€ä¸ªè¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="built_in">Function</span>.method(<span class="string">'inherit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">parent</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.prototype = <span class="keyword">new</span> parent();</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ–°å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">// å»ç»§æ‰¿ä¸Šé¢çš„ Bar</span></span><br><span class="line"><span class="keyword">let</span> Foo = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.saying = <span class="string">'wow'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œ inherit å’Œ method éƒ½ç›´æ¥è¿”å› this</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥å¯ä»¥é‡‡ç”¨è”çº§</span></span><br><span class="line">.inherit(Bar)</span><br><span class="line">.method(<span class="string">'noise'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="keyword">this</span>.say()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¼ªç±»æ¨¡å¼åœ¨é€šè¿‡new å‘½ä»¤ç”Ÿäº§å¯¹è±¡æ—¶, ä¼šäº§ç”Ÿå†…å­˜æµªè´¹. å¦‚ä¸Šé¢çš„ä¾‹å­, Foo æ„é€ å‡½æ•°<br>å°±å›å»é‡å¤æ„é€ å™¨ Bar å·²ç»å®Œæˆçš„å·¥ä½œ.</p><h3 id="åŸå‹"><a href="#åŸå‹" class="headerlink" title="åŸå‹"></a>åŸå‹</h3><p>åœ¨ä¸€ä¸ªçº¯ç²¹çš„åŸå‹æ¨¡å¼ä¸­, å°†æ‘’å¼ƒç±»ä¸“æ³¨äºå¯¹è±¡. åŸºäºåŸå‹çš„ç»§æ‰¿ç›¸æ¯”äºç±»çš„<br>ç»§æ‰¿åœ¨æ¦‚å¿µä¸Šæ›´ä¸ºç®€å•: ä¸€ä¸ªæ–°å¯¹è±¡å¯ä»¥ç»§æ‰¿ä¸€ä¸ªæ—§å¯¹è±¡çš„å±æ€§. é€šè¿‡æ„é€ ä¸€ä¸ªæœ‰ç”¨<br>çš„å¯¹è±¡å¼€å§‹, æ¥ç€å¯ä»¥æ„é€ å‡ºæ›´å¤šå’Œè¿™ä¸ªå¯¹è±¡ç›¸ä¼¼çš„å¯¹è±¡.   â€”-&lt;JavaScriptè¯­è¨€ç²¾ç²¹&gt; </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆæ„é€ ä¸€ä¸ªåŸºç¡€å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> baseObject = &#123;</span><br><span class="line">name: <span class="string">'base'</span>,</span><br><span class="line">get_name: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥æ„é€ å®šåˆ¶åŒ–çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> myObj = <span class="built_in">Object</span>.create(baseObject);</span><br><span class="line">myObj.name = <span class="string">'wow'</span>;</span><br><span class="line">myObj.saying = <span class="string">'Hi'</span>;</span><br><span class="line">myObj.purr = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (str) &#123;</span><br><span class="line">str += <span class="string">'hello'</span></span><br><span class="line">&#125;</span><br><span class="line">str += <span class="string">'world'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ç§â€™å·®å¼‚åŒ–ç»§æ‰¿â€™, é€šè¿‡åˆ¶å®šä¸€ä¸ªæ–°çš„å¯¹è±¡, æŒ‡æ˜å®ƒä¸åŸºæœ¬å¯¹è±¡çš„ä¸åŒ.</p><h3 id="å‡½æ•°åŒ–"><a href="#å‡½æ•°åŒ–" class="headerlink" title="å‡½æ•°åŒ–"></a>å‡½æ•°åŒ–</h3><p>ä»¥ä¸Šä¸¤ç§ç»§æ‰¿æ¨¡å¼éƒ½æ²¡æœ‰å®ç°ç§æœ‰åŒ–, ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯å…¬å¼€çš„, æ‰€ä»¥å°±<br>å¯ä»¥å¼€å§‹è¿ç”¨æ¨¡å—æ¨¡å¼. è¿™ä¸ªå‡½æ•°ä¸»è¦åˆ†ä¸ºå››ä¸ªæ­¥éª¤:</p><ol><li><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</p></li><li><p>å®šä¹‰ç§æœ‰å±æ€§.</p></li><li><p>ç»™è¿™ä¸ªæ–°å¯¹è±¡æ‰©å……ç‰¹æƒå‡½æ•° (æš´éœ²æ¥å£)</p></li><li><p>è¿”å›è¿™ä¸ªå¯¹è±¡</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// spec å¯¹è±¡åŒ…å«æ„é€ å™¨æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line"><span class="comment">// my å¯¹è±¡å…è®¸å…¶ä»–æ„é€ å™¨åˆ†äº«ä»–ä»¬çš„ç§æœ‰å±æ€§</span></span><br><span class="line"><span class="comment">// ä»¥ä¾¿åœ¨æˆ‘ä»¬çš„æ„é€ å™¨ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">constructor</span> = (spec, my) =&gt; &#123;</span><br><span class="line"><span class="keyword">let</span> that = &#123;&#125;; <span class="comment">// ç§æœ‰å®ä¾‹å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> my = my || &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±•å…±äº«çš„å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">that = ä¸€ä¸ªæ–°å¯¹è±¡</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™ that æ·»åŠ ç‰¹æƒæ–¹æ³• </span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> that</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¯­è¨€ç²¾ç²¹é‡Œçš„ä¾‹å­</p></blockquote><ol><li><p>æ„é€ å™¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mammal = <span class="function"><span class="params">spec</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> that = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">that.get_name = <span class="function"><span class="params">_</span> =&gt;</span> spec.name;</span><br><span class="line">that.says = <span class="function"><span class="params">_</span> =&gt;</span> spec.saying || <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> that</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myMammal = mammal(&#123;<span class="attr">name</span>: <span class="string">'Herb'</span>&#125;);</span><br></pre></td></tr></table></figure></li><li><p>å¦ä¸€ä¸ªæ„é€ å™¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cat = <span class="function"><span class="params">spec</span> =&gt;</span>&#123;</span><br><span class="line">spec.saying = spec.saying || <span class="string">'meow'</span>;</span><br><span class="line"><span class="comment">// ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">let</span> that = mammal(spec);</span><br><span class="line"></span><br><span class="line">that.purr = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> i, s = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (s) &#123;</span><br><span class="line">s += <span class="string">'-'</span>;</span><br><span class="line">&#125;</span><br><span class="line">s += <span class="string">'r'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;;</span><br><span class="line">that.get_name = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> that.says() + <span class="string">' '</span> + spec.name + <span class="string">' '</span> + that.says();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> that</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myCat = car(&#123;<span class="attr">name</span>: <span class="string">'Henrietta'</span>&#125;);</span><br></pre></td></tr></table></figure></li></ol><h3 id="è¶…ç±»"><a href="#è¶…ç±»" class="headerlink" title="è¶…ç±»"></a>è¶…ç±»</h3><p>ä»¥ä¸Šå‡½æ•°åŒ–çš„æ–¹å¼è¿˜ä¸èƒ½å¤Ÿè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•å¹¶å‘çˆ¶ç±»æ–¹æ³•ä¼ é€’å‚æ•°. ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç <br>åœ¨<code>è¯­è¨€ç²¾ç²¹</code>çš„ä¾‹å­çš„åŸºç¡€ä¸Šç¨ä½œæ”¹åŠ¨, ä¾¿äºè‡ªå·±ç†è§£:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">const</span> mammal = <span class="function"><span class="params">spec</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> that = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">that.get_name = <span class="function"><span class="params">_</span> =&gt;</span> spec.name;</span><br><span class="line">that.says = <span class="function"><span class="params">_</span> =&gt;</span> spec.saying || <span class="string">'Hi'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> that</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myMammal = mammal(&#123;<span class="attr">name</span>: <span class="string">'Cara'</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myMammal.says()) <span class="comment">// 'Hi'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å™¨2</span></span><br><span class="line"><span class="keyword">const</span> cat = <span class="function"><span class="params">spec</span> =&gt;</span> &#123;</span><br><span class="line">spec.saying = spec.saying || <span class="string">'meow'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶ that å·²ç»åŒ…å«: get_name å’Œ says æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> that = mammal(spec);</span><br><span class="line"></span><br><span class="line">that.purr = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (str) &#123;</span><br><span class="line">str += <span class="string">'-'</span>;</span><br><span class="line">&#125;</span><br><span class="line">str += <span class="string">'r'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> str</span><br><span class="line">&#125;;</span><br><span class="line">that.get_name = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n || <span class="string">"i dont't have name"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> that</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myCat = cat(&#123;<span class="attr">name</span>: <span class="string">'Henrietta'</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// i dont't have name</span></span><br><span class="line"><span class="built_in">console</span>.log(myCat.get_name())</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ—¶å€™ cat è¿˜ä¸èƒ½è®¿é—®çˆ¶ç±»æ–¹æ³•çš„èƒ½åŠ›</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥è¶…ç±» super è¿˜æ˜¯æœ‰å¿…è¦çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆæ‰©å±•ä¸¤ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•ä¸èƒ½ç”¨ç®­å¤´å‡½æ•°æ¥å®šä¹‰, å¦åˆ™ this æŒ‡å‘çš„window</span></span><br><span class="line"><span class="comment">// è¿™é‡Œ this éœ€è¦çš„æ˜¯è¢«è°ƒç”¨çš„å¯¹è±¡</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.method =  <span class="function"><span class="keyword">function</span> (<span class="params">name, fn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.prototype[name] = fn;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°</span></span><br><span class="line"><span class="built_in">Object</span>.method(<span class="string">'superior'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> that = <span class="keyword">this</span>,</span><br><span class="line">        method = that[name];</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// this cat function</span></span><br><span class="line">    <span class="built_in">console</span>.log(n)</span><br><span class="line">        <span class="keyword">return</span> method.call(that, n);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥è¯•è¯•è°ƒç”¨çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">const</span> coolCat = <span class="function"><span class="params">spec</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> that = cat(spec);</span><br><span class="line"><span class="keyword">let</span>super_get_name = that.superior(<span class="string">'get_name'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// n ç»™çˆ¶ç±»æ–¹æ³•ä¼ å‚</span></span><br><span class="line">that.get_name = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'like '</span> + super_get_name.call(<span class="keyword">this</span>, n) + <span class="string">' baby'</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> that</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myCoolCat = coolCat(&#123;<span class="attr">name</span>: <span class="string">'Bix'</span>, <span class="attr">saying</span>: <span class="string">'Hi'</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = myCoolCat.get_name(<span class="string">'this cat function'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name) <span class="comment">// like this cat function baby</span></span><br></pre></td></tr></table></figure><h4 id="æœ€åéšä¾¿æä¸€ä¸‹"><a href="#æœ€åéšä¾¿æä¸€ä¸‹" class="headerlink" title="æœ€åéšä¾¿æä¸€ä¸‹"></a>æœ€åéšä¾¿æä¸€ä¸‹</h4><p>ç®­å¤´å‡½æ•°çš„å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹:</p><ol><li><p>å‡½æ•°ä½“å†…çš„ <code>this</code> å¯¹è±¡, å°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡, è€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡.</p></li><li><p>ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°, ä¹Ÿå°±æ˜¯è¯´, ä¸å¯ä»¥ä½¿ç”¨newå‘½ä»¤, å¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯.<br>å› ä¸ºç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ <code>this</code>, è€Œæ˜¯ç»§æ‰¿å¤–å±‚å‡½æ•°çš„<code>this</code>.</p></li><li><p>ä¸å¯ä»¥ä½¿ç”¨ <code>arguments</code> å¯¹è±¡, è¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨.</p></li><li><p>ä¸å¯ä»¥ä½¿ç”¨ <code>yield</code> å‘½ä»¤, å› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œGeneratorå‡½æ•°.</p></li></ol><p>Ceated on 2017-9-15 by Cara </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h1 id=&quot;ç»§æ‰¿&quot;&gt;&lt;a href=&quot;#ç»§æ‰¿&quot; class=&quot;headerlink&quot; title=&quot;ç»§æ‰¿&quot;&gt;&lt;/a&gt;ç»§æ‰¿&lt;/h1&gt;&lt;p&gt;åœ¨é‚£äº›åŸºäºç±»çš„è¯­è¨€, ç»§æ‰¿æ˜¯ä¸€ç§ä»£ç é‡ç”¨çš„å½¢å¼, å¦‚æœä¸€ä¸ªæ–°çš„ç±»ä¸ä¸€ä¸ªå·²å­˜&lt;br&gt;åœ¨çš„ç±»æ‹¥æœ‰å¤§éƒ¨åˆ†ç›¸åŒçš„åŠŸèƒ½, é‚£
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript æ–¹æ³•é›†</title>
    <link href="https://yoursite.com/2017/10/16/JavaScript-%E6%96%B9%E6%B3%95%E9%9B%86/"/>
    <id>https://yoursite.com/2017/10/16/JavaScript-æ–¹æ³•é›†/</id>
    <published>2017-10-16T14:29:16.000Z</published>
    <updated>2018-05-13T03:49:29.855Z</updated>
    
    <content type="html"><![CDATA[<p>JavaScriptåŒ…å«äº†ä¸€å¥—å°å‹çš„å¯ç”¨åœ¨æ ‡å‡†ç±»å‹ä¸Šçš„æ ‡å‡†æ–¹æ³•é›†,<br>ä¸»è¦æ˜¯é’ˆå¯¹æ•°ç»„/æ­£åˆ™åŠå­—ç¬¦ä¸²çš„ä¸€äº›å¤„ç†.</p><blockquote><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2></blockquote><h3 id="array-concat-itemâ€¦"><a href="#array-concat-itemâ€¦" class="headerlink" title="array.concat(itemâ€¦)"></a>array.concat(itemâ€¦)</h3><p>concat æ–¹æ³•äº§ç”Ÿä¸€ä¸ªæ–°çš„æ•°ç»„, å®ƒåŒ…å«çš„æ˜¯ä¸€ä»½ array çš„æµ…å¤åˆ¶<br>å¹¶æŠŠå‚æ•° item è¿½åŠ åœ¨å…¶å. å¦‚æœ item æ˜¯æ•°ç»„, é‚£ä¹ˆè¿™ä¸ªæ•°ç»„çš„<br>æ¯ä¸ªå…ƒç´ éƒ½ä¼šè¢«æ·»åŠ .</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> result = arr.concat(arr2, <span class="string">'wow'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// [1, 2, 3, 4, 5, 6, 'wow'];</span></span><br></pre></td></tr></table></figure><h3 id="array-join-separator"><a href="#array-join-separator" class="headerlink" title="array.join(separator)"></a>array.join(separator)</h3><p>join æ–¹æ³•æ˜¯æŠŠä¸€ä¸ª array ä»¥æŒ‡å®šçš„åˆ†éš”ç¬¦æ„é€ æˆä¸€ä¸ªå­—ç¬¦ä¸².<br>å®ƒå…ˆæŠŠ array ä¸­çš„æ¯ä¸ªå…ƒç´ æ„é€ æˆä¸€ä¸ªå­—ç¬¦ä¸², ç„¶åä»¥æŒ‡å®šçš„<br>åˆ†éš”ç¬¦æŠŠå®ƒä»¬éƒ½è¿æ¥èµ·æ¥. é»˜è®¤çš„ separate æ˜¯é€—å·, å¯ä»¥ç”¨<br>ç©ºå­—ç¬¦ä¸²ä½œä¸º separate.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>];</span><br><span class="line">array.push(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = array(<span class="string">"|"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// "a|b|c|d"</span></span><br></pre></td></tr></table></figure><h3 id="array-pop"><a href="#array-pop" class="headerlink" title="array.pop()"></a>array.pop()</h3><p>pop å’Œ push æ–¹æ³•å¯ä»¥ä½¿ array åƒå †æ ˆä¸€æ ·å·¥ä½œ. pop æ–¹æ³•ç§»é™¤æ•°ç»„<br>ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¯¥å…ƒç´ , å¦‚æœæ˜¯ç©ºæ•°ç»„, å®ƒå°†è¿”å› undefined.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.pop()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="array-push-itemâ€¦"><a href="#array-push-itemâ€¦" class="headerlink" title="array.push(itemâ€¦)"></a>array.push(itemâ€¦)</h3><p>push æ–¹æ³•å‘æ•°ç»„çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ . å’Œ concat æ–¹æ³•ä¸åŒçš„æ˜¯,<br>ä»–ä¼šä¿®æ”¹ array, å¦‚æœ item æ˜¯ä¸€ä¸ªæ•°ç»„, ä¼šå°†æ•´ä¸ªå‚æ•°æ•°ç»„ä½œä¸ºä¸€ä¸ªå…ƒç´ <br>æ·»åŠ åˆ° array çš„æœ«å°¾, å¹¶è¿”å›è¿™ä¸ªæ–°æ•°ç»„çš„é•¿åº¦.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = array.push(arr. <span class="string">'Hi'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result); </span><br><span class="line"><span class="comment">// array: [1, 2, 3, [4, 5, 6], 'Hi']</span></span><br><span class="line"><span class="comment">// result: 5</span></span><br></pre></td></tr></table></figure><h3 id="array-reverse"><a href="#array-reverse" class="headerlink" title="array.reverse()"></a>array.reverse()</h3><p>reverse æ–¹æ³•åè½¬æ•°ç»„å…ƒç´ çš„é¡ºåº, å¹¶è¿”å›æ•°ç»„æœ¬èº«.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = array.reverse();</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// [3, 2, 1]</span></span><br></pre></td></tr></table></figure><h3 id="array-shift"><a href="#array-shift" class="headerlink" title="array.shift()"></a>array.shift()</h3><p>shift æ–¹æ³•ç§»é™¤æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¯¥å…ƒç´ . å¦‚æœæ˜¯ç©ºæ•°ç»„<br>å°†ä¼šè¿”å› undefined. shift é€šå¸¸æ¯” pop æ…¢å¾—å¤š.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> result = array.shift();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h3 id="array-slice-start-end"><a href="#array-slice-start-end" class="headerlink" title="array.slice(start, end)"></a>array.slice(start, end)</h3><p>slice æ–¹æ³•æ˜¯æˆªå– array ä¸­çš„ä¸€æ®µåšæµ…å¤åˆ¶. å¤åˆ¶ array[start] å¼€å§‹<br>åˆ°å¤åˆ¶ array[end]ä¸ºæ­¢. end å‚æ•°æ˜¯å¯é€‰çš„, é»˜è®¤å€¼çš„é•¿åº¦æ˜¯ array.length.<br>å¦‚æœ start çš„å€¼å¤§äºç­‰äº array.length, ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„ç©ºæ•°ç»„.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a  = array.slice(<span class="number">0</span>, <span class="number">1</span>); <span class="comment">// [1]</span></span><br><span class="line"><span class="keyword">let</span> b = array.slice(<span class="number">1</span>); <span class="comment">// [2, 3]</span></span><br><span class="line"><span class="keyword">let</span> c = array.slice(<span class="number">-1</span>); <span class="comment">// [3]</span></span><br></pre></td></tr></table></figure><h3 id="array-sort-comparefn"><a href="#array-sort-comparefn" class="headerlink" title="array.sort(comparefn)"></a>array.sort(comparefn)</h3><p>sort æ–¹æ³•æ˜¯å¯¹æ•°ç»„ä¸­çš„å…ƒç´ æ’åºï¼Œä½†ä»–çš„é»˜è®¤æ¯”è¾ƒå‡½æ•°æ˜¯æŠŠè¢«æ’åºçš„å…ƒç´ éƒ½è§†ä¸º<br>å­—ç¬¦ä¸²ã€‚ æ‰€ä»¥é€šå¸¸éƒ½æ˜¯è‡ªå·±å®šä¹‰æ¯”è¾ƒå‡½æ•°.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹å­—ç¬¦ä¸²å’Œæ•°å­—æ’åº</span></span><br><span class="line"><span class="keyword">const</span> compare = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (a === b) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="keyword">typeof</span> b) &#123;</span><br><span class="line"><span class="keyword">return</span>  a &lt; b ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> a &lt; <span class="keyword">typeof</span> b ? <span class="number">-1</span> :<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = [<span class="string">'bb'</span>, <span class="string">'aa'</span>, <span class="number">2</span>, <span class="string">'cc'</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(array.sort(compare())); <span class="comment">// [ 1, 2, 3, 7, 'aa', 'bb', 'cc' ]</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¨³å®šæ€§ï¼šæ’åºå2ä¸ªç›¸ç­‰é”®å€¼çš„é¡ºåºå’Œæ’åºä¹‹å‰å®ƒä»¬çš„é¡ºåºç›¸åŒ.</p></blockquote><ul><li>ä¸ç¨³å®šæ’åº</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> by = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// o/p æ¯ç»„ç›¸æ¯”è¾ƒçš„æ•°æ®</span></span><br><span class="line"><span class="keyword">return</span> <span class="function">(<span class="params">o, p</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> a, b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(o &amp;&amp; p &amp;&amp; <span class="keyword">typeof</span> o === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> p === <span class="string">'object'</span>) &#123;</span><br><span class="line">a = o[name];</span><br><span class="line">b = p[name];</span><br><span class="line"><span class="comment">// å…¨ç­‰æ—¶</span></span><br><span class="line"><span class="keyword">if</span> (a === b) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŒç±»å‹</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="keyword">typeof</span> b) &#123;</span><br><span class="line"><span class="keyword">return</span> a &lt; b ? <span class="number">-1</span> : <span class="number">1</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸åŒç±»å‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> a &lt; <span class="keyword">typeof</span> b ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ’åºå¤±è´¥'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s = [</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Joe'</span>, <span class="attr">last</span>: <span class="string">'DeRita'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Moe'</span>, <span class="attr">last</span>: <span class="string">'Howard'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Joe'</span>, <span class="attr">last</span>: <span class="string">'Besser'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Shemp'</span>, <span class="attr">last</span>: <span class="string">'Howard'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Larry'</span>, <span class="attr">last</span>: <span class="string">'Fine'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Curly'</span>, <span class="attr">last</span>: <span class="string">'Howard'</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(s.sort(by(<span class="string">'first'</span>)).sort(<span class="string">'last'</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[ </span></span><br><span class="line"><span class="comment">&#123; first: 'Curly', last: 'Howard' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Joe', last: 'DeRita' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Joe', last: 'Besser' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Larry', last: 'Fine' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Moe', last: 'Howard' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Shemp', last: 'Howard' &#125;  </span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><ul><li>ç¨³å®šæ’åº</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®©å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°, å½“ç¬¬ä¸€ä¸ªå‡½æ•°ç›¸ç­‰æ—¶</span></span><br><span class="line"><span class="comment">// ç”±ç¬¬äºŒä¸ªå‚æ•°å†æ¬¡æ¯”è¾ƒ, ç¬¬äºŒä¸ªæ¬¡è¦æ¯”è¾ƒå‡½æ•°å¯é€‰</span></span><br><span class="line"><span class="keyword">const</span> betterBy = <span class="function">(<span class="params">name, minor</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function">(<span class="params">o, p</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> a, b;</span><br><span class="line"><span class="keyword">if</span> (o &amp;&amp; p &amp;&amp; <span class="keyword">typeof</span> o === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="string">'object'</span>) &#123;</span><br><span class="line">a = o[name];</span><br><span class="line">b = p[name];</span><br><span class="line"><span class="keyword">if</span> (a === b) &#123;</span><br><span class="line"><span class="comment">// ç”¨æ¬¡è¦æ¯”è¾ƒå‡½æ•°å†æ¬¡å¯¹æ¯”</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> minor === <span class="string">'function'</span> ? minor(o, p) : <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="keyword">typeof</span> b) &#123;</span><br><span class="line"><span class="keyword">return</span> a &lt; b ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> a &lt; <span class="keyword">typeof</span> b ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ’åºå¤±è´¥'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Joe'</span>, <span class="attr">last</span>: <span class="string">'DeRita'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Moe'</span>, <span class="attr">last</span>: <span class="string">'Howard'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Joe'</span>, <span class="attr">last</span>: <span class="string">'Besser'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Shemp'</span>, <span class="attr">last</span>: <span class="string">'Howard'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Larry'</span>, <span class="attr">last</span>: <span class="string">'Fine'</span>&#125;,</span><br><span class="line">&#123;<span class="attr">first</span>: <span class="string">'Curly'</span>, <span class="attr">last</span>: <span class="string">'Howard'</span>&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.sort(by(<span class="string">'last'</span>,by(<span class="string">'first'</span>))));</span><br><span class="line"><span class="comment">/*[ </span></span><br><span class="line"><span class="comment">&#123; first: 'Joe', last: 'Besser' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Joe', last: 'DeRita' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Larry', last: 'Fine' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Moe', last: 'Howard' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Shemp', last: 'Howard' &#125;,</span></span><br><span class="line"><span class="comment">&#123; first: 'Curly', last: 'Howard' &#125; </span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="array-splice-start-deleteCount-itemâ€¦"><a href="#array-splice-start-deleteCount-itemâ€¦" class="headerlink" title="array.splice(start, deleteCount, itemâ€¦)"></a>array.splice(start, deleteCount, itemâ€¦)</h3><p>splice æ–¹æ³•ä» array ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ , å¹¶ç”¨æ–°çš„ item æ›¿æ¢ä»–ä»¬.<br>start æ˜¯ä» array ä¸­ç§»é™¤å…ƒç´ çš„å¼€å§‹ä½ç½® ( ç´¢å¼• ) , deleteCount æ˜¯è¦<br>åˆ é™¤å…ƒç´ çš„ä¸ªæ•°, item å‚æ•°å¦‚æœæœ‰ä¼šè¢«æ’å…¥åˆ°è¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ä¸Š. è¿”å›<br>è¢«åˆ é™¤çš„å…ƒç´ .</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'bug'</span>];</span><br><span class="line"><span class="keyword">let</span> remove = arr.splice(<span class="number">1</span>, <span class="number">1</span>, <span class="string">'newItem'</span>, <span class="string">'Hi'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// ['b', 'newItem', 'Hi','c', 'bug']</span></span><br><span class="line"><span class="built_in">console</span>.log(remove); <span class="comment">// ['a']</span></span><br></pre></td></tr></table></figure><h3 id="array-unshift-itemâ€¦"><a href="#array-unshift-itemâ€¦" class="headerlink" title="array.unshift(itemâ€¦)"></a>array.unshift(itemâ€¦)</h3><p>unshift æ–¹æ³•å‘æ•°ç»„çš„å¼€å¤´æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ å¹¶è¿”å›æ•°ç»„æ–°çš„é•¿åº¦.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> insert = arr.unshift(<span class="string">'Hi'</span>, <span class="string">'d'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// ['Hi', 'd', 'a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(insert); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><blockquote><h2 id="RegExp"><a href="#RegExp" class="headerlink" title="RegExp"></a>RegExp</h2></blockquote><h3 id="regexp-exec-string"><a href="#regexp-exec-string" class="headerlink" title="regexp.exec(string)"></a>regexp.exec(string)</h3><p>exec æ–¹æ³•æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æœ€å¼ºå¤§(æœ€æ…¢)çš„æ–¹æ³•. å¦‚æœå®ƒæˆåŠŸåŒ¹é…<br>regexp å’Œå­—ç¬¦ä¸² string, å°†è¿”å›ä¸€ä¸ªæ•°ç»„. æ•°ç»„ä¸­ä¸‹æ ‡ä¸º0çš„å…ƒç´ åŒ…å«<br>æ­£åˆ™è¡¨è¾¾å¼ regexp åŒ¹é…çš„å­å­—ç¬¦ä¸²; ä¸‹æ ‡ä¸º1çš„å…ƒç´ æ˜¯åˆ†ç»„1æ•è·çš„æ–‡æœ¬;<br>ä¸‹æ ‡ä¸º2çš„å…ƒç´ æ˜¯åˆ†ç»„2æ•è·çš„æ–‡æœ¬, ä»¥æ­¤ç±»æ¨. å¦‚æœåŒ¹é…å¤±è´¥åˆ™è¿”å›null.</p><h3 id="regexp-test-string"><a href="#regexp-test-string" class="headerlink" title="regexp.test(string)"></a>regexp.test(string)</h3><p>test æ–¹æ³•æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æœ€ç®€å•(æœ€å¿«)çš„æ–¹æ³•. å¦‚æœè¯¥regexp ä¸ string<br>åŒ¹é…, å®ƒè¿”å› true, å¦åˆ™è¿”å› false. ä¸è¦å¯¹è¿™ä¸ªæ–¹æ³•ä½¿ç”¨ g æ ‡è¯†.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let b = /&amp;.+/.test(&apos;frank &amp;amp; beans&apos;);</span><br><span class="line"></span><br><span class="line">console.log(b); // true</span><br></pre></td></tr></table></figure><blockquote><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2></blockquote><h3 id="string-charAt-pos"><a href="#string-charAt-pos" class="headerlink" title="string.charAt(pos)"></a>string.charAt(pos)</h3><p>charAt æ–¹æ³•è¿”å›åœ¨ string ä¸­ pos ä½ç½®å¤„çš„å­—ç¬¦ä¸². å¦‚æœ pos å°äº0æˆ–è€…<br>å¤§äºç­‰äºå­—ç¬¦ä¸²çš„é•¿åº¦, å°†è¿”å›ç©ºå­—ç¬¦ä¸².</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'Cara'</span>;</span><br><span class="line"><span class="keyword">let</span> initial = name.charAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(initial); <span class="comment">// 'C'</span></span><br></pre></td></tr></table></figure><h3 id="string-concat-stringâ€¦"><a href="#string-concat-stringâ€¦" class="headerlink" title="string.concat(stringâ€¦)"></a>string.concat(stringâ€¦)</h3><p>concat æ–¹æ³•æŠŠå…¶ä»–å­—ç¬¦ä¸²è¿æ¥èµ·æ¥è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸². é€šå¸¸ç”¨<code>+</code></p><h3 id="string-indexOf-searchString-position"><a href="#string-indexOf-searchString-position" class="headerlink" title="string.indexOf(searchString, position)"></a>string.indexOf(searchString, position)</h3><p>indexOf æ–¹æ³•åœ¨ string å†…æŸ¥æ‰¾å¦ä¸€ä¸ªå­—ç¬¦ä¸² searchString. å¦‚æœè¢«<br>æ‰¾åˆ°è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å­—ç¬¦ä¸²çš„ä½ç½®, å¦åˆ™è¿”å›-1. å¯é€‰å‚æ•° position<br>å¯è®¾ç½®ä» string çš„æŸä¸ªæŒ‡å®šä½ç½®å¼€å§‹æŸ¥æ‰¾.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> text = <span class="string">'Mississippi'</span>;</span><br><span class="line"><span class="keyword">let</span> p = text.indexOf(<span class="string">'ss'</span>); <span class="comment">// 2</span></span><br><span class="line">p = text.indexOf(<span class="string">'ss'</span>, <span class="number">3</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><h3 id="string-lastIndexOf-searchString-position"><a href="#string-lastIndexOf-searchString-position" class="headerlink" title="string.lastIndexOf(searchString, position)"></a>string.lastIndexOf(searchString, position)</h3><p>lastIndexOf è·Ÿ indexOf æ–¹æ³•ç›¸å, æ˜¯ä»æ•°ç»„çš„æœ«å°¾å¼€å§‹æŸ¥æ‰¾.<br>è¿”å›ä¸€ä¸ªæŒ‡å®šçš„å­—ç¬¦ä¸²å€¼æœ€åå‡ºç°çš„ä½ç½®, åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šä½ç½®ä»åå‘å‰æœç´¢.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> text = <span class="string">'Mississippi'</span>;</span><br><span class="line"><span class="keyword">let</span> p = text.lastIndexOf(<span class="string">'ss'</span>); <span class="comment">// 5</span></span><br><span class="line">p = text.lastIndexOf(<span class="string">'ss'</span>, <span class="number">3</span>); <span class="comment">// 2</span></span><br><span class="line">p = text.lastIndexOf(<span class="string">'ss'</span>, <span class="number">6</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><h3 id="string-match-regexp"><a href="#string-match-regexp" class="headerlink" title="string.match(regexp)"></a>string.match(regexp)</h3><p>match æ–¹æ³•è®©å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…. å®ƒä¾æ®<code>g</code>æ ‡è¯†ç¬¦æ¥å†³å®šå¦‚ä½•<br>è¿›è¡ŒåŒ¹é…. å¦‚æœæ²¡æœ‰<code>g</code>æ ‡è¯†ç¬¦, é‚£ä¹ˆè°ƒç”¨ <code>string.match(regexp)</code>çš„ç»“æœä¸<br>è°ƒç”¨<code>regexp.exec(string)</code>çš„ç»“æœç›¸åŒ. å¦‚æœæœ‰<code>g</code>æ ‡è¯†ç¬¦, é‚£ä¹ˆå®ƒè¿”å›ä¸€ä¸ª<br>åŒ…å«æ‰€æœ‰åŒ¹é…é¡¹(é™¤æ•è·åˆ†ç»„)çš„æ•°ç»„.</p><h3 id="string-replace-searchValue-replaceValue"><a href="#string-replace-searchValue-replaceValue" class="headerlink" title="string.replace(searchValue, replaceValue)"></a>string.replace(searchValue, replaceValue)</h3><p>replace æ–¹æ³•å¯¹ string è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢æ“ä½œ, å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸². å‚æ•°<br>searchValue å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡. å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,<br>é‚£ä¹ˆ searchValue åªä¼šæŠŠç¬¬ä¸€æ¬¡åŒ¹é…çš„å‡ºç°çš„åœ°æ–¹æ›¿æ¢æ‰; å¦‚æœæ˜¯æ­£åˆ™è¡¨è¾¾å¼<br>å¸¦æœ‰<code>g</code>æ ‡è¯†ç¬¦, åˆ™ä¼šæ›¿æ¢ç‚¹æ‰€æœ‰åŒ¹é…é¡¹.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'1-10-1001'</span>;</span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/-(\d+)-/</span>;</span><br><span class="line"></span><br><span class="line">str.replace(reg, <span class="string">'æ ‹$1å•å…ƒ'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(str); <span class="comment">// 1æ ‹10å•å…ƒ1001</span></span><br></pre></td></tr></table></figure><h3 id="string-search-regexp"><a href="#string-search-regexp" class="headerlink" title="string.search(regexp)"></a>string.search(regexp)</h3><p>search æ–¹æ³•å’Œ indexOf æ–¹æ³•ç±»ä¼¼, åªæ˜¯å®ƒåªæ¥å—ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ä½œä¸ºå‚æ•°<br>è€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸². å¦‚æœæ‰¾åˆ°åŒ¹é…, å®ƒè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„é¦–å­—ç¬¦ä½ç½®. å¦‚æœæ²¡æœ‰<br>è¿”å›-1. æ­¤æ–¹æ³•ä¼šå¿½ç•¥<code>g</code>æ ‡è¯†ç¬¦.</p><h3 id="string-slice-start-end"><a href="#string-slice-start-end" class="headerlink" title="string.slice(start, end)"></a>string.slice(start, end)</h3><p>slice æ–¹æ³•å¤åˆ¶ string çš„ä¸€éƒ¨åˆ†æ„é€ æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸². å¦‚æœ start å‚æ•°æ˜¯è´Ÿæ•°<br>, ä»–å°†ä¸ string.length ç›¸åŠ . end å‚æ•°æ˜¯å¯é€‰çš„, é»˜è®¤æ˜¯ string.length. å¦‚æœ<br>end å‚æ•°æ˜¯è´Ÿæ•°, ä¹Ÿä¼šä¸ string.length ç›¸åŠ . end å‚æ•°ç­‰äºä½ æƒ³å–çš„æœ€åä¸€ä¸ªå­—ç¬¦<br>çš„ä½ç½®åŠ 1.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// str.length == 39</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">'and in it he says "Any damn fool could'</span>;</span><br><span class="line"><span class="keyword">let</span> a = str.slice(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// 'and'</span></span><br><span class="line"><span class="keyword">let</span> b = str.slice(<span class="number">-5</span>); <span class="comment">// 'could'</span></span><br></pre></td></tr></table></figure><h3 id="string-split-separator-limit"><a href="#string-split-separator-limit" class="headerlink" title="string.split(separator, limit)"></a>string.split(separator, limit)</h3><p>split æ–¹æ³•æŠŠ string ä»¥æŒ‡å®šçš„åˆ†éš”ç¬¦æ„é€ æˆä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„. å¯é€‰å‚æ•°<br>limit å¯ä»¥é™åˆ¶è¢«åˆ†å‰²ç‰‡æ®µçš„æ•°é‡. separator å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ª<br>æ­£åˆ™è¡¨è¾¾å¼. æ­¤æ–¹æ³•ä¼šå¿½ç•¥<code>g</code>æ ‡è¯†ç¬¦.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'0123456789'</span>;</span><br><span class="line"><span class="keyword">let</span> a = str.split(<span class="string">''</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// ['0', '1', '2', '3', '4']</span></span><br></pre></td></tr></table></figure><h3 id="string-substring-start-end"><a href="#string-substring-start-end" class="headerlink" title="string.substring(start, end)"></a>string.substring(start, end)</h3><p>substring æ–¹æ³•å’Œ<code>slice</code> æ–¹æ³•ä¸€æ ·, åªæ˜¯ä¸èƒ½å¤„ç†è´Ÿæ•°. æ‰€ä»¥ç”¨<code>slice</code>ä»£æ›¿å®ƒ</p><h3 id="string-toLocaleLowerCase"><a href="#string-toLocaleLowerCase" class="headerlink" title="string.toLocaleLowerCase()"></a>string.toLocaleLowerCase()</h3><p>toLocaleLowerCase æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸², å®ƒä½¿ç”¨æœ¬åœ°åŒ–çš„è§„åˆ™æŠŠè¿™ä¸ª string<br>ä¸­çš„æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå°å†™æ ¼å¼.</p><h3 id="string-toLocaleUpperCase"><a href="#string-toLocaleUpperCase" class="headerlink" title="string.toLocaleUpperCase()"></a>string.toLocaleUpperCase()</h3><p>toLocaleUpperCase æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸², å®ƒä½¿ç”¨æœ¬åœ°åŒ–çš„è§„åˆ™æŠŠè¿™ä¸ª string<br>ä¸­çš„æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå¤§å†™æ ¼å¼.</p><p>Created on 17/9/21 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;JavaScriptåŒ…å«äº†ä¸€å¥—å°å‹çš„å¯ç”¨åœ¨æ ‡å‡†ç±»å‹ä¸Šçš„æ ‡å‡†æ–¹æ³•é›†,&lt;br&gt;ä¸»è¦æ˜¯é’ˆå¯¹æ•°ç»„/æ­£åˆ™åŠå­—ç¬¦ä¸²çš„ä¸€äº›å¤„ç†.&lt;/p&gt;
&lt;blockquote&gt;
&lt;h2 id=&quot;Array&quot;&gt;&lt;a href=&quot;#Array&quot; class=&quot;headerlink&quot; title=&quot;Arra
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript æ·±æµ…æ‹·è´</title>
    <link href="https://yoursite.com/2017/10/16/JavaScript-%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/"/>
    <id>https://yoursite.com/2017/10/16/JavaScript-æ·±æµ…æ‹·è´/</id>
    <published>2017-10-16T13:45:01.000Z</published>
    <updated>2018-05-13T03:49:29.855Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h3 id="æµ…æ‹·è´"><a href="#æµ…æ‹·è´" class="headerlink" title="æµ…æ‹·è´"></a>æµ…æ‹·è´</h3><p>æµ…æ‹·è´åªèƒ½æ‹·è´é¡¶å±‚å±æ€§åŸºæœ¬æ•°æ®ç±»å‹, ä¹Ÿå°±æ˜¯å¦‚æœçˆ¶å¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„, é‚£ä¹ˆå­å¯¹è±¡è·å–åˆ°çš„åªæ˜¯ä¸€ä¸ªå†…å­˜åœ°å€è€Œä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„å¯¹è±¡, æ‰€ä»¥ä¸€æ—¦ä¿®æ”¹çˆ¶å¯¹è±¡ä¹Ÿä¼šè·Ÿç€è¢«ç¯¡æ”¹.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shallowCopy</span> (<span class="params"> parent </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> o = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> parent) &#123;</span><br><span class="line">         o[i] = parent[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><h3 id="æ·±æ‹·è´"><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h3><p>æ·±æ‹·è´ä¹Ÿå°±æ˜¯èƒ½å¤Ÿå®ç°æ•°ç»„å’Œå¯¹è±¡æ‹·è´, æ·±æ‹·è´ä¸æµ…æ‹·è´å¯¹æ¯”, æ·±æ‹·è´ä¼šåœ¨å †åŒºå¼€è¾Ÿæ–°çš„ä¸€å—æ¥å‚¨å­˜æ–°çš„å¯¹è±¡. ä¸¤ä¸ªå¯¹è±¡å¯¹åº”çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„å†…å­˜åœ°å€, æ‰€ä»¥ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å¹¶ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§. å®ç°æ·±æ‹·è´ä¹Ÿæœ‰ä¸¤ç§æ–¹å¼: ä¸€ç§æ˜¯é€’å½’/ ä¸€ç§æ˜¯JSON.</p></blockquote><ol><li><p>é€’å½’</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCopy</span> (<span class="params">parent, child = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> parent) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> parent[i] === <span class="string">'object'</span>) &#123;</span><br><span class="line">            child[i] = (parent[i].constructor == <span class="built_in">Array</span>) ? [] : &#123;&#125;;</span><br><span class="line">            deepCopy(parent[i], child[i])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             child[i] = parent[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>JSONè§£æ(ä¸¥æ ¼çš„ JSON æ ¼å¼)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">    age: <span class="string">'18'</span>,</span><br><span class="line">    friends: [<span class="string">'è€å¼ '</span>, <span class="string">'è€ç‹'</span>],</span><br><span class="line">    job: &#123;</span><br><span class="line">       main: <span class="string">'ç¡è§‰'</span>,</span><br><span class="line">       sub: <span class="string">'èººç€'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">JSON</span>.parse( <span class="built_in">JSON</span>.stringify(o));</span><br><span class="line">result.name = <span class="string">'cara'</span>;</span><br><span class="line">result.friends.push(<span class="string">'è€æ'</span>);</span><br><span class="line"><span class="built_in">console</span>.dir(o);</span><br><span class="line"><span class="built_in">console</span>.dir(result)</span><br></pre></td></tr></table></figure></li></ol><p>ä»¥ä¸Šä¸¤ç§æ–¹å¼æ— æ³•è§£æä¸€ä¸‹å‡ ç§æƒ…å†µ:</p><ul><li>RegExp å¯¹è±¡</li><li>å‡½æ•°</li><li>ä¼šæ‘’å¼ƒå¯¹è±¡çš„ constructor , æ‰€æœ‰æ„é€ å‡½æ•°éƒ½ä¼šæŒ‡å‘ Object</li><li>å¯¹è±¡å¾ªç¯å¼•ç”¨ä¹Ÿä¼šæŠ¥é”™</li></ul><p>æ‰€ä»¥è¦é¢å¯¹ä¸åŒçš„å¯¹è±¡, åšä¸åŒçš„å¤„ç†æ–¹å¼, å°±éœ€è¦æ£€æŸ¥ä¸€ä¸‹å¯¹è±¡çš„ç±»å‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> Type = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> Types = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, type; type = [<span class="string">'Array'</span>, <span class="string">'Date'</span>, <span class="string">'RegExp'</span>][i++];) &#123;</span><br><span class="line">        Types[<span class="string">'is'</span> + type] = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">'object'</span>) <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">`[object <span class="subst">$&#123;type&#125;</span>]`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Types</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> types = Type()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åˆ™å½±å“èŒƒå›´</span></span><br><span class="line"><span class="keyword">const</span> getRegExp = <span class="function">(<span class="params">reg</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reg.globlal) <span class="keyword">return</span> <span class="string">'g'</span></span><br><span class="line">    <span class="keyword">if</span> (reg.ignoreCase) <span class="keyword">return</span> <span class="string">'i'</span></span><br><span class="line">    <span class="keyword">if</span> (reg.multiline) <span class="keyword">return</span> <span class="string">'m'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clone = <span class="function">(<span class="params">oldObj = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> oldObjs = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> _clone = <span class="function"><span class="params">oldObj</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> newObj, proto</span><br><span class="line">        <span class="comment">// ä¸åŒç±»å‹, ä¸åŒå¤„ç†æ–¹å¼</span></span><br><span class="line">        <span class="keyword">if</span> (types.isArray(oldObj)) &#123;</span><br><span class="line">            newObj = []</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (types.isDate(oldObj)) &#123;</span><br><span class="line">            newObj = <span class="keyword">new</span> <span class="built_in">Date</span>(oldObj.getTime())</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (types.isRegExp(oldObj)) &#123;</span><br><span class="line">            newObj = <span class="keyword">new</span> <span class="built_in">RegExp</span>(oldObj.source, getRegExp(oldObj))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ–©æ–­åŸå‹é“¾</span></span><br><span class="line">            proto = <span class="built_in">Object</span>.getPrototypeOf(oldObj)</span><br><span class="line">            newObj = <span class="built_in">Object</span>.create(proto)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœä¹‹å‰å·²ç»éå†è¿‡è¯¥å¯¹è±¡, ç›´æ¥è¿”å›è¯¥å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">let</span> hasBeen = oldObjs.indexOf(oldObj)</span><br><span class="line">        <span class="keyword">if</span> (hasBeen !== <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> oldObjs[hasBeen]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®°å½•æ“ä½œè¿‡çš„å¯¹è±¡</span></span><br><span class="line">        oldObjs.push(oldObj)</span><br><span class="line">        <span class="comment">// é€’å½’</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> oldObj) &#123;</span><br><span class="line">            newObj[i] = _clone(oldObj[i])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newObj</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _clone(oldObj)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ‘‡æµ‹è¯•ä¸€æ³¢:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Cara = <span class="keyword">new</span> person(<span class="string">'Cara'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hello world!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> oldObj = &#123;</span><br><span class="line">    a: say,</span><br><span class="line">    c: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'ab+c'</span>, <span class="string">'i'</span>),</span><br><span class="line">    d: Cara,</span><br><span class="line">&#125;;</span><br><span class="line">oldObj.b = oldObj;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newObj = clone(oldObj)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newObj.a, oldObj.a) </span><br><span class="line"><span class="comment">// [Function: say] [Function: say]</span></span><br><span class="line"><span class="built_in">console</span>.log(newObj.b, oldObj.b)</span><br><span class="line"><span class="comment">// &#123; </span></span><br><span class="line"><span class="comment">//     a: [Function: say], </span></span><br><span class="line"><span class="comment">//     c: /ab+c/i, </span></span><br><span class="line"><span class="comment">//     d: person &#123; name: 'Messi' &#125;, </span></span><br><span class="line"><span class="comment">//     b: [Circular] </span></span><br><span class="line"><span class="comment">// &#125; </span></span><br><span class="line"><span class="comment">// &#123; </span></span><br><span class="line"><span class="comment">//     a: [Function: say], </span></span><br><span class="line"><span class="comment">//     c: /ab+c/i, </span></span><br><span class="line"><span class="comment">//     d: person &#123; name: 'Messi' &#125;, </span></span><br><span class="line"><span class="comment">//     b: [Circular] </span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(newObj.c, oldObj.c)</span><br><span class="line"><span class="comment">// /ab+c/i /ab+c/i</span></span><br><span class="line"><span class="built_in">console</span>.log(newObj.d.constructor, oldObj.d.constructor)</span><br><span class="line"><span class="comment">// [Function: person][Function: person]</span></span><br></pre></td></tr></table></figure></p><p>ç›®å‰æˆ‘ä»¬ä¸Šé¢è¯´çš„å‡ ç§å‘å°±å¾—ä»¥è§£å†³, ä¸è¿‡è¿™è¿˜ä¸æ˜¯æœ€å®Œæ•´çš„æ–¹æ¡ˆ, è¿˜æœ‰ä¸€äº› ES6 é‡Œé¢çš„å¯¹è±¡ä¹Ÿéœ€è¦æˆ‘ä»¬åšç‰¹æ®Šçš„å¤„ç†, ä¸è¿‡ç°åœ¨è¿™ä¸ªç‰ˆæœ¬åœ¨æ—¥å¸¸è¿˜æ˜¯å¤Ÿç”¨äº†. å¦å¤–åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿˜æ˜¯å»ºè®®ç”¨ <code>lodash</code> çš„ <code>_.cloneDeep</code></p><p>Created on 2017-8-15 by cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h3 id=&quot;æµ…æ‹·è´&quot;&gt;&lt;a href=&quot;#æµ…æ‹·è´&quot; class=&quot;headerlink&quot; title=&quot;æµ…æ‹·è´&quot;&gt;&lt;/a&gt;æµ…æ‹·è´&lt;/h3&gt;&lt;p&gt;æµ…æ‹·è´åªèƒ½æ‹·è´é¡¶å±‚å±æ€§åŸºæœ¬æ•°æ®ç±»å‹, ä¹Ÿå°±æ˜¯å¦‚æœçˆ¶å¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„, é‚£ä¹ˆå­å¯¹è±¡è·å–åˆ°çš„åªæ˜¯ä¸€ä¸ª
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
</feed>
